<?xml version="1.0" encoding="utf-8"?>
<search> 
  
    
    <entry>
      <title><![CDATA[Xcode中添加快捷代码块]]></title>
      <url>/2018/08/02/Xcode%E4%B8%AD%E6%B7%BB%E5%8A%A0%E5%BF%AB%E6%8D%B7%E4%BB%A3%E7%A0%81%E5%9D%97/</url>
      <content type="html"><![CDATA[<p>Xcode提供了一个很好的功能，自定义代码块然后快捷添加。</p>
<p>以添加一个Strong属性为例</p>
<ol>
<li>在写属性的地方写下如下代码</li>
</ol>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>,<span class="keyword">strong</span>) <span class="built_in">NSString</span> name;</span><br></pre></td></tr></table></figure>
<ol>
<li><p>选中语句，用鼠标左键拖到下图指示的代码片段区域，就新建了一个代码片段</p>
<p><img src="/2018/08/02/Xcode中添加快捷代码块/1.png" alt=""></p>
</li>
<li><p>双击刚才新建的代码块然后点击edit编辑将代码改成如下代码</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>,<span class="keyword">strong</span>) &lt;<span class="meta">#引用数据类型#&gt; *<span class="meta-string">&lt;#属性名称#&gt;</span>;</span></span><br></pre></td></tr></table></figure>
<p>==&lt;#这里是可修改字段#&gt;==</p>
<p><img src="/2018/08/02/Xcode中添加快捷代码块/2.png" alt=""></p>
<pre><code>Title 代码片段的标题 
</code></pre><p>​    Summary 代码片段的描述文字</p>
<pre><code>Platform 可以使用代码片段的平台，有IOS/OS X/All三个选项

Language 可以在哪些语言中使用该代码片段

Completion Shortcut  代码片段的快捷方式，
</code></pre><p>​        如输入strong即显示 <img src="/2018/08/02/Xcode中添加快捷代码块/3.png" alt=""></p>
<p>​        引用数据类型和属性名称可随意修改为自己所需</p>
<pre><code>Completion Scopes 可编辑空间
</code></pre></li>
<li><p>设置完成点击Done即可</p>
</li>
</ol>
]]></content>
      
        <categories>
            
            <category> iOS开发 </category>
            
        </categories>
        
        
        <tags>
            
            <tag> 工具使用 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Runtime]]></title>
      <url>/2018/06/20/Runtime/</url>
      <content type="html"><![CDATA[<h5 id="Runtime简介"><a href="#Runtime简介" class="headerlink" title="Runtime简介"></a>Runtime简介</h5><ul>
<li>Runtime简称运行时，OC就是运行时机制的语言，也就是在运行时候会有一些机制，其中最主要的是消息机制。</li>
<li>对于C语言，函数的调用在编译的时候会决定调用那个函数</li>
<li>对于OC的函数，属于动态调用过程，在编译的时候并不能决定真正调用那个函数，只有在真正运行的时候才会根据函数的名称找到对应的函数来调用。</li>
<li>事实证明<ul>
<li>在编译阶段，OC可以调用任何函数，即使这个函数并未实现，只要声明过就不会报错。</li>
<li>在编译阶段，C语言调用未实现的函数就会报错。</li>
</ul>
</li>
</ul>
<h5 id="Runtime作用"><a href="#Runtime作用" class="headerlink" title="Runtime作用"></a>Runtime作用</h5><ol>
<li><p>发送消息</p>
<ul>
<li>方法调用的本质，就是让对象发送消息</li>
<li>objc_msgSend只有对象才能发送，因此以objc开头</li>
<li>使用消息机制前提，必须导入#import<objc message.h=""></objc></li>
<li>消息机制简单使用</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建person对象</span></span><br><span class="line">Person *p = [[Person alloc]init];</span><br><span class="line"><span class="comment">//调用对象方法</span></span><br><span class="line">[p eat];</span><br><span class="line"></span><br><span class="line"><span class="comment">//本质：让对象发送消息</span></span><br><span class="line">objc_msgSend(p,<span class="keyword">@selector</span>(eat));</span><br><span class="line"></span><br><span class="line"><span class="comment">//调用类方法的方式：两种</span></span><br><span class="line"><span class="comment">//第一种通过类名调用</span></span><br><span class="line">[Person eat];</span><br><span class="line"><span class="comment">//第二种通过类对象调用</span></span><br><span class="line">[[Person <span class="keyword">class</span>]eat];</span><br><span class="line"></span><br><span class="line"><span class="comment">//用类名调用类方法，底层会自动把类名转换成类对象调用</span></span><br><span class="line">objc_msgSend([Person <span class="keyword">class</span>],<span class="keyword">@selector</span>(eat));</span><br></pre></td></tr></table></figure>
<ul>
<li><p>消息机制原理：对象根据方法编号SEL去映射表查找对应的方法实现</p>
<p><img src="/2018/06/20/Runtime/01.png" alt="01"></p>
</li>
</ul>
</li>
<li><p>交换方法</p>
<ul>
<li>开发使用场景：系统自带的方法功能不够，给系统自带的方法扩展一些功能，并且保持原有的功能。</li>
<li>方式一：继承系统的类，重写方法</li>
<li>方式二：使用Runtime交换方法</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    <span class="comment">// 需求：给imageNamed方法提供功能，每次加载图片就判断下图片是否加载成功。</span></span><br><span class="line">    <span class="comment">// 步骤一：先搞个分类，定义一个能加载图片并且能打印的方法+ (instancetype)imageWithName:(NSString *)name;</span></span><br><span class="line">    <span class="comment">// 步骤二：交换imageNamed和imageWithName的实现，就能调用imageWithName，间接调用imageWithName的实现。</span></span><br><span class="line">    <span class="built_in">UIImage</span> *image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"123"</span>];</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">UIImage</span> (<span class="title">Image</span>)</span></span><br><span class="line"><span class="comment">// 加载分类到内存的时候调用</span></span><br><span class="line">+ (<span class="keyword">void</span>)load</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 交换方法    </span></span><br><span class="line">    <span class="comment">// 获取imageWithName方法地址</span></span><br><span class="line">    Method imageWithName = class_getClassMethod(<span class="keyword">self</span>, <span class="keyword">@selector</span>(imageWithName:)); </span><br><span class="line">    <span class="comment">// 获取imageWithName方法地址</span></span><br><span class="line">    Method imageName = class_getClassMethod(<span class="keyword">self</span>, <span class="keyword">@selector</span>(imageNamed:));</span><br><span class="line">    <span class="comment">// 交换方法地址，相当于交换实现方式</span></span><br><span class="line">    method_exchangeImplementations(imageWithName, imageName);</span><br><span class="line">      </span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 不能在分类中重写系统方法imageNamed，因为会把系统的功能给覆盖掉，而且分类中不能调用super.</span></span><br><span class="line"><span class="comment">// 既能加载图片又能打印</span></span><br><span class="line">+ (<span class="keyword">instancetype</span>)imageWithName:(<span class="built_in">NSString</span> *)name</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 这里调用imageWithName，相当于调用imageName</span></span><br><span class="line">    <span class="built_in">UIImage</span> *image = [<span class="keyword">self</span> imageWithName:name];</span><br><span class="line">    <span class="keyword">if</span> (image == <span class="literal">nil</span>) &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"加载空的图片"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> image;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>动态添加方法</p>
<ul>
<li>开发使用场景：如果一个类方法非常多，加载类到内存的时候比较耗费资源，需要给每个方法生成映射表，可以使用动态给某个类添加方法解决。</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"Person.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;objc/message.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Person</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//默认方法都有两个隐式参数    </span></span><br><span class="line"><span class="keyword">void</span> eat(<span class="keyword">id</span> <span class="keyword">self</span>,SEL sel)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@ %@"</span>,<span class="keyword">self</span>,<span class="built_in">NSStringFromSelector</span>(sel));</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">当一个对象调用未实现的方法，会调用这个方法处理，并且会把对应的方法列表传过来，刚好可以判断，未实现的方法是不是我们想要动态添加的方法。</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">+ (<span class="built_in">BOOL</span>)resolveInstanceMethod:(SEL)sel</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (sel== <span class="keyword">@selector</span>(eat)) &#123; </span><br><span class="line">        <span class="comment">// 动态添加eat方法</span></span><br><span class="line">        <span class="comment">// 第一个参数：给哪个类添加方法</span></span><br><span class="line">        <span class="comment">// 第二个参数：添加方法的方法编号</span></span><br><span class="line">        <span class="comment">// 第三个参数：添加方法的函数实现（函数地址）</span></span><br><span class="line">        <span class="comment">// 第四个参数：函数的类型，(返回值+参数类型) v:void @:对象-&gt;self :表示SEL-&gt;_cmd</span></span><br><span class="line">        class_addMethod(<span class="keyword">self</span>, <span class="keyword">@selector</span>(eat), eat, <span class="string">"v@:"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> [<span class="keyword">super</span> resolveInstanceMethod:sel];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line">    </span><br><span class="line"> </span><br><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"Person.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    </span><br><span class="line">    Person *p = [[Person alloc]init];</span><br><span class="line">    <span class="comment">// 默认person，没有实现eat方法，可以通过performSelector调用，但是会报错。</span></span><br><span class="line">    <span class="comment">// 动态添加方法就不会报错</span></span><br><span class="line">    [p performSelector:<span class="keyword">@selector</span>(eat)];</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>给分类添加属性</p>
<ul>
<li>给一个类声明属性，其实本质就是给这个类添加关联，并不是直接把这个值的内存空间添加到类内存空间。</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];  </span><br><span class="line">    <span class="comment">// 给系统NSObject类动态添加属性name    </span></span><br><span class="line">    <span class="built_in">NSObject</span> *objc = [[<span class="built_in">NSObject</span> alloc] init];</span><br><span class="line">    objc.name = <span class="string">@"小码哥"</span>;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>,objc.name);</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义关联的key</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">char</span> *key = <span class="string">"name"</span>;</span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">NSObject</span> (<span class="title">Property</span>)</span></span><br><span class="line">- (<span class="built_in">NSString</span> *)name</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 根据关联的key，获取关联的值。</span></span><br><span class="line">    <span class="keyword">return</span> objc_getAssociatedObject(<span class="keyword">self</span>, key);</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>)setName:(<span class="built_in">NSString</span> *)name</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 第一个参数：给哪个对象添加关联</span></span><br><span class="line">    <span class="comment">// 第二个参数：关联的key，通过这个key获取</span></span><br><span class="line">    <span class="comment">// 第三个参数：关联的value</span></span><br><span class="line">    <span class="comment">// 第四个参数:关联的策略</span></span><br><span class="line">    objc_setAssociatedObject(<span class="keyword">self</span>, key, name, OBJC_ASSOCIATION_RETAIN_NONATOMIC);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>字典转模型</p>
<ul>
<li><p>设计模型：字典转模型的第一步</p>
<ul>
<li>模型属性，通常需要跟字典中的key一一对应</li>
<li>问题：一个一个的生成模型属性，很慢？</li>
<li>需求：能不能自动根据一个字典，生成对应的属性</li>
<li>解决：提供一个分类，专门根据字典生成对应的属性字符串</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">NSObject</span> (<span class="title">Log</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 自动打印属性字符串</span></span><br><span class="line">+ (<span class="keyword">void</span>)resolveDict:(<span class="built_in">NSDictionary</span> *)dict&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 拼接属性字符串代码</span></span><br><span class="line">    <span class="built_in">NSMutableString</span> *strM = [<span class="built_in">NSMutableString</span> string];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 1.遍历字典，把字典中的所有key取出来，生成对应的属性代码</span></span><br><span class="line">    [dict enumerateKeysAndObjectsUsingBlock:^(<span class="keyword">id</span>  _Nonnull key, <span class="keyword">id</span>  _Nonnull obj, <span class="built_in">BOOL</span> * _Nonnull stop) &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 类型经常变，抽出来</span></span><br><span class="line">         <span class="built_in">NSString</span> *type;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> ([obj isKindOfClass:<span class="built_in">NSClassFromString</span>(<span class="string">@"__NSCFString"</span>)]) &#123;</span><br><span class="line">            type = <span class="string">@"NSString"</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span> ([obj isKindOfClass:<span class="built_in">NSClassFromString</span>(<span class="string">@"__NSCFArray"</span>)])&#123;</span><br><span class="line">            type = <span class="string">@"NSArray"</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span> ([obj isKindOfClass:<span class="built_in">NSClassFromString</span>(<span class="string">@"__NSCFNumber"</span>)])&#123;</span><br><span class="line">            type = <span class="string">@"int"</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span> ([obj isKindOfClass:<span class="built_in">NSClassFromString</span>(<span class="string">@"__NSCFDictionary"</span>)])&#123;</span><br><span class="line">            type = <span class="string">@"NSDictionary"</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 属性字符串</span></span><br><span class="line">        <span class="built_in">NSString</span> *str;</span><br><span class="line">        <span class="keyword">if</span> ([type containsString:<span class="string">@"NS"</span>]) &#123;</span><br><span class="line">            str = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"@property (nonatomic, strong) %@ *%@;"</span>,type,key];</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            str = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"@property (nonatomic, assign) %@ %@;"</span>,type,key];</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 每生成属性字符串，就自动换行。</span></span><br><span class="line">        [strM appendFormat:<span class="string">@"\n%@\n"</span>,str];</span><br><span class="line">        </span><br><span class="line">    &#125;];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 把拼接好的字符串打印出来，就好了。</span></span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>,strM);   </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
<ul>
<li><p>字典转模型的方式一：KVC</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Status</span></span></span><br><span class="line"></span><br><span class="line">+ (<span class="keyword">instancetype</span>)statusWithDict:(<span class="built_in">NSDictionary</span> *)dict</span><br><span class="line">&#123;</span><br><span class="line">    Status *status = [[<span class="keyword">self</span> alloc] init];</span><br><span class="line">    </span><br><span class="line">    [status setValuesForKeysWithDictionary:dict];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> status;  </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><p>KVC字典转模型弊端：必须保证，模型中的属性和字典中的key一一对应。</p>
<ul>
<li><p>如果不一致就会出现找不到key的错误。</p>
</li>
<li><p>解决：重写对象的setValue:forUndefinedKey把系统方法覆盖，就能继续使用KVC字典转模型了。</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)setValue:(<span class="keyword">id</span>)value forUndefinedKey:(<span class="built_in">NSString</span> *)key</span><br><span class="line">&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>字典转模型的方式二：Runtime</p>
<ul>
<li><p>利用运行时，遍历模型中的所有属性，根据模型的属性名，去字典中查找key，取出对应的值，给模型的属性赋值。</p>
</li>
<li><p>提供一个NSObject分类，专门字典转模型，以后所有模型都可以通过这个分类转</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    <span class="comment">// Do any additional setup after loading the view, typically from a nib.</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 解析Plist文件</span></span><br><span class="line">    <span class="built_in">NSString</span> *filePath = [[<span class="built_in">NSBundle</span> mainBundle] pathForResource:<span class="string">@"status.plist"</span> ofType:<span class="literal">nil</span>];</span><br><span class="line"></span><br><span class="line">    <span class="built_in">NSDictionary</span> *statusDict = [<span class="built_in">NSDictionary</span> dictionaryWithContentsOfFile:filePath];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 获取字典数组</span></span><br><span class="line">    <span class="built_in">NSArray</span> *dictArr = statusDict[<span class="string">@"statuses"</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 自动生成模型的属性字符串</span></span><br><span class="line"><span class="comment">//    [NSObject resolveDict:dictArr[0][@"user"]];</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    _statuses = [<span class="built_in">NSMutableArray</span> array];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 遍历字典数组</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">NSDictionary</span> *dict <span class="keyword">in</span> dictArr) &#123;</span><br><span class="line">        </span><br><span class="line">        Status *status = [Status modelWithDict:dict];</span><br><span class="line">        </span><br><span class="line">        [_statuses addObject:status];</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 测试数据</span></span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@ %@"</span>,_statuses,[_statuses[<span class="number">0</span>] user]);</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">NSObject</span> (<span class="title">Model</span>)</span></span><br><span class="line"></span><br><span class="line">+ (<span class="keyword">instancetype</span>)modelWithDict:(<span class="built_in">NSDictionary</span> *)dict</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 思路：遍历模型中所有属性-》使用运行时</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 0.创建对应的对象</span></span><br><span class="line">    <span class="keyword">id</span> objc = [[<span class="keyword">self</span> alloc] init];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 1.利用runtime给对象中的成员属性赋值</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// class_copyIvarList:获取类中的所有成员属性</span></span><br><span class="line">    <span class="comment">// Ivar：成员属性的意思</span></span><br><span class="line">    <span class="comment">// 第一个参数：表示获取哪个类中的成员属性</span></span><br><span class="line">    <span class="comment">// 第二个参数：表示这个类有多少成员属性，传入一个Int变量地址，会自动给这个变量赋值</span></span><br><span class="line">    <span class="comment">// 返回值Ivar *：指的是一个ivar数组，会把所有成员属性放在一个数组中，通过返回的数组就能全部获取到。</span></span><br><span class="line">    <span class="comment">/* 类似下面这种写法</span></span><br><span class="line"><span class="comment">     </span></span><br><span class="line"><span class="comment">     Ivar ivar;</span></span><br><span class="line"><span class="comment">     Ivar ivar1;</span></span><br><span class="line"><span class="comment">     Ivar ivar2;</span></span><br><span class="line"><span class="comment">     // 定义一个ivar的数组a</span></span><br><span class="line"><span class="comment">     Ivar a[] = &#123;ivar,ivar1,ivar2&#125;;</span></span><br><span class="line"><span class="comment">     </span></span><br><span class="line"><span class="comment">     // 用一个Ivar *指针指向数组第一个元素</span></span><br><span class="line"><span class="comment">     Ivar *ivarList = a;</span></span><br><span class="line"><span class="comment">     </span></span><br><span class="line"><span class="comment">     // 根据指针访问数组第一个元素</span></span><br><span class="line"><span class="comment">     ivarList[0];</span></span><br><span class="line"><span class="comment">     </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> count;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 获取类中的所有成员属性</span></span><br><span class="line">    Ivar *ivarList = class_copyIvarList(<span class="keyword">self</span>, &amp;count);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; count; i++) &#123;</span><br><span class="line">        <span class="comment">// 根据角标，从数组取出对应的成员属性</span></span><br><span class="line">        Ivar ivar = ivarList[i];</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 获取成员属性名</span></span><br><span class="line">        <span class="built_in">NSString</span> *name = [<span class="built_in">NSString</span> stringWithUTF8String:ivar_getName(ivar)];</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 处理成员属性名-&gt;字典中的key</span></span><br><span class="line">        <span class="comment">// 从第一个角标开始截取</span></span><br><span class="line">        <span class="built_in">NSString</span> *key = [name substringFromIndex:<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 根据成员属性名去字典中查找对应的value</span></span><br><span class="line">        <span class="keyword">id</span> value = dict[key];</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 二级转换:如果字典中还有字典，也需要把对应的字典转换成模型</span></span><br><span class="line">        <span class="comment">// 判断下value是否是字典</span></span><br><span class="line">        <span class="keyword">if</span> ([value isKindOfClass:[<span class="built_in">NSDictionary</span> <span class="keyword">class</span>]]) &#123;</span><br><span class="line">            <span class="comment">// 字典转模型</span></span><br><span class="line">            <span class="comment">// 获取模型的类对象，调用modelWithDict</span></span><br><span class="line">            <span class="comment">// 模型的类名已知，就是成员属性的类型</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 获取成员属性类型</span></span><br><span class="line">           <span class="built_in">NSString</span> *type = [<span class="built_in">NSString</span> stringWithUTF8String:ivar_getTypeEncoding(ivar)];</span><br><span class="line">          <span class="comment">// 生成的是这种@"@\"User\"" 类型 -》 @"User"  在OC字符串中 \" -&gt; "，\是转义的意思，不占用字符</span></span><br><span class="line">            <span class="comment">// 裁剪类型字符串</span></span><br><span class="line">            <span class="built_in">NSRange</span> range = [type rangeOfString:<span class="string">@"\""</span>];</span><br><span class="line"></span><br><span class="line">           type = [type substringFromIndex:range.location + range.length];</span><br><span class="line">            </span><br><span class="line">            range = [type rangeOfString:<span class="string">@"\""</span>];</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 裁剪到哪个角标，不包括当前角标</span></span><br><span class="line">          type = [type substringToIndex:range.location];</span><br><span class="line"></span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 根据字符串类名生成类对象</span></span><br><span class="line">            Class modelClass = <span class="built_in">NSClassFromString</span>(type);</span><br><span class="line">            </span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (modelClass) &#123; <span class="comment">// 有对应的模型才需要转</span></span><br><span class="line">                </span><br><span class="line">                <span class="comment">// 把字典转模型</span></span><br><span class="line">                value  =  [modelClass modelWithDict:value];</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 三级转换：NSArray中也是字典，把数组中的字典转换成模型.</span></span><br><span class="line">        <span class="comment">// 判断值是否是数组</span></span><br><span class="line">        <span class="keyword">if</span> ([value isKindOfClass:[<span class="built_in">NSArray</span> <span class="keyword">class</span>]]) &#123;</span><br><span class="line">            <span class="comment">// 判断对应类有没有实现字典数组转模型数组的协议</span></span><br><span class="line">            <span class="keyword">if</span> ([<span class="keyword">self</span> respondsToSelector:<span class="keyword">@selector</span>(arrayContainModelClass)]) &#123;</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// 转换成id类型，就能调用任何对象的方法</span></span><br><span class="line">                <span class="keyword">id</span> idSelf = <span class="keyword">self</span>;</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// 获取数组中字典对应的模型</span></span><br><span class="line">                <span class="built_in">NSString</span> *type =  [idSelf arrayContainModelClass][key];</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// 生成模型</span></span><br><span class="line">               Class classModel = <span class="built_in">NSClassFromString</span>(type);</span><br><span class="line">                <span class="built_in">NSMutableArray</span> *arrM = [<span class="built_in">NSMutableArray</span> array];</span><br><span class="line">                <span class="comment">// 遍历字典数组，生成模型数组</span></span><br><span class="line">                <span class="keyword">for</span> (<span class="built_in">NSDictionary</span> *dict <span class="keyword">in</span> value) &#123;</span><br><span class="line">                    <span class="comment">// 字典转模型</span></span><br><span class="line">                  <span class="keyword">id</span> model =  [classModel modelWithDict:dict];</span><br><span class="line">                    [arrM addObject:model];</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// 把模型数组赋值给value</span></span><br><span class="line">                value = arrM;</span><br><span class="line">                </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (value) &#123; <span class="comment">// 有值，才需要给模型的属性赋值</span></span><br><span class="line">            <span class="comment">// 利用KVC给模型中的属性赋值</span></span><br><span class="line">            [objc setValue:value forKey:key];</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> objc;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
]]></content>
      
        <categories>
            
            <category> iOS开发 </category>
            
        </categories>
        
        
        <tags>
            
            <tag> iOS </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[RunLoop]]></title>
      <url>/2018/05/10/RunLoop/</url>
      <content type="html"><![CDATA[<h4 id="RunLoop基本概念"><a href="#RunLoop基本概念" class="headerlink" title="RunLoop基本概念"></a>RunLoop基本概念</h4><ul>
<li><p>字面意思运行循环，作用保持程序的持续运行，处理app中的各种事件（比如触摸事件、定时器事件［NSTimer］、selector事件），节省CPU资源，提高程序性能，有事情就做事情，没事就休息</p>
</li>
<li><p>说明</p>
<ul>
<li>如果没有RunLoop那么程序一启动就会退出，什么吗事情都做不了，有了RunLoop相当于在内部有一个死循环，能够保证程序的持续运行</li>
<li>main韩式中的RunLoop(在UIApplication函数内部就启动了一个RunLoop该函数返回一个int类型的值，这个默认启动的RunLoop是跟主线程相关联的)</li>
</ul>
</li>
<li><p>RunLoop对象</p>
<ul>
<li>在iOS开发中有两套api来访问RunLoop分别是NSRunLoop和CFRunLoopRef</li>
<li>NSRunLoop和CFRunLoopRef都代表着RunLoop对象，它们是等价的，可以互相转换</li>
<li>NSRunLoop是基于CFRunLoopRef的一层OC包装。</li>
</ul>
</li>
<li><p>RunLoop与线程</p>
<ul>
<li>一个RunLoop对应着一条唯一的线程，如果要让子线程不死，必须给这条线程创建一个RunLoop</li>
<li>主线程的RunLoop会自动创建好，子线程的RunLoop需要手动创建</li>
<li>RunLoop在第一次获取的时候创建，在结束线程时销毁</li>
</ul>
<ul>
<li><p>获得RunLoop对象</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获得当前RunLoop对象</span></span><br><span class="line"><span class="comment">//NSRunLoop</span></span><br><span class="line"><span class="built_in">NSRunLoop</span> *runloop1 = [<span class="built_in">NSRunLoop</span> currentRunLoop];</span><br><span class="line"><span class="built_in">CFRunLoopRef</span> runloop2 = <span class="built_in">CGFRunLoopGetCurrent</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">//拿到当前应用程序的主RunLoop(主线程线程对应的RunLoop)</span></span><br><span class="line"><span class="built_in">NSRunLoop</span> *runloopmain1 = [<span class="built_in">NSRunLoop</span> mainRunLoop];</span><br><span class="line"><span class="built_in">CFRunLoopRef</span> runloopmain2 = <span class="built_in">CFRunLoopGetMain</span>();</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">注意：开一个子线程创建runloop不实通过alloc init方法创建，而是直接调用currentRunLoop方法来创建，它本身是一个懒加载创建。</span></span><br><span class="line"><span class="comment">在子线程中，如果不主动获取RunLoop的话，那么子线程内部是不会创建RunLoop的。</span></span><br><span class="line"><span class="comment">RunLoop对象是利用字典来进行存储，而且key是对应的线程Value为该线程队员的RunLoop。</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>RunLoop运行原理图</p>
<p> <img src="/2018/05/10/RunLoop/01.png" alt="原理图"></p>
</li>
<li><p>五个相关的类</p>
 <figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">CFRunloopRef</span></span><br><span class="line"><span class="comment">CFRunloopModeRef(Runloop运行模式)</span></span><br><span class="line"><span class="comment">CFRunloopSourceRef(Runloop要处理的事件源)</span></span><br><span class="line"><span class="comment">CFRunloopTimeRef(Timer事件)</span></span><br><span class="line"><span class="comment">CFRunloopObserverRef(Runloop的监听者)</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>RunLoop和相关类之间的关系图</p>
<p> <img src="/2018/05/10/RunLoop/02.png" alt="相关类之间关系图"></p>
<ul>
<li><p><strong>RunLoop要想跑起来，它的内部必须要有一个mode，这个mode里面必须有source、observer、timer至少要有其中的一个</strong></p>
</li>
<li><p>CFRunloopModeRef</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">CFRunLoopModeRef代表着RunLoop的运行模式</span></span><br><span class="line"><span class="comment">一个RunLoop中可以有多个mode，一个mode里面可以有多个source、observer、timer等等</span></span><br><span class="line"><span class="comment">每次runloop启动的时候，只能制定一个mode，这个mode被称为该RunLoop的当前mode</span></span><br><span class="line"><span class="comment">如果需要切换mode，只能先退出当前RunLoop，再重新制定一个mode进入</span></span><br><span class="line"><span class="comment">这样做主要是为了分割不同组的定时器等，让她们相互之间不受影响</span></span><br><span class="line"><span class="comment">系统默认注册了5个mode</span></span><br><span class="line"><span class="comment">1.kCFRunLoopDefaultMode:App的默认Mode，通常主线程是在这个Mode下运行</span></span><br><span class="line"><span class="comment">2.UITrackingRunLoopMode:界面追踪Mode，用于ScrollView追踪触摸华东，保证节目滑动时不受其他mode影响</span></span><br><span class="line"><span class="comment">3.UIInitializationRunLoopMode:在刚启动App时进入的第一个Mode，启动完成后就不再使用。</span></span><br><span class="line"><span class="comment">4.GSREventReceiveRunLoopMode:接受系统事件的内部mode，通常使用不到</span></span><br><span class="line"><span class="comment">5.KCFRunLoopCommonModes:这是一个占位用的mode，不是一种真正的mode</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>CFRunloopTimerRef</p>
<ul>
<li><p>NSTimer相关代码</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    说明：</span></span><br><span class="line"><span class="comment">    （1）runloop一启动就会选中一种模式，当选中了一种模式之后其它的模式就都不关心，一个mode里面可以添加多个NSTimer,也就是说以后当创建NSTimer的时候，可以指定它是在什么模式下运行的。</span></span><br><span class="line"><span class="comment">    （2）它是基于时间的触发器，说直白点那就是时间到了我就触发一个事件，触发一个操作。基本上说的就是NSTimer</span></span><br><span class="line"><span class="comment">    （3）相关代码</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">- (<span class="keyword">void</span>)timer2</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//NSTimer 调用了scheduledTimer方法，那么会自动添加到当前的runloop里面去，而且runloop的运行模式kCFRunLoopDefaultMode</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">NSTimer</span> *timer = [<span class="built_in">NSTimer</span> scheduledTimerWithTimeInterval:<span class="number">2.0</span> target:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(run) userInfo:<span class="literal">nil</span> repeats:<span class="literal">YES</span>];</span><br><span class="line"></span><br><span class="line">    <span class="comment">//更改模式</span></span><br><span class="line">    [[<span class="built_in">NSRunLoop</span> currentRunLoop] addTimer:timer forMode:<span class="built_in">NSRunLoopCommonModes</span>];</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)timer1</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//    [NSTimer scheduledTimerWithTimeInterval:2.0 target:self selector:@selector(run) userInfo:nil repeats:YES];</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">NSTimer</span> *timer = [<span class="built_in">NSTimer</span> timerWithTimeInterval:<span class="number">2.0</span> target:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(run) userInfo:<span class="literal">nil</span> repeats:<span class="literal">YES</span>];</span><br><span class="line"></span><br><span class="line">    <span class="comment">//定时器添加到UITrackingRunLoopMode模式，一旦runloop切换模式，那么定时器就不工作</span></span><br><span class="line">    <span class="comment">//    [[NSRunLoop currentRunLoop] addTimer:timer forMode:UITrackingRunLoopMode];</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//定时器添加到NSDefaultRunLoopMode模式，一旦runloop切换模式，那么定时器就不工作</span></span><br><span class="line">    <span class="comment">//    [[NSRunLoop currentRunLoop] addTimer:timer forMode:NSDefaultRunLoopMode];</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//占位模式：common modes标记</span></span><br><span class="line">    <span class="comment">//被标记为common modes的模式 kCFRunLoopDefaultMode  UITrackingRunLoopMode</span></span><br><span class="line">    [[<span class="built_in">NSRunLoop</span> currentRunLoop] addTimer:timer forMode:<span class="built_in">NSRunLoopCommonModes</span>];</span><br><span class="line"></span><br><span class="line">    <span class="comment">//    NSLog(@"%@",[NSRunLoop currentRunLoop]);</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)run</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"---run---%@"</span>,[<span class="built_in">NSRunLoop</span> currentRunLoop].currentMode);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">IBAction</span>)btnClick &#123;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"---btnClick---"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><p>GCD中的定时器</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//0.创建一个队列</span></span><br><span class="line">    <span class="built_in">dispatch_queue_t</span> queue = dispatch_get_global_queue(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//1.创建一个GCD的定时器</span></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     第一个参数：说明这是一个定时器</span></span><br><span class="line"><span class="comment">     第四个参数：GCD的回调任务添加到那个队列中执行，如果是主队列则在主线程执行</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    dispatch_source_t timer = dispatch_source_create(DISPATCH_SOURCE_TYPE_TIMER, <span class="number">0</span>, <span class="number">0</span>, queue);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2.设置定时器的开始时间，间隔时间以及精准度</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//设置开始时间，三秒钟之后调用</span></span><br><span class="line">    dispatch_time_t start = dispatch_time(DISPATCH_TIME_NOW,<span class="number">3.0</span> *<span class="built_in">NSEC_PER_SEC</span>);</span><br><span class="line">    <span class="comment">//设置定时器工作的间隔时间</span></span><br><span class="line">    uint64_t intevel = <span class="number">1.0</span> * <span class="built_in">NSEC_PER_SEC</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     第一个参数：要给哪个定时器设置</span></span><br><span class="line"><span class="comment">     第二个参数：定时器的开始时间DISPATCH_TIME_NOW表示从当前开始</span></span><br><span class="line"><span class="comment">     第三个参数：定时器调用方法的间隔时间</span></span><br><span class="line"><span class="comment">     第四个参数：定时器的精准度，如果传0则表示采用最精准的方式计算，如果传大于0的数值，则表示该定时切换i可以接收该值范围内的误差，通常传0</span></span><br><span class="line"><span class="comment">     该参数的意义：可以适当的提高程序的性能</span></span><br><span class="line"><span class="comment">     注意点：GCD定时器中的时间以纳秒为单位（面试）</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    dispatch_source_set_timer(timer, start, intevel, <span class="number">0</span> * <span class="built_in">NSEC_PER_SEC</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//3.设置定时器开启后回调的方法</span></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     第一个参数：要给哪个定时器设置</span></span><br><span class="line"><span class="comment">     第二个参数：回调block</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    dispatch_source_set_event_handler(timer, ^&#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"------%@"</span>,[<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//4.执行定时器</span></span><br><span class="line">    dispatch_resume(timer);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//注意：dispatch_source_t本质上是OC类，在这里是个局部变量，需要强引用</span></span><br><span class="line">    <span class="keyword">self</span>.timer = timer;</span><br><span class="line"></span><br><span class="line">GCD定时器补充</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> DISPATCH_SOURCE_TYPE_TIMER         定时响应（定时器事件）</span></span><br><span class="line"><span class="comment"> DISPATCH_SOURCE_TYPE_SIGNAL        接收到UNIX信号时响应</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> DISPATCH_SOURCE_TYPE_READ          IO操作，如对文件的操作、socket操作的读响应</span></span><br><span class="line"><span class="comment"> DISPATCH_SOURCE_TYPE_WRITE         IO操作，如对文件的操作、socket操作的写响应</span></span><br><span class="line"><span class="comment"> DISPATCH_SOURCE_TYPE_VNODE         文件状态监听，文件被删除、移动、重命名</span></span><br><span class="line"><span class="comment"> DISPATCH_SOURCE_TYPE_PROC          进程监听,如进程的退出、创建一个或更多的子线程、进程收到UNIX信号</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> 下面两个都属于Mach相关事件响应</span></span><br><span class="line"><span class="comment">    DISPATCH_SOURCE_TYPE_MACH_SEND</span></span><br><span class="line"><span class="comment">    DISPATCH_SOURCE_TYPE_MACH_RECV</span></span><br><span class="line"><span class="comment"> 下面两个都属于自定义的事件，并且也是有自己来触发</span></span><br><span class="line"><span class="comment">    DISPATCH_SOURCE_TYPE_DATA_ADD</span></span><br><span class="line"><span class="comment">    DISPATCH_SOURCE_TYPE_DATA_OR</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>CFRunloopSourceRef</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">  1.是事件源也就是输入源，有两种分类模式；</span></span><br><span class="line"><span class="comment">    一种是按照苹果官方文档进行划分的</span></span><br><span class="line"><span class="comment">    另一种是基于函数的调用栈来进行划分的（source0和source1）。</span></span><br><span class="line"><span class="comment">  2.具体的分类情况</span></span><br><span class="line"><span class="comment">      （1）以前的分法</span></span><br><span class="line"><span class="comment">          Port-Based Sources</span></span><br><span class="line"><span class="comment">          Custom Input Sources</span></span><br><span class="line"><span class="comment">          Cocoa Perform Selector Sources</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">      （2）现在的分法</span></span><br><span class="line"><span class="comment">          Source0：非基于Port的</span></span><br><span class="line"><span class="comment">          Source1：基于Port的</span></span><br><span class="line"><span class="comment">  3.可以通过打断点的方式查看一个方法的函数调用栈</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>CFRunLoopObserverRef</p>
<ul>
<li><p>CFRunLoopObserverRef是观察者，能够监听RunLoop的状态改变</p>
</li>
<li><p>如何监听</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建一个runloop监听者</span></span><br><span class="line">   <span class="built_in">CFRunLoopObserverRef</span> observer = <span class="built_in">CFRunLoopObserverCreateWithHandler</span>(<span class="built_in">CFAllocatorGetDefault</span>(),kCFRunLoopAllActivities, <span class="literal">YES</span>, <span class="number">0</span>, ^(<span class="built_in">CFRunLoopObserverRef</span> observer, <span class="built_in">CFRunLoopActivity</span> activity) &#123;</span><br><span class="line">       </span><br><span class="line">       <span class="built_in">NSLog</span>(<span class="string">@"监听runloop状态改变---%zd"</span>,activity);</span><br><span class="line">   &#125;);</span><br><span class="line">       </span><br><span class="line">   <span class="comment">//为runloop添加一个监听者</span></span><br><span class="line">   <span class="built_in">CFRunLoopAddObserver</span>(<span class="built_in">CFRunLoopGetCurrent</span>(), observer, kCFRunLoopDefaultMode);</span><br><span class="line">       </span><br><span class="line">   <span class="built_in">CFRelease</span>(observer);</span><br></pre></td></tr></table></figure>
</li>
<li><p>监听的状态</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="built_in">CF_OPTIONS</span>(<span class="built_in">CFOptionFlags</span>, <span class="built_in">CFRunLoopActivity</span>) &#123;</span><br><span class="line">    kCFRunLoopEntry = (<span class="number">1</span>UL &lt;&lt; <span class="number">0</span>),   <span class="comment">//即将进入Runloop</span></span><br><span class="line">    kCFRunLoopBeforeTimers = (<span class="number">1</span>UL &lt;&lt; <span class="number">1</span>),    <span class="comment">//即将处理NSTimer</span></span><br><span class="line">    kCFRunLoopBeforeSources = (<span class="number">1</span>UL &lt;&lt; <span class="number">2</span>),   <span class="comment">//即将处理Sources</span></span><br><span class="line">    kCFRunLoopBeforeWaiting = (<span class="number">1</span>UL &lt;&lt; <span class="number">5</span>),   <span class="comment">//即将进入休眠</span></span><br><span class="line">    kCFRunLoopAfterWaiting = (<span class="number">1</span>UL &lt;&lt; <span class="number">6</span>),    <span class="comment">//刚从休眠中唤醒</span></span><br><span class="line">    kCFRunLoopExit = (<span class="number">1</span>UL &lt;&lt; <span class="number">7</span>),            <span class="comment">//即将退出runloop</span></span><br><span class="line">    kCFRunLoopAllActivities = <span class="number">0x0FFFFFFF</span>U   <span class="comment">//所有状态改变</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
</li>
<li><p>RunLoop运行逻辑</p>
<p> <strong>RunLoop的事件队列</strong></p>
<p> <strong>每次运行runloop，你线程的runloop会自动处理之前未处理的消息，并通知相关的观察者。具体顺序如下</strong></p>
<ol>
<li><p>通知观察者runloop已经启动</p>
</li>
<li><p>通知观察者任何几件要开始的定时器</p>
</li>
<li><p>通知观察者任何即将启动的非基于端口的源</p>
</li>
<li><p>启动任何准好的非基于端口的源</p>
</li>
<li><p>如果基于端口的源准备好并处于等待状态，立即启动，并进入步骤9</p>
</li>
<li><p>通知观察者进入休眠</p>
</li>
<li><p>将线程置于休眠到任何下一个事件发生</p>
<ul>
<li>某一事件到达基于端口的源</li>
<li>定时器启动</li>
<li>runloop设置的时间已经超时</li>
<li>runloop被显示唤醒</li>
</ul>
</li>
<li><p>通知观察者线程被唤醒</p>
</li>
<li><p>处理未处理的时间</p>
<ul>
<li>如果用户定义的定时器启动，处理定时器事件并重启run loop。进入步骤2</li>
<li>如果输入源启动，传递相应消息</li>
<li>如果run loop被显示唤醒而且时间还没超时，重启run loop。进入步骤2</li>
</ul>
</li>
<li><p>通知观察者run loop结束。</p>
<p><img src="/2018/05/10/RunLoop/03.png" alt=""></p>
</li>
</ol>
</li>
</ul>
]]></content>
      
        <categories>
            
            <category> iOS开发 </category>
            
        </categories>
        
        
        <tags>
            
            <tag> iOS </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[iOS多线程]]></title>
      <url>/2018/05/09/iOS%E5%A4%9A%E7%BA%BF%E7%A8%8B/</url>
      <content type="html"><![CDATA[<h4 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h4><ul>
<li>进程<ul>
<li>进程是指在系统中正在运行的一个应用程序。每个进程之间是独立的，每个进程均运行在其专用并且受保护的内存内。</li>
</ul>
</li>
<li>线程<ul>
<li>一个进程想要执行任务，必须至少要有一个线程，也可以有多条线程，线程是进程的基本执行单位。</li>
<li>线程的串行<ul>
<li>一个进程中有多条线程，这些线程是一个个顺序执行这些任务。<ul>
<li>线程的并行</li>
<li>一个进程中有多条线程，这些线程是同时执行这些任务。其实在同一时间内，CPU只能处理一条线程，只有一条线程执行，并发同时执行是CPU在多条线程之间快速切换，只是CPU调度速度足够快，造成了同时并发执行的假象。</li>
<li>多线程优缺点</li>
<li>优点<ul>
<li>能适当提高程序的执行效率</li>
<li>能适当提高资源利用率（CPU，内存利用率）</li>
</ul>
</li>
<li>缺点<ul>
<li>开启线程需要占用一定的内存空间（如果开启大量的线程，会占用大量的内存空间，降低程序的性能）</li>
<li>线程越多，CPU在调度线程上的开销就越大</li>
<li>程序设计更加复杂：比如线程之间的通信、多线程的数据共享</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>多线程在iOS开发中的应用<ul>
<li>主线程<ul>
<li>一个iOS程序运行后，会默认开启1条线程，称为主线程或UI线程</li>
<li>作用是刷新UI，处理UI事件</li>
</ul>
</li>
<li>使用注意<ul>
<li>不要将耗时的操作放到主线程中去处理，会卡住线程</li>
<li>和UI相关的刷新操作必须放到主线程中进行处理</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="iOS中多线程的实现方案"><a href="#iOS中多线程的实现方案" class="headerlink" title="iOS中多线程的实现方案"></a>iOS中多线程的实现方案</h4><ol>
<li><p>pthread</p>
<ul>
<li><p>一套通用的多线程API，适用于Unix\Linux\Windows等系统，跨平台\可移植，使用难度较大，使用频率较低，线程生命周期由程序员进行管理</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">说明：pthread的基本使用（需要包含头文件）</span><br><span class="line">    <span class="comment">//使用pthread创建线程对象</span></span><br><span class="line">    pthread_t thread;</span><br><span class="line">    <span class="built_in">NSString</span> *name = <span class="string">@"abcd"</span>;</span><br><span class="line">    <span class="comment">//使用pthread创建线程</span></span><br><span class="line">    <span class="comment">//第一个参数：线程对象地址</span></span><br><span class="line">    <span class="comment">//第二个参数：线程属性</span></span><br><span class="line">    <span class="comment">//第三个参数：指向函数的指针</span></span><br><span class="line">    <span class="comment">//第四个参数：传递给该函数的参数</span></span><br><span class="line">    pthread_create(&amp;thread, <span class="literal">NULL</span>, run, (__bridge <span class="keyword">void</span> *)(name));</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
<ol>
<li><p>NSThread</p>
<ul>
<li><p>使用面向对象，简单易用，，可直接操作线程对象，使用OC对象，使用频率偶尔使用，线程生命周期由程序员进行管理</p>
</li>
<li><p>基本使用</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//第一种创建线程的方式：alloc init.</span></span><br><span class="line"><span class="comment">//特点：需要手动开启线程，可以拿到线程对象进行详细设置</span></span><br><span class="line">    <span class="comment">//创建线程</span></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     第一个参数：目标对象</span></span><br><span class="line"><span class="comment">     第二个参数：选择器，线程启动要调用哪个方法</span></span><br><span class="line"><span class="comment">     第三个参数：前面方法要接收的参数（最多只能接收一个参数，没有则传nil）</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="built_in">NSThread</span> *thread = [[<span class="built_in">NSThread</span> alloc]initWithTarget:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(run:) object:<span class="string">@"abcd"</span>];</span><br><span class="line">     <span class="comment">//启动线程</span></span><br><span class="line">    [thread start];</span><br><span class="line"></span><br><span class="line"><span class="comment">//第二种创建线程的方式：分离出一条子线程</span></span><br><span class="line"><span class="comment">//特点：自动启动线程，无法对线程进行更详细的设置</span></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     第一个参数：线程启动调用的方法</span></span><br><span class="line"><span class="comment">     第二个参数：目标对象</span></span><br><span class="line"><span class="comment">     第三个参数：传递给调用方法的参数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    [<span class="built_in">NSThread</span> detachNewThreadSelector:<span class="keyword">@selector</span>(run:) toTarget:<span class="keyword">self</span> withObject:<span class="string">@"我是分离出来的子线程"</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">//第三种创建线程的方式：后台线程</span></span><br><span class="line"><span class="comment">//特点：自动启动县城，无法进行更详细设置</span></span><br><span class="line">[<span class="keyword">self</span> performSelectorInBackground:<span class="keyword">@selector</span>(run:) withObject:<span class="string">@"我是后台线程"</span>];</span><br></pre></td></tr></table></figure>
</li>
<li><p>设置线程的属性</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//设置线程的属性</span></span><br><span class="line"><span class="comment">//设置线程的名称</span></span><br><span class="line">thread.name = <span class="string">@"线程A"</span>;</span><br><span class="line"><span class="comment">//设置线程的优先级,注意线程优先级的取值范围为0.0~1.0之间，1.0表示线程的优先级最高,如果不设置该值，那么理想状态下默认为0.5</span></span><br><span class="line">thread.threadPriority = <span class="number">1.0</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>线程的状态</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//线程的各种状态：新建-就绪－运行－阻塞－死亡</span></span><br><span class="line"><span class="comment">//常用控制线程状态的方法</span></span><br><span class="line">[<span class="built_in">NSThread</span> exit];<span class="comment">//退出当前线程</span></span><br><span class="line">[<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">2.0</span>];<span class="comment">//阻塞线程</span></span><br><span class="line">[<span class="built_in">NSThread</span> sleepUntiDate:[<span class="built_in">NSDate</span> dateWithTimeIntervalSinceNow:<span class="number">2.0</span>]];<span class="comment">//阻塞线程</span></span><br><span class="line"><span class="comment">//注意线程死了就不能复生</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>线程安全</p>
<pre><code>- 多个线程访问同一块资源会发生数据安全问题，解决方法为加互斥锁，@synchronized(self){}，线程同步
</code></pre></li>
<li><p>线程间通信</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">-(<span class="keyword">void</span>)touchesBegan:(<span class="keyword">nonnull</span> <span class="built_in">NSSet</span>&lt;<span class="built_in">UITouch</span> *&gt; *)touches withEvent:(<span class="keyword">nullable</span> <span class="built_in">UIEvent</span> *)event</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//    [self download2];</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//开启一条子线程来下载图片</span></span><br><span class="line">    [<span class="built_in">NSThread</span> detachNewThreadSelector:<span class="keyword">@selector</span>(downloadImage) toTarget:<span class="keyword">self</span> withObject:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">-(<span class="keyword">void</span>)downloadImage</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//1.确定要下载网络图片的url地址，一个url唯一对应着网络上的一个资源</span></span><br><span class="line">    <span class="built_in">NSURL</span> *url = [<span class="built_in">NSURL</span> URLWithString:<span class="string">@"图片地址"</span>];</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2.根据url地址下载图片数据到本地（二进制数据</span></span><br><span class="line">    <span class="built_in">NSData</span> *data = [<span class="built_in">NSData</span> dataWithContentsOfURL:url];</span><br><span class="line"></span><br><span class="line">    <span class="comment">//3.把下载到本地的二进制数据转换成图片</span></span><br><span class="line">    <span class="built_in">UIImage</span> *image = [<span class="built_in">UIImage</span> imageWithData:data];</span><br><span class="line"></span><br><span class="line">    <span class="comment">//4.回到主线程刷新UI</span></span><br><span class="line">    <span class="comment">//4.1 第一种方式</span></span><br><span class="line"><span class="comment">//    [self performSelectorOnMainThread:@selector(showImage:) withObject:image waitUntilDone:YES];</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//4.2 第二种方式</span></span><br><span class="line"><span class="comment">//    [self.imageView performSelectorOnMainThread:@selector(setImage:) withObject:image waitUntilDone:YES];</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//4.3 第三种方式</span></span><br><span class="line">    [<span class="keyword">self</span>.imageView performSelector:<span class="keyword">@selector</span>(setImage:) onThread:[<span class="built_in">NSThread</span> mainThread] withObject:image waitUntilDone:<span class="literal">YES</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
<ol>
<li><p>GCD</p>
<ul>
<li><p>替代NSThread等多线程技术，充分利用设备的多核（自动）使用语言C语言，使用频率经常使用，线程生命周期为自动管理</p>
</li>
<li><p>两个核心概念队列和任务，同步函数和异步函数</p>
</li>
<li><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">01 异步函数+并发队列：开启多条线程，并发执行任务</span></span><br><span class="line"><span class="comment">02 异步函数+串行队列：开启一条线程，串行执行任务</span></span><br><span class="line"><span class="comment">03 同步函数+并发队列：不开线程，串行执行任务</span></span><br><span class="line"><span class="comment">04 同步函数+串行队列：不开线程，串行执行任务</span></span><br><span class="line"><span class="comment">05 异步函数+主队列：不开线程，在主线程中串行执行任务</span></span><br><span class="line"><span class="comment">06 同步函数+主队列：不开线程，串行执行任务（注意死锁发生）</span></span><br><span class="line"><span class="comment">07 注意同步函数和异步函数在执行顺序上面的差异</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>GCD线程间通信</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//0.获取一个全局的队列</span></span><br><span class="line">   <span class="built_in">dispatch_queue_t</span> queue = dispatch_get_global_queue(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">       </span><br><span class="line">   <span class="comment">//1.先开启一个线程，把下载图片的操作放在子线程中处理</span></span><br><span class="line">   <span class="built_in">dispatch_async</span>(queue, ^&#123;</span><br><span class="line">       </span><br><span class="line">      <span class="comment">//2.下载图片</span></span><br><span class="line">       <span class="built_in">NSURL</span> *url = [<span class="built_in">NSURL</span> URLWithString:<span class="string">@"http://h.hiphotos.baidu.com/zhidao/pic/item/6a63f6246b600c3320b14bb3184c510fd8f9a185.jpg"</span>];</span><br><span class="line">       <span class="built_in">NSData</span> *data = [<span class="built_in">NSData</span> dataWithContentsOfURL:url];</span><br><span class="line">       <span class="built_in">UIImage</span> *image = [<span class="built_in">UIImage</span> imageWithData:data];</span><br><span class="line">       </span><br><span class="line">       <span class="built_in">NSLog</span>(<span class="string">@"下载操作所在的线程--%@"</span>,[<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">       </span><br><span class="line">       <span class="comment">//3.回到主线程刷新UI</span></span><br><span class="line">       <span class="built_in">dispatch_async</span>(dispatch_get_main_queue(), ^&#123;</span><br><span class="line">          <span class="keyword">self</span>.imageView.image = image;</span><br><span class="line">          <span class="comment">//打印查看当前线程</span></span><br><span class="line">           <span class="built_in">NSLog</span>(<span class="string">@"刷新UI---%@"</span>,[<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">       &#125;);</span><br><span class="line">       </span><br><span class="line">   &#125;);</span><br></pre></td></tr></table></figure>
</li>
<li><p>GCD常见函数</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//栅栏函数（控制任务的执行顺序）</span></span><br><span class="line">dispatch_barrier_async(queue, ^&#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"--dispatch_barrier_async-"</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//延迟执行（延迟·控制在哪个线程执行）</span></span><br><span class="line">dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(<span class="number">2.0</span> * <span class="built_in">NSEC_PER_SEC</span>)), dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="number">0</span>), ^&#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"---%@"</span>,[<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 一次性代码（注意不能放到懒加载）</span></span><br><span class="line">-(<span class="keyword">void</span>)once</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//整个程序运行过程中只会执行一次</span></span><br><span class="line">        <span class="comment">//onceToken用来记录该部分的代码是否被执行过</span></span><br><span class="line">        <span class="keyword">static</span> <span class="built_in">dispatch_once_t</span> onceToken;</span><br><span class="line">        <span class="built_in">dispatch_once</span>(&amp;onceToken, ^&#123;</span><br><span class="line"></span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@"-----"</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//快速迭代（开多个线程并发完成迭代操作）</span></span><br><span class="line"> dispatch_apply(subpaths.count, queue, ^(size_t index) &#123;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//队列组（同栅栏函数）</span></span><br><span class="line">    <span class="comment">//创建队列组</span></span><br><span class="line">    dispatch_group_t group = dispatch_group_create();</span><br><span class="line">    <span class="comment">//队列组中的任务执行完毕之后，执行该函数</span></span><br><span class="line">    dispatch_group_notify(dispatch_group_t group,<span class="built_in">dispatch_queue_t</span> queue,dispatch_block_t block);</span><br><span class="line"></span><br><span class="line"> <span class="comment">//进入群组和离开群组</span></span><br><span class="line">    dispatch_group_enter(group);<span class="comment">//执行该函数后，后面异步执行的block会被gruop监听</span></span><br><span class="line">    dispatch_group_leave(group);<span class="comment">//异步block中，所有的任务都执行完毕，最后离开群组</span></span><br><span class="line">    <span class="comment">//注意：dispatch_group_enter|dispatch_group_leave必须成对使用</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
<ol>
<li><p>NSOperation</p>
<ul>
<li><p>基于GCD（底层是GCD）比GCD多了一些更简单实用的功能，使用更加面向对象，使用语言为OC语言，使用频率经常使用，线程生命周期为自动管理</p>
</li>
<li><p>两个核心概念队列和操作</p>
</li>
<li><p>NSOperation本身是抽象类，只能使用它的子类，三个子类分别是：NSBlockOperation、NSINvocationOperation以及自定义继承自NSOperation的类，NSOperation和NSOperationQueue结合实现多线程并发</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//NSInvocationOperation</span></span><br><span class="line"><span class="comment">//封装操作</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">第一个参数：目标对象</span></span><br><span class="line"><span class="comment">第二个参数：该操作要调用的方法，最大接受一个参数</span></span><br><span class="line"><span class="comment">第三个参数：调用方法传递的参数，如果方法不接受参数，那么该值传nil</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="built_in">NSInvocationOperation</span> ＊operation ＝ [<span class="built_in">NSInvocationOperation</span> alloc]initWithTarget:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(run) object:<span class="literal">nil</span>];</span><br><span class="line"><span class="comment">//启动操作</span></span><br><span class="line">[operation start];</span><br><span class="line"></span><br><span class="line"><span class="comment">//--------------------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//NSBlockOperation</span></span><br><span class="line"><span class="comment">//封装操作 NSBlockOperation提供了一个类方法，在该类方法中封装操作</span></span><br><span class="line"><span class="built_in">NSBlockOperation</span> *operation = [<span class="built_in">NSBlockOperation</span> blockOperationWithBlock:^&#123;</span><br><span class="line">   <span class="comment">//在主线程中执行</span></span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"--download1--"</span>,[<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">&#125;];</span><br><span class="line"><span class="comment">//追加操作，追加的操作在子线程中执行</span></span><br><span class="line">[operaction addExecutionBlock:^&#123;</span><br><span class="line">   <span class="built_in">NSLog</span>(<span class="string">@"--download2--"</span>,[<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">&#125;];</span><br><span class="line">[operaction addExecutionBlock:^&#123;</span><br><span class="line">   <span class="built_in">NSLog</span>(<span class="string">@"--download3--"</span>,[<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">&#125;];</span><br><span class="line"><span class="comment">//启动执行操作</span></span><br><span class="line">[operation start];</span><br><span class="line"></span><br><span class="line"><span class="comment">//--------------------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//自定义NSOperation</span></span><br><span class="line"><span class="comment">//继承NSOperation，通过充血内部的main方法实现封装操作</span></span><br><span class="line">- (<span class="keyword">void</span>)main</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"--main--%@"</span>,[<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">&#125;</span><br><span class="line">[op start];</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>NSOperationQueue基本使用</p>
<ul>
<li>NSOperationQueue中的两种队列<ul>
<li>主队列 通过mainQueue获得，凡是放到主队列中的任务都在主线程执行</li>
<li>非主队列 直接alloc init出来的队列。非主队列同时具备了并发和串行的功能，通过设置最大并发数属性来控制任务是并发执行还是串行执行。</li>
</ul>
</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//自定义NSOperation</span></span><br><span class="line">- (<span class="keyword">void</span>)customOperation</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//创建队列</span></span><br><span class="line">    <span class="built_in">NSOperationQueue</span> ＊queue = [<span class="built_in">NSOperationQueue</span> alloc]init];</span><br><span class="line">    </span><br><span class="line">    MyOperation *op1 = [MyOperation alloc]init];</span><br><span class="line">    MyOperation *op2 = [MyOperation alloc]init];</span><br><span class="line">    </span><br><span class="line">    [queue addOperation:op1];</span><br><span class="line">    [queue addOperation:op2];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//NSBlockOperation</span></span><br><span class="line">- (<span class="keyword">void</span>)block</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//创建队列</span></span><br><span class="line">    <span class="built_in">NSOperationQueue</span> ＊queue = [<span class="built_in">NSOperationQueue</span> alloc]init];</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSBlockOperation</span> *op1 = [<span class="built_in">NSBlockOperation</span> blockOperationWIthBlock:^&#123;</span><br><span class="line">       <span class="built_in">NSLog</span>(<span class="string">@"1-------%@"</span>,[<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">    &#125;];</span><br><span class="line">    <span class="built_in">NSBlockOperation</span> *op2 = [<span class="built_in">NSBlockOperation</span> blockOperationWIthBlock:^&#123;</span><br><span class="line">       <span class="built_in">NSLog</span>(<span class="string">@"2-------%@"</span>,[<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">    &#125;];</span><br><span class="line">    [op2 addExecutionBlock:^&#123;</span><br><span class="line">       <span class="built_in">NSLog</span>(<span class="string">@"3-------%@"</span>,[<span class="built_in">NSThread</span> currentThread]); </span><br><span class="line">    &#125;];</span><br><span class="line">     [op2 addExecutionBlock:^&#123;</span><br><span class="line">       <span class="built_in">NSLog</span>(<span class="string">@"4-------%@"</span>,[<span class="built_in">NSThread</span> currentThread]); </span><br><span class="line">    &#125;];</span><br><span class="line">    </span><br><span class="line">    [queue addOperation:op1];</span><br><span class="line">    [queue addOperation:op2];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//简便方法</span></span><br><span class="line">    [queue addOperationWithBlock:^&#123;</span><br><span class="line">       <span class="built_in">NSLog</span>(<span class="string">@"5------%@"</span>,[<span class="built_in">NSThread</span> currentThread]); </span><br><span class="line">    &#125;];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//NSInvocationOperation</span></span><br><span class="line">- (<span class="keyword">void</span>)invocation</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     GCD中的队列：</span></span><br><span class="line"><span class="comment">     串行队列：自己创建的，主队列</span></span><br><span class="line"><span class="comment">     并发队列：自己创建的，全局并发队列</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">     NSOperationQueue</span></span><br><span class="line"><span class="comment">     主队列：[NSOperationQueue mainqueue];凡事放在主队列中的操作都在主线程中执行</span></span><br><span class="line"><span class="comment">     非主队列：[[NSOperationQueue alloc]init]，并发和串行，默认是并发执行的</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//1.创建队列</span></span><br><span class="line">    <span class="built_in">NSOperationQueue</span> *queue = [[<span class="built_in">NSOperationQueue</span> alloc]init];</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2.封装操作</span></span><br><span class="line">    <span class="built_in">NSInvocationOperation</span> *op1 = [[<span class="built_in">NSInvocationOperation</span> alloc]initWithTarget:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(download1) object:<span class="literal">nil</span>];</span><br><span class="line"></span><br><span class="line">    <span class="built_in">NSInvocationOperation</span> *op2 = [[<span class="built_in">NSInvocationOperation</span> alloc]initWithTarget:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(download2) object:<span class="literal">nil</span>];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="built_in">NSInvocationOperation</span> *op3 = [[<span class="built_in">NSInvocationOperation</span> alloc]initWithTarget:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(download3) object:<span class="literal">nil</span>];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//3.把封装好的操作添加到队列中</span></span><br><span class="line">    [queue addOperation:op1];<span class="comment">//[op1 start]</span></span><br><span class="line">    [queue addOperation:op2];</span><br><span class="line">    [queue addOperation:op3];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>NSOperation其它用法</p>
<ul>
<li><p>设置最大并发数（控制任务并发和串行）</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建队列</span></span><br><span class="line">    <span class="built_in">NSOperationQueue</span> *queue = [[<span class="built_in">NSOperationQueue</span> alloc]init];</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2.设置最大并发数</span></span><br><span class="line">    <span class="comment">//注意点：该属性需要在任务添加到队列中之前进行设置</span></span><br><span class="line">    <span class="comment">//该属性控制队列是串行执行还是并发执行</span></span><br><span class="line">    <span class="comment">//如果最大并发数等于1，那么该队列是串行的，如果大于1那么是并行的</span></span><br><span class="line">    <span class="comment">//系统的最大并发数有个默认的值，为-1，如果该属性设置为0，那么不会执行任何任务</span></span><br><span class="line">    queue.maxConcurrentOperationCount = <span class="number">2</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>暂停和恢复以及取消</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">  <span class="comment">//设置暂停和恢复</span></span><br><span class="line">    <span class="comment">//suspended设置为YES表示暂停，suspended设置为NO表示恢复</span></span><br><span class="line">    <span class="comment">//暂停表示不继续执行队列中的下一个任务，暂停操作是可以恢复的</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.queue.isSuspended) &#123;</span><br><span class="line">        <span class="keyword">self</span>.queue.suspended = <span class="literal">NO</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">self</span>.queue.suspended = <span class="literal">YES</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//取消队列里面的所有操作</span></span><br><span class="line">    <span class="comment">//取消之后，当前正在执行的操作的下一个操作将不再执行，而且永远都不在执行，就像后面的所有任务都从队列里面移除了一样</span></span><br><span class="line">    <span class="comment">//取消操作是不可以恢复的</span></span><br><span class="line">    [<span class="keyword">self</span>.queue cancelAllOperations];</span><br><span class="line"></span><br><span class="line">---------自定义<span class="built_in">NSOperation</span>取消操作--------------------------</span><br><span class="line">-(<span class="keyword">void</span>)main</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//耗时操作1</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i&lt;<span class="number">1000</span>; i++) &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"任务1-%d--%@"</span>,i,[<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"+++++++++++++++++++++++++++++++++"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//苹果官方建议，每当执行完一次耗时操作之后，就查看一下当前队列是否为取消状态，如果是，那么就直接退出</span></span><br><span class="line">    <span class="comment">//好处是可以提高程序的性能</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.isCancelled) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//耗时操作2</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i&lt;<span class="number">1000</span>; i++) &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"任务1-%d--%@"</span>,i,[<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"+++++++++++++++++++++++++++++++++"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>NSOperation实现线程间通信</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.创建队列</span></span><br><span class="line">   <span class="built_in">NSOperationQueue</span> *queue = [[<span class="built_in">NSOperationQueue</span> alloc]init];</span><br><span class="line">         </span><br><span class="line">   <span class="comment">//2.使用简便方法封装操作并添加到队列中</span></span><br><span class="line">   [queue addOperationWithBlock:^&#123;</span><br><span class="line">         </span><br><span class="line">       <span class="comment">//3.在该block中下载图片</span></span><br><span class="line">       <span class="built_in">NSURL</span> *url = [<span class="built_in">NSURL</span> URLWithString:<span class="string">@"http://news.51sheyuan.com/uploads/allimg/111001/133442IB-2.jpg"</span>];</span><br><span class="line">       <span class="built_in">NSData</span> *data = [<span class="built_in">NSData</span> dataWithContentsOfURL:url];</span><br><span class="line">       <span class="built_in">UIImage</span> *image = [<span class="built_in">UIImage</span> imageWithData:data];</span><br><span class="line">       <span class="built_in">NSLog</span>(<span class="string">@"下载图片操作--%@"</span>,[<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">         </span><br><span class="line">       <span class="comment">//4.回到主线程刷新UI</span></span><br><span class="line">       [[<span class="built_in">NSOperationQueue</span> mainQueue] addOperationWithBlock:^&#123;</span><br><span class="line">           <span class="keyword">self</span>.imageView.image = image;</span><br><span class="line">           <span class="built_in">NSLog</span>(<span class="string">@"刷新UI操作---%@"</span>,[<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">       &#125;];</span><br><span class="line">   &#125;];</span><br></pre></td></tr></table></figure>
</li>
<li><p>操作依赖</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">/<span class="number">02</span> 综合案例</span><br><span class="line">- (<span class="keyword">void</span>)download2</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"----"</span>);</span><br><span class="line">    <span class="comment">//1.创建队列</span></span><br><span class="line">    <span class="built_in">NSOperationQueue</span> *queue = [[<span class="built_in">NSOperationQueue</span> alloc]init];</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2.封装操作下载图片1</span></span><br><span class="line">    <span class="built_in">NSBlockOperation</span> *op1 = [<span class="built_in">NSBlockOperation</span> blockOperationWithBlock:^&#123;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">NSURL</span> *url = [<span class="built_in">NSURL</span> URLWithString:<span class="string">@"http://h.hiphotos.baidu.com/zhidao/pic/item/6a63f6246b600c3320b14bb3184c510fd8f9a185.jpg"</span>];</span><br><span class="line">        <span class="built_in">NSData</span> *data = [<span class="built_in">NSData</span> dataWithContentsOfURL:url];</span><br><span class="line"></span><br><span class="line">        <span class="comment">//拿到图片数据</span></span><br><span class="line">        <span class="keyword">self</span>.image1 = [<span class="built_in">UIImage</span> imageWithData:data];</span><br><span class="line">    &#125;];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//3.封装操作下载图片2</span></span><br><span class="line">    <span class="built_in">NSBlockOperation</span> *op2 = [<span class="built_in">NSBlockOperation</span> blockOperationWithBlock:^&#123;</span><br><span class="line">        <span class="built_in">NSURL</span> *url = [<span class="built_in">NSURL</span> URLWithString:<span class="string">@"http://pic.58pic.com/58pic/13/87/82/27Q58PICYje_1024.jpg"</span>];</span><br><span class="line">        <span class="built_in">NSData</span> *data = [<span class="built_in">NSData</span> dataWithContentsOfURL:url];</span><br><span class="line"></span><br><span class="line">        <span class="comment">//拿到图片数据</span></span><br><span class="line">        <span class="keyword">self</span>.image2 = [<span class="built_in">UIImage</span> imageWithData:data];</span><br><span class="line">    &#125;];</span><br><span class="line"></span><br><span class="line">    <span class="comment">//4.合成图片</span></span><br><span class="line">    <span class="built_in">NSBlockOperation</span> *combine = [<span class="built_in">NSBlockOperation</span> blockOperationWithBlock:^&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4.1 开启图形上下文</span></span><br><span class="line">        <span class="built_in">UIGraphicsBeginImageContext</span>(<span class="built_in">CGSizeMake</span>(<span class="number">200</span>, <span class="number">200</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4.2 画image1</span></span><br><span class="line">        [<span class="keyword">self</span>.image1 drawInRect:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">200</span>, <span class="number">100</span>)];</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4.3 画image2</span></span><br><span class="line">        [<span class="keyword">self</span>.image2 drawInRect:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">100</span>, <span class="number">200</span>, <span class="number">100</span>)];</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4.4 根据图形上下文拿到图片数据</span></span><br><span class="line">        <span class="built_in">UIImage</span> *image = <span class="built_in">UIGraphicsGetImageFromCurrentImageContext</span>();</span><br><span class="line"><span class="comment">//        NSLog(@"%@",image);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//4.5 关闭图形上下文</span></span><br><span class="line">        <span class="built_in">UIGraphicsEndImageContext</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//7.回到主线程刷新UI</span></span><br><span class="line">        [[<span class="built_in">NSOperationQueue</span> mainQueue]addOperationWithBlock:^&#123;</span><br><span class="line">            <span class="keyword">self</span>.imageView.image = image;</span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@"刷新UI---%@"</span>,[<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">        &#125;];</span><br><span class="line"></span><br><span class="line">    &#125;];</span><br><span class="line"></span><br><span class="line">    <span class="comment">//5.设置操作依赖</span></span><br><span class="line">    [combine addDependency:op1];</span><br><span class="line">    [combine addDependency:op2];</span><br><span class="line"></span><br><span class="line">    <span class="comment">//6.添加操作到队列中执行</span></span><br><span class="line">    [queue addOperation:op1];</span><br><span class="line">    [queue addOperation:op2];</span><br><span class="line">    [queue addOperation:combine];</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
</li>
</ol>
]]></content>
      
        <categories>
            
            <category> iOS开发 </category>
            
        </categories>
        
        
        <tags>
            
            <tag> iOS </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[UIApplication对象]]></title>
      <url>/2018/03/17/UIApplication%E5%AF%B9%E8%B1%A1/</url>
      <content type="html"><![CDATA[<h5 id="UIApplication单例"><a href="#UIApplication单例" class="headerlink" title="UIApplication单例"></a>UIApplication单例</h5><ul>
<li><p>什么是UIApplication?</p>
<ul>
<li>UIApplication是兑现的应用程序象征，每一个应用都有自己的UIApplication对象，这个对象是系统自动帮我们创建的，它是一个单例对象。一个iOS程序启动后创建的第一个对象就是UIApplication对象，我们只能通过<code>[UIApplication sharedApplication]</code>获得这个单例对象，不能手动创建它</li>
</ul>
</li>
<li><p>UIApplication作用（利用UIApplication对象能进行一些应用级别的操作）</p>
<ul>
<li>可以设置应用程序图标右上角的红色提醒数字</li>
<li>可以设置程序联网指示器的可见性</li>
<li>可以设置应用程序的状态栏</li>
<li>可以进行应用之间的跳转</li>
</ul>
</li>
<li><p>模仿UIApplication单例</p>
<ul>
<li><p>要求</p>
<ul>
<li>程序一启动就创建创建对象.创建的对象只能通过share的方式获取对象.不能够进行alloc 操作,当执行alloc时, 程序发生崩溃</li>
</ul>
</li>
<li><p>代码实现</p>
<ol>
<li><p>程序一启动时候就创建对象</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//当类被加载到内存的时候就会调用load的方法,它会比main优先调用</span></span><br><span class="line"><span class="keyword">static</span> Persion *_instance;</span><br><span class="line">+(<span class="keyword">void</span>)load&#123;</span><br><span class="line">     想要保存创建的对象, 要用成员属性,但是现在是类方法, 没有办法访问成员属性.</span><br><span class="line">     所以搞了一个<span class="keyword">static</span>的静态变量进行保存</span><br><span class="line">     创建对象</span><br><span class="line">     _instance = [[<span class="keyword">self</span> alloc] init];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>保证调用alloc时会产生异常.</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//重写系统的是alloc方法</span></span><br><span class="line">+(<span class="keyword">instancetype</span>)alloc&#123;</span><br><span class="line">     当调用alloc方法时,先查看一下_instance有没有值,如果已经有值的话,直接抛出异常.</span><br><span class="line">     <span class="keyword">if</span>(_instance)&#123;</span><br><span class="line">          <span class="built_in">NSException</span> *exception = [<span class="built_in">NSException</span> exceptionWithName:</span><br><span class="line">          <span class="string">@"NSInternalInconsistencyException"</span></span><br><span class="line">          reason:</span><br><span class="line">          <span class="string">@"There can only be one Persion instance."</span> userInfo:<span class="literal">nil</span>];</span><br><span class="line">          抛出异常</span><br><span class="line">          [exception raise];</span><br><span class="line">     &#125;</span><br><span class="line">          保持系统的做法.</span><br><span class="line">          <span class="keyword">return</span> [<span class="keyword">super</span> alloc];</span><br><span class="line">     &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>通过share方式获取对象</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">+(<span class="keyword">instancetype</span>)sharePersion&#123;</span><br><span class="line">     <span class="keyword">return</span> _instance</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
</li>
</ul>
</li>
</ul>
<h4 id="UIApplication功能"><a href="#UIApplication功能" class="headerlink" title="UIApplication功能"></a>UIApplication功能</h4><ul>
<li><p>设置应用提醒数字</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取UIApplication对象</span></span><br><span class="line"><span class="built_in">UIApplication</span> *ap = [<span class="built_in">UIApplication</span> sharedApplication];</span><br><span class="line"><span class="comment">//在设置之前, 要注册一个通知,从ios8之后,都要先注册一个通知对象.才能够接收到提醒.</span></span><br><span class="line"><span class="built_in">UIUserNotificationSettings</span> *notice = [<span class="built_in">UIUserNotificationSettings</span>  settingsForTypes:<span class="built_in">UIUserNotificationTypeBadge</span> categories:<span class="literal">nil</span>];</span><br><span class="line"><span class="comment">//注册通知对象</span></span><br><span class="line">[ap registerUserNotificationSettings:notice];</span><br><span class="line"><span class="comment">//设置提醒数字</span></span><br><span class="line">ap.applicationIconBadgeNumber = <span class="number">10</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>设置联网状态</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ap.networkActivityIndicatorVisible = <span class="literal">YES</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>设置状态栏</p>
<ul>
<li><p>控制器管理状态栏</p>
<ul>
<li><p>状态栏样式</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//应用程序的状态栏,默认是交给控制器来管理的.控制器提供的方法,可以直接重写这个方法在控制器当中设置状态栏样式</span></span><br><span class="line">-(<span class="built_in">UIStatusBarStyle</span>)preferredStatusBarStyle&#123;</span><br><span class="line">     <span class="keyword">return</span> <span class="built_in">UIStatusBarStyleLightContent</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>隐藏状态栏</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//隐藏状态栏,通过控制器的方式.同样实现方法:返回NO时为不隐藏返回YES时为显示</span></span><br><span class="line">-(<span class="built_in">BOOL</span>)prefersStatusBarHidden&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">NO</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>通过UIApplication来管理状态.</p>
<ul>
<li><p>状态栏样式</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取UIApplication</span></span><br><span class="line"><span class="built_in">UIApplication</span> *ap = [<span class="built_in">UIApplication</span> sharedApplication];</span><br><span class="line"><span class="comment">//设置状态栏样式.</span></span><br><span class="line">ap.statusBarStyle = <span class="built_in">UIStatusBarStyleLightContent</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>隐藏状态栏</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取UIApplication</span></span><br><span class="line"><span class="built_in">UIApplication</span> *ap = [<span class="built_in">UIApplication</span> sharedApplication];</span><br><span class="line"><span class="comment">//设置状态的隐藏</span></span><br><span class="line">ap.statusBarHidden = <span class="literal">YES</span>;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>跳转网页,打电话,发短信</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">UIApplication</span> *ap = [<span class="built_in">UIApplication</span> sharedApplication];</span><br><span class="line"><span class="comment">//URL:协议头://域名</span></span><br><span class="line"><span class="comment">//应用程序通过协议头的类型,去打开相应的软件.</span></span><br><span class="line"><span class="built_in">NSURL</span> *url =[<span class="built_in">NSURL</span> URLWithString:<span class="string">@"http://www.baidu.com"</span>];</span><br><span class="line">[ap openURL:url];</span><br></pre></td></tr></table></figure>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">UIApplication</span> *app = [<span class="built_in">UIApplication</span> sharedApplication];</span><br><span class="line">[application openURL:[<span class="built_in">NSURL</span> URLWithString:<span class="string">@"tel://10086"</span>]];</span><br></pre></td></tr></table></figure>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">UIApplication</span> *app = [<span class="built_in">UIApplication</span> sharedApplication];</span><br><span class="line">[app openURL:[<span class="built_in">NSURL</span> URLWithString:<span class="string">@"sms://10086"</span>]];</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h4 id="UIApplication代理"><a href="#UIApplication代理" class="headerlink" title="UIApplication代理"></a>UIApplication代理</h4><ul>
<li><p>移动操作系统都有个致命的缺点</p>
<ul>
<li><p>所有的移动操作系统都有个致命的缺点：app很容易受到打扰。</p>
<p>比如一个来电或者锁屏会导致app进入后台甚至被终止</p>
<p>还有很多其它类似的情况会导致app受到干扰，在app受到干扰时，会产生一些系统事件，</p>
<p>这时UIApplication会通知它的delegate对象，让delegate代理来处理这些系统事件</p>
</li>
</ul>
</li>
<li><p>delegate可处理的事件</p>
<ul>
<li><p>应用程序的生命周期事件(如程序启动和关闭)</p>
<p>系统事件(如来电)</p>
<p>内存警告</p>
</li>
</ul>
</li>
<li><p>UIApplication代理</p>
<ul>
<li><p>UIApplication会在程序一启动时候创建一个遵守UIApplicationDelegate代理.</p>
<p>这个就是我们程序一创建时的AppDelegate类.AppDelegate就是遵守了UIApplicationDelegate协议.</p>
<p>在这个类中很定义很多监听系统事件的方法.同时也定义了一些应用程序的生命周期方法.</p>
</li>
</ul>
</li>
<li><p>UIApplication代理方法</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//应用程序启动完成的时候调用</span></span><br><span class="line">- (<span class="built_in">BOOL</span>)application:(<span class="built_in">UIApplication</span> *)application didFinishLaunchingWithOptions:(<span class="built_in">NSDictionary</span> *)launchOptions &#123;</span><br><span class="line">	<span class="built_in">NSLog</span>(<span class="string">@"%s"</span>,__func__);</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//当应用程序即将失去焦点的时候调用</span></span><br><span class="line">- (<span class="keyword">void</span>)applicationWillResignActive:(<span class="built_in">UIApplication</span> *)application &#123;</span><br><span class="line">		<span class="built_in">NSLog</span>(<span class="string">@"%s"</span>,__func__);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//当应用程序完全进入后台的时候调用</span></span><br><span class="line">- (<span class="keyword">void</span>)applicationDidEnterBackground:(<span class="built_in">UIApplication</span> *)application&#123;</span><br><span class="line">		<span class="built_in">NSLog</span>(<span class="string">@"%s"</span>,__func__);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//当应用程序即将进入前台的时候调用</span></span><br><span class="line">- (<span class="keyword">void</span>)applicationWillEnterForeground:(<span class="built_in">UIApplication</span> *)application &#123;</span><br><span class="line">          <span class="built_in">NSLog</span>(<span class="string">@"%s"</span>,__func__);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//当应用程序完全获取焦点的时候调用</span></span><br><span class="line"><span class="comment">//只有当一个应用程序完全获取到焦点,才能与用户交互.</span></span><br><span class="line">- (<span class="keyword">void</span>)applicationDidBecomeActive:(<span class="built_in">UIApplication</span> *)application &#123;</span><br><span class="line">          <span class="built_in">NSLog</span>(<span class="string">@"%s"</span>,__func__);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//当应用程序即将关闭的时候调用</span></span><br><span class="line">- (<span class="keyword">void</span>)applicationWillTerminate:(<span class="built_in">UIApplication</span> *)application &#123;</span><br><span class="line">          <span class="built_in">NSLog</span>(<span class="string">@"%s"</span>,__func__);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>​</p>
</li>
</ul>
]]></content>
      
        <categories>
            
            <category> iOS开发 </category>
            
        </categories>
        
        
    </entry>
    
    <entry>
      <title><![CDATA[iOS项目常见文件]]></title>
      <url>/2018/03/17/iOS%E9%A1%B9%E7%9B%AE%E5%B8%B8%E8%A7%81%E6%96%87%E4%BB%B6/</url>
      <content type="html"><![CDATA[<p><code>Xcode5和Xcode7的区别</code></p>
<ol>
<li>Xcode7没有Frameworks文件夹，Xcode7内部会自动导入一些常见的框架.</li>
<li>Xcode7多了LanuchScreen.xib，LanunchScreen是设置启动界面，而且可以确定模拟器或者真机的真实尺寸，如果没有设置，默认是iPhone4s的尺寸(320,480)</li>
<li>Xcode7没有pch文件</li>
<li>Xcode5当中也有info.plist文件，只不过它的名字很长是工程的名称</li>
</ol>
<p><code>LaunchScreen启动原理</code></p>
<ol>
<li>会自动加载LanunchScreen是因为在Target当中置顶了Launch Screen file</li>
<li>如果没有设置启动图片，模拟器默认的尺寸大小是4s的尺寸大小</li>
<li>它的底层实现其实是把LanunchScreen上的东西生成一张图片，然后把这张图片设为程序的启动图片</li>
</ol>
<p><code>info.plist文件</code></p>
<ul>
<li>作用：info.plist当中保存着整个应用当中基本的配置。它是一个字典。</li>
<li>info.plist当中常见的key值：<ul>
<li>Bundle Name:应用程序的名称</li>
<li>Bundle version string,short:应用程序的版本，在开发当中都是迭代开放，苹果要求下一次提交的版本必须要比上一次提交的版本要高</li>
<li>Bundle Version:应用程序编译的版本</li>
<li>Bundle idertifier:应用程序标识符。保证应用程序的唯一性。</li>
</ul>
</li>
</ul>
<p><code>pch文件</code></p>
<ul>
<li><p>作用</p>
<ul>
<li>pch存放公用的宏</li>
<li>pch存放公用的头文件，分类的头文件</li>
<li>pch可以自定义log</li>
</ul>
</li>
<li><p>pch文件原理</p>
<ul>
<li>会把pch里面所有的内容导入到每个文件中</li>
</ul>
</li>
<li><p>配制pch文件</p>
<ul>
<li>在项目Blud Setting当中找到perfix找到Precomplie prefix Header设为yes</li>
<li>设置完成后再进行prefix Header路径配制。路径从根层开始</li>
</ul>
</li>
<li><p>自定义log</p>
<ul>
<li><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#ifdef DEBUG   调试阶段</span><br><span class="line">...表示宏里面的可变参数</span><br><span class="line">__VA_ARGS__函数里面可变参数</span><br><span class="line">#define XMGLog(...)  NSLog(__VA_ARGS__)</span><br><span class="line"></span><br><span class="line">#else 发布阶段</span><br><span class="line"></span><br><span class="line">#define XMGLog(...)</span><br><span class="line"></span><br><span class="line">#endif</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>pch文件注意点</p>
<ul>
<li>注意pch会把它当中的所有内容导入到工程当中的所有文件，但如果工程当中有c语言文件的时候，它也会导入到c语言文件当中，这样会发生错误</li>
<li>解决办法:每一个OC文件都会定义一个 <em>OBJC </em>宏,只要判断有没有定义这样一个宏,就能看出是不是C语言的文件,如果没有定义这样的宏, 那就不需要导入这些东西.就不会报错.</li>
</ul>
</li>
</ul>
<p>​                            </p>
]]></content>
      
        <categories>
            
            <category> iOS开发 </category>
            
        </categories>
        
        
    </entry>
    
    <entry>
      <title><![CDATA[iOS中代理使用]]></title>
      <url>/2018/03/01/iOS%E4%B8%AD%E4%BB%A3%E7%90%86%E4%BD%BF%E7%94%A8/</url>
      <content type="html"><![CDATA[<ul>
<li>定义一份代理协议<ul>
<li>协议名称的格式一般是：类名＋Delegate<ul>
<li>比如UITableViewDelegate</li>
</ul>
</li>
<li>设计代理的细节<ul>
<li>一般都是@optional(让代理可以有选择的实现一些代理方法)</li>
<li>方法名一般都以类名开头<ul>
<li>比如<code>- (void)scrollViewDidScroll:</code></li>
</ul>
</li>
<li>一般都需要将对象本身传出去<ul>
<li>比如tableview的代理方法都会把tableview本身传出去</li>
</ul>
</li>
</ul>
</li>
<li>必须要遵守NSObject协议(基协议)<ul>
<li>比如<code>@protocol CellDelegate &lt;NSObject&gt;</code></li>
</ul>
</li>
</ul>
</li>
<li>声明一个代理属性<ul>
<li>代理的类型格式:id &lt;协议&gt; delegate</li>
</ul>
</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>,<span class="keyword">weak</span>) <span class="keyword">id</span>&lt;CellDelegate&gt; delegate;</span><br></pre></td></tr></table></figure>
<ul>
<li>设置代理对象</li>
<li>代理对象遵守协议，实现协议里面相应的方法</li>
<li>当控件内部发生一些事情，就可以调用代理的代理方法通知代理<ul>
<li>如果代理方法是@optional,那么需要判断方法是否有实现，直接调用可能会报错</li>
</ul>
</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ([<span class="keyword">self</span>.delegate respondsToSelector:<span class="keyword">@selector</span>(wineCellDidClickPlusButton:)]) &#123;</span><br><span class="line">    [<span class="keyword">self</span>.delegate wineCellDidClickPlusButton:<span class="keyword">self</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      
        <categories>
            
            <category> iOS开发 </category>
            
        </categories>
        
        
        <tags>
            
            <tag> iOS </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[iOS中的通知NSNotificationCenter]]></title>
      <url>/2018/03/01/iOS%E4%B8%AD%E7%9A%84%E9%80%9A%E7%9F%A5NSNotificationCenter/</url>
      <content type="html"><![CDATA[<ol>
<li><p>通知中心(NSNotificationCenter)是在程序内部提供的一种广播机制。把接收到的消息，根据内部的消息转发表，将消息转发给需要的对象。</p>
</li>
<li><p>通知使用分为两步，第一步：在需要使用的地方注册要观察的通知，第二部：在某地方发送通知。(发送的通知可以是我们自定义的通知，也可以是系统的通知)</p>
<p><strong>Demo</strong></p>
<p><code>Person.h</code></p>
</li>
</ol>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  Person.h</span></span><br><span class="line"><span class="comment">//  通知-demo</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  Created by 武 on 18/2/28.</span></span><br><span class="line"><span class="comment">//  Copyright © 2018年 com. All rights reserved.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Person</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>,<span class="keyword">copy</span>) <span class="built_in">NSString</span> *name;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p>​    <code>Person.m</code></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  Person.m</span></span><br><span class="line"><span class="comment">//  通知-demo</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  Created by 武 on 18/2/28.</span></span><br><span class="line"><span class="comment">//  Copyright © 2018年 com. All rights reserved.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#import <span class="meta-string">"Person.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Person</span></span></span><br><span class="line"></span><br><span class="line">-(<span class="keyword">void</span>)getNew:(<span class="built_in">NSNotification</span> *)note</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@接收到了%@发布的%@通知,通知内容是%@"</span>,<span class="keyword">self</span>.name,[note.object name],note.name,note.userInfo);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><code>Company.h</code></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  Company.h</span></span><br><span class="line"><span class="comment">//  通知-demo</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  Created by 武 on 18/2/28.</span></span><br><span class="line"><span class="comment">//  Copyright © 2018年 com. All rights reserved.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Company</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>,<span class="keyword">copy</span>) <span class="built_in">NSString</span> *name;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><code>Company.m</code></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  Company.m</span></span><br><span class="line"><span class="comment">//  通知-demo</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  Created by 武 on 18/2/28.</span></span><br><span class="line"><span class="comment">//  Copyright © 2018年 com. All rights reserved.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#import <span class="meta-string">"Company.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Company</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><code>ViewController.m</code></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  ViewController.m</span></span><br><span class="line"><span class="comment">//  通知-demo</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  Created by 武 on 18/2/28.</span></span><br><span class="line"><span class="comment">//  Copyright © 2018年 com. All rights reserved.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"Person.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"Company.h"</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    </span><br><span class="line">    Company *com1 = [[Company alloc]init];</span><br><span class="line">    com1.name = <span class="string">@"Tencent"</span>;</span><br><span class="line">    </span><br><span class="line">    Company *com2 = [[Company alloc]init];</span><br><span class="line">    com2.name = <span class="string">@"Sina"</span>;</span><br><span class="line">    </span><br><span class="line">    Person *p1 = [[Person alloc]init];</span><br><span class="line">    p1.name = <span class="string">@"张三"</span>;</span><br><span class="line">    Person *p2 = [[Person alloc]init];</span><br><span class="line">    p2.name = <span class="string">@"李四"</span>;</span><br><span class="line">    Person *p3 = [[Person alloc]init];</span><br><span class="line">    p3.name = <span class="string">@"王五"</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/***模拟通知**/</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//监听通知</span></span><br><span class="line">    [[<span class="built_in">NSNotificationCenter</span> defaultCenter] addObserver:p1 selector:<span class="keyword">@selector</span>(getNew:) name:<span class="literal">nil</span> object:<span class="literal">nil</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//发布通知</span></span><br><span class="line">    <span class="built_in">NSNotification</span> *note = [<span class="built_in">NSNotification</span> notificationWithName:<span class="string">@"军事新闻"</span> object:com1 userInfo:@&#123;<span class="string">@"title"</span>:<span class="string">@"xxxxxxx"</span>&#125;];</span><br><span class="line">    [[<span class="built_in">NSNotificationCenter</span> defaultCenter] postNotification:note];</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">//移除通知</span></span><br><span class="line">    [[<span class="built_in">NSNotificationCenter</span> defaultCenter]removeObserver:p1];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><code>首先p1张三注册监听，它监听的通知name和object为nil说明它可以监听任何对象发布的任意通知,然后com1发布了一条名称为军事新闻内容为xxxxxxx的通知，张三一旦监听到这条通知就会执行getNew这个方法，这个方法携带了通知的发布者，通知的名称通知的内容等信息。</code></p>
]]></content>
      
        <categories>
            
            <category> iOS开发 </category>
            
        </categories>
        
        
        <tags>
            
            <tag> iOS </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[UITableView]]></title>
      <url>/2018/01/29/UITableView/</url>
      <content type="html"><![CDATA[<h4 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h4><p>从字面可以看出它是一个表格UI控件，在iOS开发中UITableView可以说是使用最广泛的控件，我们在使用软件中到处可以看到它的影子，例如QQ以及微信的联系人界面都是UITableView.</p>
<p>UITableView有两种显示风格，一个是分组样式，一个是不分组样式。如下图</p>
<p>不分组样式</p>
<p><img src="/2018/01/29/UITableView/1.png" alt="不分组样式">    </p>
<p>分组样式</p>
<p><img src="/2018/01/29/UITableView/2.png" alt="分组样式"> </p>
<p>可以看到在UITableView中数据只有行的概念，并没有列的概念，因为在手机操作中显示列是不利于操作的。</p>
<p><code>UITableView中每行数据都是一个UITableViewCell</code>在这个控件中为了显示更多的信息，iOS已经在其内部设置了多个子控件供使用。一个contentView座位其他元素的父控件，两个UILabel控件（textLabel,detailTextLabel）,一个imageView，分别用于容器、显示内容、详情和图片。</p>
<p>这些控件不一定要全部使用，具体操作时可以通过UITableViewCellStyle进行设置，它是一个枚举表示UITableView的排列方式。</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="built_in">NS_ENUM</span>(<span class="built_in">NSInteger</span>, <span class="built_in">UITableViewCellStyle</span>) &#123;</span><br><span class="line">    <span class="built_in">UITableViewCellStyleDefault</span>,    <span class="comment">// 左侧显示textLabel（不显示detailTextLabel），imageView可选（显示在最左边）</span></span><br><span class="line">    <span class="built_in">UITableViewCellStyleValue1</span>,        <span class="comment">// 左侧显示textLabel、右侧显示detailTextLabel（默认蓝色），imageView可选（显示在最左边）</span></span><br><span class="line">    <span class="built_in">UITableViewCellStyleValue2</span>,        <span class="comment">// 左侧依次显示textLabel(默认蓝色)和detailTextLabel，imageView可选（显示在最左边）</span></span><br><span class="line">    <span class="built_in">UITableViewCellStyleSubtitle</span>    <span class="comment">// 左上方显示textLabel，左下方显示detailTextLabel（默认灰色）,imageView可选（显示在最左边）</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="数据源"><a href="#数据源" class="headerlink" title="数据源"></a>数据源</h4><p>由于iOS是遵循MVC模式设计的，很多操作都是通过代理和外界沟通的，但对于数据源控件除了代理还有一个数据源属性，通过它和外界进行数据交互。 对于UITableView设置完dataSource后需要实现UITableViewDataSource协议，在这个协议中定义了多种 数据操作方法。</p>
<p>简单示例</p>
<p>新建一个person模型类</p>
<p><code>person.h</code></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  Person.h</span></span><br><span class="line"><span class="comment">//  UITableView简单示例</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  Created by 武 on 18/1/29.</span></span><br><span class="line"><span class="comment">//  Copyright © 2018年 com. All rights reserved.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Person</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>,<span class="keyword">copy</span>) <span class="built_in">NSString</span> *firstName;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>,<span class="keyword">copy</span>) <span class="built_in">NSString</span> *lastName;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>,<span class="keyword">copy</span>) <span class="built_in">NSString</span> *phoneNumber;</span><br><span class="line"></span><br><span class="line">- (Person *)initWithFirstName:(<span class="built_in">NSString</span> *)firstName andLastName:(<span class="built_in">NSString</span> *)lastName andPhoneNumber:(<span class="built_in">NSString</span> *)phoneNumber;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSString</span> *)getName;</span><br><span class="line"></span><br><span class="line">+ (Person *)initWithFirstName:(<span class="built_in">NSString</span> *)firstName andLastName:(<span class="built_in">NSString</span> *)lastName andPhoneNumber:(<span class="built_in">NSString</span> *)phoneNumber;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><code>person.m</code></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  Person.m</span></span><br><span class="line"><span class="comment">//  UITableView简单示例</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  Created by 武 on 18/1/29.</span></span><br><span class="line"><span class="comment">//  Copyright © 2018年 com. All rights reserved.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#import <span class="meta-string">"Person.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Person</span></span></span><br><span class="line"></span><br><span class="line">-(Person *)initWithFirstName:(<span class="built_in">NSString</span> *)firstName andLastName:(<span class="built_in">NSString</span> *)lastName andPhoneNumber:(<span class="built_in">NSString</span> *)phoneNumber</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>=[<span class="keyword">super</span> init]) &#123;</span><br><span class="line">        <span class="keyword">self</span>.firstName = firstName;</span><br><span class="line">        <span class="keyword">self</span>.lastName = lastName;</span><br><span class="line">        <span class="keyword">self</span>.phoneNumber = phoneNumber;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">-(<span class="built_in">NSString</span> *)getName</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%@-%@"</span>,_lastName,_firstName];</span><br><span class="line">&#125;</span><br><span class="line">+(Person *)initWithFirstName:(<span class="built_in">NSString</span> *)firstName andLastName:(<span class="built_in">NSString</span> *)lastName andPhoneNumber:(<span class="built_in">NSString</span> *)phoneNumber</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> [[<span class="keyword">self</span> alloc]initWithFirstName:firstName andLastName:lastName andPhoneNumber:phoneNumber];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p>新建PersonGroup模型类</p>
<p><code>PersonGroup.h</code></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  PersonGroup.h</span></span><br><span class="line"><span class="comment">//  UITableView简单示例</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  Created by 武 on 18/1/29.</span></span><br><span class="line"><span class="comment">//  Copyright © 2018年 com. All rights reserved.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">PersonGroup</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>,<span class="keyword">copy</span>) <span class="built_in">NSString</span> *name;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>,<span class="keyword">copy</span>) <span class="built_in">NSString</span> *detail;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>,<span class="keyword">strong</span>) <span class="built_in">NSMutableArray</span> *persons;</span><br><span class="line"></span><br><span class="line">-(PersonGroup *)initWithName:(<span class="built_in">NSString</span> *)name andDetail:(<span class="built_in">NSString</span> *)detail andPerson:(<span class="built_in">NSMutableArray</span> *)persons;</span><br><span class="line"></span><br><span class="line">+(PersonGroup *)initWithName:(<span class="built_in">NSString</span> *)name andDetail:(<span class="built_in">NSString</span> *)detail andPerson:(<span class="built_in">NSMutableArray</span> *)persons;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><code>PersonGroup.m</code></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  PersonGroup.m</span></span><br><span class="line"><span class="comment">//  UITableView简单示例</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  Created by 武 on 18/1/29.</span></span><br><span class="line"><span class="comment">//  Copyright © 2018年 com. All rights reserved.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#import <span class="meta-string">"PersonGroup.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">PersonGroup</span></span></span><br><span class="line"></span><br><span class="line">- (PersonGroup *)initWithName:(<span class="built_in">NSString</span> *)name andDetail:(<span class="built_in">NSString</span> *)detail andPerson:(<span class="built_in">NSMutableArray</span> *)persons</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>=[<span class="keyword">super</span> init]) &#123;</span><br><span class="line">        <span class="keyword">self</span>.name = name;</span><br><span class="line">        <span class="keyword">self</span>.detail = detail;</span><br><span class="line">        <span class="keyword">self</span>.persons = persons;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (PersonGroup *)initWithName:(<span class="built_in">NSString</span> *)name andDetail:(<span class="built_in">NSString</span> *)detail andPerson:(<span class="built_in">NSMutableArray</span> *)persons</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> [[<span class="keyword">self</span> alloc]initWithName:name andDetail:detail andPerson:persons];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><code>ViewController.m</code></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  ViewController.m</span></span><br><span class="line"><span class="comment">//  UITableView简单示例</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  Created by 武 on 18/1/29.</span></span><br><span class="line"><span class="comment">//  Copyright © 2018年 com. All rights reserved.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"Person.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"PersonGroup.h"</span></span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()&lt;<span class="title">UITableViewDataSource</span>&gt;</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">UITableView</span> *_tableView;</span><br><span class="line">    <span class="built_in">NSMutableArray</span> *_persondata;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//加载数据</span></span><br><span class="line">    [<span class="keyword">self</span> initPersonData];</span><br><span class="line">    <span class="comment">//创建一个分组样式的tableview</span></span><br><span class="line">    _tableView = [[<span class="built_in">UITableView</span> alloc]initWithFrame:<span class="keyword">self</span>.view.bounds style:<span class="built_in">UITableViewStyleGrouped</span>];</span><br><span class="line">    <span class="comment">//设置数据源</span></span><br><span class="line">    _tableView.dataSource = <span class="keyword">self</span>;</span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:_tableView];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> 加载数据</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)initPersonData</span><br><span class="line">&#123;</span><br><span class="line">    _persondata = [[<span class="built_in">NSMutableArray</span> alloc]init];</span><br><span class="line">    </span><br><span class="line">    Person *peron1 = [Person initWithFirstName:<span class="string">@"zhang"</span> andLastName:<span class="string">@"san"</span> andPhoneNumber:<span class="string">@"1888888888"</span>];</span><br><span class="line">    Person *peron2 = [Person initWithFirstName:<span class="string">@"zhang"</span> andLastName:<span class="string">@"si"</span> andPhoneNumber:<span class="string">@"1777777777"</span>];</span><br><span class="line">    Person *peron3 = [Person initWithFirstName:<span class="string">@"zhang"</span> andLastName:<span class="string">@"wu"</span> andPhoneNumber:<span class="string">@"1666666666"</span>];</span><br><span class="line">    </span><br><span class="line">    PersonGroup *pArray1 = [PersonGroup initWithName:<span class="string">@"Z"</span> andDetail:<span class="string">@"张姓"</span> andPersons:[<span class="built_in">NSMutableArray</span> arrayWithObjects:peron1,peron2,peron3, <span class="literal">nil</span>]];</span><br><span class="line">    </span><br><span class="line">    [_persondata addObject:pArray1];</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    Person *peron4 = [Person initWithFirstName:<span class="string">@"li"</span> andLastName:<span class="string">@"san"</span> andPhoneNumber:<span class="string">@"1888888888"</span>];</span><br><span class="line">    Person *peron5 = [Person initWithFirstName:<span class="string">@"li"</span> andLastName:<span class="string">@"si"</span> andPhoneNumber:<span class="string">@"1777777777"</span>];</span><br><span class="line">    Person *peron6 = [Person initWithFirstName:<span class="string">@"li"</span> andLastName:<span class="string">@"wu"</span> andPhoneNumber:<span class="string">@"1666666666"</span>];</span><br><span class="line">    </span><br><span class="line">    PersonGroup *pArray2 = [PersonGroup initWithName:<span class="string">@"L"</span> andDetail:<span class="string">@"李姓"</span> andPersons:[<span class="built_in">NSMutableArray</span> arrayWithObjects:peron4,peron5,peron6, <span class="literal">nil</span>]];</span><br><span class="line">    </span><br><span class="line">    [_persondata addObject:pArray2];</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    Person *peron7 = [Person initWithFirstName:<span class="string">@"wang"</span> andLastName:<span class="string">@"san"</span> andPhoneNumber:<span class="string">@"1888888888"</span>];</span><br><span class="line">    Person *peron8 = [Person initWithFirstName:<span class="string">@"wang"</span> andLastName:<span class="string">@"si"</span> andPhoneNumber:<span class="string">@"1777777777"</span>];</span><br><span class="line">    Person *peron9 = [Person initWithFirstName:<span class="string">@"wang"</span> andLastName:<span class="string">@"wu"</span> andPhoneNumber:<span class="string">@"1666666666"</span>];</span><br><span class="line">    </span><br><span class="line">    PersonGroup *pArray3 = [PersonGroup initWithName:<span class="string">@"W"</span> andDetail:<span class="string">@"王姓"</span> andPersons:[<span class="built_in">NSMutableArray</span> arrayWithObjects:peron7,peron8,peron9, <span class="literal">nil</span>]];</span><br><span class="line">    </span><br><span class="line">    [_persondata addObject:pArray3];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark 数据源方法</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> @return 共多少组</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">- (<span class="built_in">NSInteger</span>)numberOfSectionsInTableView:(<span class="built_in">UITableView</span> *)tableView</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> _persondata.count;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> @param section   那一组</span></span><br><span class="line"><span class="comment"> @return 多少行</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">- (<span class="built_in">NSInteger</span>)tableView:(<span class="built_in">UITableView</span> *)tableView numberOfRowsInSection:(<span class="built_in">NSInteger</span>)section</span><br><span class="line">&#123;</span><br><span class="line">    PersonGroup *group = _persondata[section];</span><br><span class="line">    <span class="keyword">return</span> group.persons.count;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">设置每一行cell数据</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">- (<span class="built_in">UITableViewCell</span> *)tableView:(<span class="built_in">UITableView</span> *)tableView cellForRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath</span><br><span class="line">&#123;</span><br><span class="line">    PersonGroup *group = _persondata[indexPath.section];</span><br><span class="line">    Person *person = group.persons[indexPath.row];</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">UITableViewCell</span> *cell = [[<span class="built_in">UITableViewCell</span> alloc]initWithStyle:<span class="built_in">UITableViewCellStyleDefault</span> reuseIdentifier:<span class="literal">nil</span>];</span><br><span class="line">    cell.textLabel.text = [person getName];</span><br><span class="line">    cell.detailTextLabel.text = person.phoneNumber;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> cell;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> @return 每一组的头标题</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">-(<span class="built_in">NSString</span> *)tableView:(<span class="built_in">UITableView</span> *)tableView titleForHeaderInSection:(<span class="built_in">NSInteger</span>)section</span><br><span class="line">&#123;</span><br><span class="line">    PersonGroup *group = _persondata[section];</span><br><span class="line">    <span class="keyword">return</span> group.name;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> @return 每一组的尾标题</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">- (<span class="built_in">NSString</span> *)tableView:(<span class="built_in">UITableView</span> *)tableView titleForFooterInSection:(<span class="built_in">NSInteger</span>)section</span><br><span class="line">&#123;</span><br><span class="line">    PersonGroup *group = _persondata[section];</span><br><span class="line">    <span class="keyword">return</span> group.detail;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> 每组的标题索引</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">- (<span class="built_in">NSArray</span>&lt;<span class="built_in">NSString</span> *&gt; *)sectionIndexTitlesForTableView:(<span class="built_in">UITableView</span> *)tableView</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSMutableArray</span> *indexs = [[<span class="built_in">NSMutableArray</span> alloc]init];</span><br><span class="line">    <span class="keyword">for</span> (PersonGroup *group <span class="keyword">in</span> _persondata) &#123;</span><br><span class="line">        [indexs addObject:group.name];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> indexs;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p>运行结果</p>
<p>​                        <img src="/2018/01/29/UITableView/3.png" alt="效果图"></p>
<p>方法执行顺序为计算分组数(不写此方法默认为1组)—&gt;计算每组的行数—&gt;生成分组索引—&gt;生成单元格(依次生成所有组的单元格)，生成单元格并不是一次全部生成，而是只会生成显示在界面上的单元格。</p>
<h4 id="代理"><a href="#代理" class="headerlink" title="代理"></a>代理</h4><ul>
<li><p>设置行高</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#pragma mark - 代理方法</span></span><br><span class="line"><span class="meta">#pragma mark 设置分组标题内容高度</span></span><br><span class="line">-(<span class="built_in">CGFloat</span>)tableView:(<span class="built_in">UITableView</span> *)tableView heightForHeaderInSection:(<span class="built_in">NSInteger</span>)section&#123;</span><br><span class="line">    <span class="keyword">if</span>(section==<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">50</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">40</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark 设置每行高度（每行高度可以不一样）</span></span><br><span class="line">-(<span class="built_in">CGFloat</span>)tableView:(<span class="built_in">UITableView</span> *)tableView heightForRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">45</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark 设置尾部说明内容高度</span></span><br><span class="line">-(<span class="built_in">CGFloat</span>)tableView:(<span class="built_in">UITableView</span> *)tableView heightForFooterInSection:(<span class="built_in">NSInteger</span>)section&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">40</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>监听点击事件</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  ViewController.m</span></span><br><span class="line"><span class="comment">//  UITableView简单示例</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  Created by 武 on 18/1/29.</span></span><br><span class="line"><span class="comment">//  Copyright © 2018年 com. All rights reserved.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"Person.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"PersonGroup.h"</span></span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()&lt;<span class="title">UITableViewDataSource</span>,<span class="title">UITableViewDelegate</span>,<span class="title">UIAlertViewDelegate</span>&gt;</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">UITableView</span> *_tableView;</span><br><span class="line">    <span class="built_in">NSMutableArray</span> *_persondata;</span><br><span class="line">    <span class="built_in">NSIndexPath</span> *_selectIndexPath;<span class="comment">//当前选中的组和行</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//加载数据</span></span><br><span class="line">    [<span class="keyword">self</span> initPersonData];</span><br><span class="line">    <span class="comment">//创建一个分组样式的tableview</span></span><br><span class="line">    _tableView = [[<span class="built_in">UITableView</span> alloc]initWithFrame:<span class="keyword">self</span>.view.bounds style:<span class="built_in">UITableViewStyleGrouped</span>];</span><br><span class="line">    <span class="comment">//设置数据源</span></span><br><span class="line">    _tableView.dataSource = <span class="keyword">self</span>;</span><br><span class="line">    _tableView.delegate = <span class="keyword">self</span>;</span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:_tableView];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> 加载数据</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)initPersonData</span><br><span class="line">&#123;</span><br><span class="line">    _persondata = [[<span class="built_in">NSMutableArray</span> alloc]init];</span><br><span class="line">    </span><br><span class="line">    Person *peron1 = [Person initWithFirstName:<span class="string">@"zhang"</span> andLastName:<span class="string">@"san"</span> andPhoneNumber:<span class="string">@"1888888888"</span>];</span><br><span class="line">    Person *peron2 = [Person initWithFirstName:<span class="string">@"zhang"</span> andLastName:<span class="string">@"si"</span> andPhoneNumber:<span class="string">@"1777777777"</span>];</span><br><span class="line">    Person *peron3 = [Person initWithFirstName:<span class="string">@"zhang"</span> andLastName:<span class="string">@"wu"</span> andPhoneNumber:<span class="string">@"1666666666"</span>];</span><br><span class="line">    </span><br><span class="line">    PersonGroup *pArray1 = [PersonGroup initWithName:<span class="string">@"Z"</span> andDetail:<span class="string">@"张姓"</span> andPersons:[<span class="built_in">NSMutableArray</span> arrayWithObjects:peron1,peron2,peron3, <span class="literal">nil</span>]];</span><br><span class="line">    </span><br><span class="line">    [_persondata addObject:pArray1];</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    Person *peron4 = [Person initWithFirstName:<span class="string">@"li"</span> andLastName:<span class="string">@"san"</span> andPhoneNumber:<span class="string">@"1888888888"</span>];</span><br><span class="line">    Person *peron5 = [Person initWithFirstName:<span class="string">@"li"</span> andLastName:<span class="string">@"si"</span> andPhoneNumber:<span class="string">@"1777777777"</span>];</span><br><span class="line">    Person *peron6 = [Person initWithFirstName:<span class="string">@"li"</span> andLastName:<span class="string">@"wu"</span> andPhoneNumber:<span class="string">@"1666666666"</span>];</span><br><span class="line">    </span><br><span class="line">    PersonGroup *pArray2 = [PersonGroup initWithName:<span class="string">@"L"</span> andDetail:<span class="string">@"李姓"</span> andPersons:[<span class="built_in">NSMutableArray</span> arrayWithObjects:peron4,peron5,peron6, <span class="literal">nil</span>]];</span><br><span class="line">    </span><br><span class="line">    [_persondata addObject:pArray2];</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    Person *peron7 = [Person initWithFirstName:<span class="string">@"wang"</span> andLastName:<span class="string">@"san"</span> andPhoneNumber:<span class="string">@"1888888888"</span>];</span><br><span class="line">    Person *peron8 = [Person initWithFirstName:<span class="string">@"wang"</span> andLastName:<span class="string">@"si"</span> andPhoneNumber:<span class="string">@"1777777777"</span>];</span><br><span class="line">    Person *peron9 = [Person initWithFirstName:<span class="string">@"wang"</span> andLastName:<span class="string">@"wu"</span> andPhoneNumber:<span class="string">@"1666666666"</span>];</span><br><span class="line">    </span><br><span class="line">    PersonGroup *pArray3 = [PersonGroup initWithName:<span class="string">@"W"</span> andDetail:<span class="string">@"王姓"</span> andPersons:[<span class="built_in">NSMutableArray</span> arrayWithObjects:peron7,peron8,peron9, <span class="literal">nil</span>]];</span><br><span class="line">    </span><br><span class="line">    [_persondata addObject:pArray3];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark 数据源方法</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> @return 共多少组</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">- (<span class="built_in">NSInteger</span>)numberOfSectionsInTableView:(<span class="built_in">UITableView</span> *)tableView</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> _persondata.count;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> @param section   那一组</span></span><br><span class="line"><span class="comment"> @return 多少行</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">- (<span class="built_in">NSInteger</span>)tableView:(<span class="built_in">UITableView</span> *)tableView numberOfRowsInSection:(<span class="built_in">NSInteger</span>)section</span><br><span class="line">&#123;</span><br><span class="line">    PersonGroup *group = _persondata[section];</span><br><span class="line">    <span class="keyword">return</span> group.persons.count;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">设置每一行cell数据</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">- (<span class="built_in">UITableViewCell</span> *)tableView:(<span class="built_in">UITableView</span> *)tableView cellForRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath</span><br><span class="line">&#123;</span><br><span class="line">    PersonGroup *group = _persondata[indexPath.section];</span><br><span class="line">    Person *person = group.persons[indexPath.row];</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">UITableViewCell</span> *cell = [[<span class="built_in">UITableViewCell</span> alloc]initWithStyle:<span class="built_in">UITableViewCellStyleDefault</span> reuseIdentifier:<span class="literal">nil</span>];</span><br><span class="line">    cell.textLabel.text = [person getName];</span><br><span class="line">    cell.detailTextLabel.text = person.phoneNumber;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> cell;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> @return 每一组的头标题</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">-(<span class="built_in">NSString</span> *)tableView:(<span class="built_in">UITableView</span> *)tableView titleForHeaderInSection:(<span class="built_in">NSInteger</span>)section</span><br><span class="line">&#123;</span><br><span class="line">    PersonGroup *group = _persondata[section];</span><br><span class="line">    <span class="keyword">return</span> group.name;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> @return 每一组的尾标题</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">- (<span class="built_in">NSString</span> *)tableView:(<span class="built_in">UITableView</span> *)tableView titleForFooterInSection:(<span class="built_in">NSInteger</span>)section</span><br><span class="line">&#123;</span><br><span class="line">    PersonGroup *group = _persondata[section];</span><br><span class="line">    <span class="keyword">return</span> group.detail;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> 每组的标题索引</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">- (<span class="built_in">NSArray</span>&lt;<span class="built_in">NSString</span> *&gt; *)sectionIndexTitlesForTableView:(<span class="built_in">UITableView</span> *)tableView</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSMutableArray</span> *indexs = [[<span class="built_in">NSMutableArray</span> alloc]init];</span><br><span class="line">    <span class="keyword">for</span> (PersonGroup *group <span class="keyword">in</span> _persondata) &#123;</span><br><span class="line">        [indexs addObject:group.name];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> indexs;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark 代理方法</span></span><br><span class="line"></span><br><span class="line">- (<span class="built_in">CGFloat</span>)tableView:(<span class="built_in">UITableView</span> *)tableView heightForHeaderInSection:(<span class="built_in">NSInteger</span>)section</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (section==<span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">50</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">40</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">CGFloat</span>)tableView:(<span class="built_in">UITableView</span> *)tableView heightForRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">45</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">CGFloat</span>)tableView:(<span class="built_in">UITableView</span> *)tableView heightForFooterInSection:(<span class="built_in">NSInteger</span>)section</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">40</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)tableView:(<span class="built_in">UITableView</span> *)tableView didSelectRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath</span><br><span class="line">&#123;</span><br><span class="line">    _selectIndexPath = indexPath;</span><br><span class="line">    PersonGroup *group = _persondata[indexPath.section];</span><br><span class="line">    Person *person = group.persons[indexPath.row];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//创建弹出窗口</span></span><br><span class="line">    <span class="built_in">UIAlertView</span> *alert = [[<span class="built_in">UIAlertView</span> alloc]initWithTitle:<span class="string">@"窗口标题"</span> message:[person getName] delegate:<span class="keyword">self</span> cancelButtonTitle:<span class="string">@"完成"</span> otherButtonTitles:<span class="string">@"OK"</span>, <span class="literal">nil</span>];</span><br><span class="line">    alert.alertViewStyle = <span class="built_in">UIAlertViewStylePlainTextInput</span>;<span class="comment">//设置窗口内容样式</span></span><br><span class="line">    <span class="built_in">UITextField</span> *textField = [alert textFieldAtIndex:<span class="number">0</span>];<span class="comment">//取得文本框</span></span><br><span class="line">    textField.text = person.phoneNumber;<span class="comment">//设置文本框内容为电话</span></span><br><span class="line">    [alert show];<span class="comment">//显示弹出窗口</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark alert代理方法</span></span><br><span class="line">- (<span class="keyword">void</span>)alertView:(<span class="built_in">UIAlertView</span> *)alertView clickedButtonAtIndex:(<span class="built_in">NSInteger</span>)buttonIndex</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//当点击了第二个按钮（OK）</span></span><br><span class="line">    <span class="keyword">if</span> (buttonIndex==<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="built_in">UITextField</span> *textField = [alertView textFieldAtIndex:<span class="number">0</span>];</span><br><span class="line">        <span class="comment">//修改模型数据</span></span><br><span class="line">        PersonGroup *group = _persondata[_selectIndexPath.section];</span><br><span class="line">        Person *person = group.persons[_selectIndexPath.row];</span><br><span class="line">        person.phoneNumber = textField.text;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//[_tableView reloadData];//刷新表格 这种方式不可取需要局部刷新</span></span><br><span class="line">        </span><br><span class="line">        <span class="built_in">NSArray</span> *indexPaths=@[_selectIndexPath];<span class="comment">//需要刷新的单元格的组、行</span></span><br><span class="line">        [_tableView reloadRowsAtIndexPaths:indexPaths withRowAnimation:<span class="built_in">UITableViewRowAnimationLeft</span>];<span class="comment">//最后一个参数代表更新时使用那种动画</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><code>注意修改数据后刷新表格尽量使用局部刷新</code></p>
<h4 id="性能优化"><a href="#性能优化" class="headerlink" title="性能优化"></a>性能优化</h4><p>UITableView中的单元格cell时再显示到用户可视区域后创建的，那么如果用户往下滚动就会继续创建显示在屏幕上的单元格，如果用户向上滚动返回到查看过的内容时同样会创建之前已经创建过的单元格，如此一来即使UITableView的内容不是太多，如果用户反复的上下滚动，内存也会瞬间飙升，更何况很多时候UITableView的内容是很多的。</p>
<p>无限滚动UIScrollView是利用有限的UIImageView动态切换其内容来尽可能减少资源占用。同样的，在UITableView中也可以采用类似的方式，只是这时我们不是在滚动到指定位置后更改滚动的位置而是要将当前没有显示的Cell重新显示在将要显示的Cell的位置然后更新其内容。原因就是UITableView中的Cell结构布局可能是不同的，通过重新定位是不可取的，而是需要重用已经不再界面显示的已创建过的Cell.</p>
<p>UITableView内部有一个缓存池，初始化的时候使用<code>initWithStyle:(UITableViewCellStyle) reuseIdentifier:(NSString \*)</code>方法指定一个可重用表示，就可以将这个cell放到缓存池。然后在使用的时候使用指定的标识符取缓存池中取得对应的cell然后修改cell内容即可。</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">设置每一行cell数据</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">- (<span class="built_in">UITableViewCell</span> *)tableView:(<span class="built_in">UITableView</span> *)tableView cellForRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath</span><br><span class="line">&#123;</span><br><span class="line">    PersonGroup *group = _persondata[indexPath.section];</span><br><span class="line">    Person *person = group.persons[indexPath.row];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//方法调用十分频繁，声明成静态变量有利于性能优化</span></span><br><span class="line">    <span class="keyword">static</span> <span class="built_in">NSString</span> *ID = <span class="string">@"person"</span>;</span><br><span class="line">    <span class="comment">//先从缓存中取标识符为ID的cell</span></span><br><span class="line">    <span class="built_in">UITableViewCell</span> *cell = [tableView dequeueReusableCellWithIdentifier:ID];</span><br><span class="line">  	<span class="comment">//如果缓存池中没有标识符为ID的cell再新建一个标识符为ID的cell</span></span><br><span class="line">    <span class="keyword">if</span> (cell==<span class="literal">nil</span>) &#123;</span><br><span class="line">        cell = [[<span class="built_in">UITableViewCell</span> alloc]initWithStyle:<span class="built_in">UITableViewCellStyleDefault</span> reuseIdentifier:ID];</span><br><span class="line">    &#125;</span><br><span class="line">    cell.textLabel.text = [person getName];</span><br><span class="line">    cell.detailTextLabel.text = person.phoneNumber;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> cell;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="自定义TableViewCell-仿照微博"><a href="#自定义TableViewCell-仿照微博" class="headerlink" title="自定义TableViewCell(仿照微博)"></a>自定义TableViewCell(仿照微博)</h4><p>文件结构图</p>
<p><img src="/2018/01/29/UITableView/4.png" alt="文件结构图"></p>
<ul>
<li><p>创建微博模型类</p>
<p><code>Status.h</code></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  Status.h</span></span><br><span class="line"><span class="comment">//  自定义不等高cell</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  Created by 武 on 18/1/25.</span></span><br><span class="line"><span class="comment">//  Copyright © 2018年 com. All rights reserved.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;UIKit/UIKit.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Status</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> 图像</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>,<span class="keyword">copy</span>) <span class="built_in">NSString</span> *icon;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> 昵称</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>,<span class="keyword">copy</span>) <span class="built_in">NSString</span> *name;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> 正文内容</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>,<span class="keyword">copy</span>) <span class="built_in">NSString</span> *text;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> VIP</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>,<span class="keyword">assign</span>,<span class="keyword">getter</span>=isVip) <span class="built_in">BOOL</span> vip;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> 配图</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>,<span class="keyword">copy</span>) <span class="built_in">NSString</span> *picture;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> 图像的frame</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>,<span class="keyword">assign</span>)  <span class="built_in">CGRect</span> iconFrame;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> 昵称的frame</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>,<span class="keyword">assign</span>) <span class="built_in">CGRect</span> nameFrame;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> vip的frame</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>,<span class="keyword">assign</span>) <span class="built_in">CGRect</span> vipFrame;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> 正文frame</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>,<span class="keyword">assign</span>) <span class="built_in">CGRect</span> textFrame;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> 配图的frame</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>,<span class="keyword">assign</span>) <span class="built_in">CGRect</span> pictureFrame;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> cell的高度</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>,<span class="keyword">assign</span>) <span class="built_in">CGFloat</span> cellHeight;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><code>Status.m</code></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  Status.m</span></span><br><span class="line"><span class="comment">//  自定义不等高cell</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  Created by 武 on 18/1/25.</span></span><br><span class="line"><span class="comment">//  Copyright © 2018年 com. All rights reserved.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"Status.h"</span></span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Status</span></span></span><br><span class="line">-(<span class="built_in">CGFloat</span>)cellHeight</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (_cellHeight == <span class="number">0</span> ) &#123;       </span><br><span class="line">        <span class="built_in">CGFloat</span> space = <span class="number">10</span>;        </span><br><span class="line">        <span class="comment">//图像</span></span><br><span class="line">        <span class="built_in">CGFloat</span> iconX = space;</span><br><span class="line">        <span class="built_in">CGFloat</span> iconY = space;</span><br><span class="line">        <span class="built_in">CGFloat</span> iconWH = <span class="number">30</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">self</span>.iconFrame = <span class="built_in">CGRectMake</span>(iconX, iconY, iconWH, iconWH);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//昵称</span></span><br><span class="line">        <span class="built_in">CGFloat</span> nameX = <span class="built_in">CGRectGetMaxX</span>(<span class="keyword">self</span>.iconFrame)+space;</span><br><span class="line">        <span class="built_in">CGFloat</span> nameY = iconY;</span><br><span class="line">        <span class="built_in">NSDictionary</span> *nameAtt = @&#123;<span class="built_in">NSFontAttributeName</span>:[<span class="built_in">UIFont</span> systemFontOfSize:<span class="number">17</span>]&#125;;</span><br><span class="line">        <span class="comment">//计算昵称文字的尺寸</span></span><br><span class="line">        <span class="built_in">CGSize</span> nameSize = [<span class="keyword">self</span>.name sizeWithAttributes:nameAtt];</span><br><span class="line">        <span class="built_in">CGFloat</span> nameW = nameSize.width;</span><br><span class="line">        <span class="built_in">CGFloat</span> nameH = nameSize.height;</span><br><span class="line">        <span class="keyword">self</span>.nameFrame = <span class="built_in">CGRectMake</span>(nameX, nameY, nameW, nameH);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//vip</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">self</span>.isVip) &#123;</span><br><span class="line">            <span class="built_in">CGFloat</span> vipX = <span class="built_in">CGRectGetMaxX</span>(<span class="keyword">self</span>.nameFrame)+space;</span><br><span class="line">            <span class="built_in">CGFloat</span> vipW = <span class="number">14</span>;</span><br><span class="line">            <span class="built_in">CGFloat</span> vipH = nameH;</span><br><span class="line">            <span class="built_in">CGFloat</span> vipY = nameY;</span><br><span class="line">            <span class="keyword">self</span>.vipFrame = <span class="built_in">CGRectMake</span>(vipX, vipY, vipW, vipH);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//正文</span></span><br><span class="line">        <span class="built_in">CGFloat</span> textX = iconX;</span><br><span class="line">        <span class="built_in">CGFloat</span> textY = <span class="built_in">CGRectGetMaxY</span>(<span class="keyword">self</span>.iconFrame)+space;</span><br><span class="line">        <span class="built_in">CGFloat</span> textW = [<span class="built_in">UIScreen</span> mainScreen].bounds.size.width<span class="number">-2</span>*space;</span><br><span class="line">        <span class="built_in">NSDictionary</span> *textAtt = @&#123;<span class="built_in">NSFontAttributeName</span>:[<span class="built_in">UIFont</span> systemFontOfSize:<span class="number">14</span>]&#125;;</span><br><span class="line">        <span class="comment">//最大宽度是textW,宽度不限制</span></span><br><span class="line">        <span class="built_in">CGSize</span> textSize = <span class="built_in">CGSizeMake</span>(textW, MAXFLOAT);</span><br><span class="line">        <span class="built_in">CGFloat</span> textH = [<span class="keyword">self</span>.text boundingRectWithSize:textSize options:<span class="built_in">NSStringDrawingUsesLineFragmentOrigin</span> attributes:textAtt context:<span class="literal">nil</span>].size.height;</span><br><span class="line">        <span class="keyword">self</span>.textFrame = <span class="built_in">CGRectMake</span>(textX, textY, textW, textH);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//配图</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">self</span>.picture) &#123;</span><br><span class="line">            <span class="built_in">CGFloat</span> pictureWH = <span class="number">100</span>;</span><br><span class="line">            <span class="built_in">CGFloat</span> pictureX = iconX;</span><br><span class="line">            <span class="built_in">CGFloat</span> pictureY = <span class="built_in">CGRectGetMaxY</span>(<span class="keyword">self</span>.textFrame)+space;</span><br><span class="line">            <span class="keyword">self</span>.pictureFrame = <span class="built_in">CGRectMake</span>(pictureX, pictureY, pictureWH, pictureWH);</span><br><span class="line">            _cellHeight = <span class="built_in">CGRectGetMaxY</span>(<span class="keyword">self</span>.pictureFrame)+space;</span><br><span class="line">        &#125;<span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            _cellHeight = <span class="built_in">CGRectGetMaxY</span>(<span class="keyword">self</span>.textFrame)+space;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _cellHeight;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p>​</p>
</li>
<li><p>自定义cell必须继承UITableViewCell类</p>
<p><code>StatusCell.h</code></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  StatusCell.h</span></span><br><span class="line"><span class="comment">//  自定义不等高cell</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  Created by 武 on 18/1/26.</span></span><br><span class="line"><span class="comment">//  Copyright © 2018年 com. All rights reserved.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;UIKit/UIKit.h&gt;</span></span></span><br><span class="line"><span class="class"><span class="keyword">@class</span> <span class="title">Status</span>;</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">StatusCell</span> : <span class="title">UITableViewCell</span></span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> 微博模型</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>,<span class="keyword">strong</span>)  Status *status;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><code>StatusCell.m</code></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  StatusCell.m</span></span><br><span class="line"><span class="comment">//  自定义不等高cell</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  Created by 武 on 18/1/26.</span></span><br><span class="line"><span class="comment">//  Copyright © 2018年 com. All rights reserved.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#import <span class="meta-string">"StatusCell.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"Status.h"</span></span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">StatusCell</span>()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> 图像</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>,<span class="keyword">weak</span>) <span class="built_in">UIImageView</span> *iconImageView;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> 昵称</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>,<span class="keyword">weak</span>) <span class="built_in">UILabel</span> *nameLabel;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> vip</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>,<span class="keyword">weak</span>) <span class="built_in">UIImageView</span> *vipImageView;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> 正文</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>,<span class="keyword">weak</span>) <span class="built_in">UILabel</span> *text_Label;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> 配图</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>,<span class="keyword">weak</span>) <span class="built_in">UIImageView</span> *pictureImageView;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">StatusCell</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> 添加子控件的原则：把所有可能显示的子控件都先添加进去</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">-(<span class="keyword">instancetype</span>)initWithStyle:(<span class="built_in">UITableViewCellStyle</span>)style reuseIdentifier:(<span class="built_in">NSString</span> *)reuseIdentifier</span><br><span class="line">&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> initWithStyle:style reuseIdentifier:reuseIdentifier]) &#123;</span><br><span class="line">        <span class="comment">//图像</span></span><br><span class="line">        <span class="built_in">UIImageView</span> *iconImageView = [[<span class="built_in">UIImageView</span> alloc]init];</span><br><span class="line">        [<span class="keyword">self</span>.contentView addSubview:iconImageView];</span><br><span class="line">        <span class="keyword">self</span>.iconImageView = iconImageView;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//配图</span></span><br><span class="line">        <span class="built_in">UIImageView</span> *pictureImageView = [[<span class="built_in">UIImageView</span> alloc]init];</span><br><span class="line">        [<span class="keyword">self</span>.contentView addSubview:pictureImageView];</span><br><span class="line">        <span class="keyword">self</span>.pictureImageView = pictureImageView;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//vip</span></span><br><span class="line">        <span class="built_in">UIImageView</span> *vipImageView = [[<span class="built_in">UIImageView</span> alloc]init];</span><br><span class="line">        vipImageView.contentMode = <span class="built_in">UIViewContentModeCenter</span>;</span><br><span class="line">        vipImageView.image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"vip"</span>];</span><br><span class="line">        [<span class="keyword">self</span>.contentView addSubview:vipImageView];</span><br><span class="line">        <span class="keyword">self</span>.vipImageView = vipImageView;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//昵称</span></span><br><span class="line">        <span class="built_in">UILabel</span> *nameLabel = [[<span class="built_in">UILabel</span> alloc]init];</span><br><span class="line">        nameLabel.font = [<span class="built_in">UIFont</span> systemFontOfSize:<span class="number">14</span>];</span><br><span class="line">        [<span class="keyword">self</span>.contentView addSubview:nameLabel];</span><br><span class="line">        <span class="keyword">self</span>.nameLabel = nameLabel;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//正文</span></span><br><span class="line">        <span class="built_in">UILabel</span> *text_Label = [[<span class="built_in">UILabel</span> alloc]init];</span><br><span class="line">        text_Label.font = [<span class="built_in">UIFont</span> systemFontOfSize:<span class="number">14</span>];</span><br><span class="line">        text_Label.numberOfLines = <span class="number">0</span>;</span><br><span class="line">        [<span class="keyword">self</span>.contentView addSubview:text_Label];</span><br><span class="line">        <span class="keyword">self</span>.text_Label = text_Label;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> 设置子控件的数据</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)setStatus:(Status *)status</span><br><span class="line">&#123;</span><br><span class="line">    _status = status;</span><br><span class="line">    <span class="keyword">self</span>.iconImageView.image = [<span class="built_in">UIImage</span> imageNamed:status.icon];</span><br><span class="line">    <span class="keyword">self</span>.nameLabel.text = status.name;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (status.isVip) &#123;</span><br><span class="line">        <span class="keyword">self</span>.nameLabel.textColor = [<span class="built_in">UIColor</span> orangeColor];</span><br><span class="line">        <span class="keyword">self</span>.vipImageView.hidden = <span class="literal">NO</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">self</span>.vipImageView.hidden = <span class="literal">YES</span>;</span><br><span class="line">        <span class="keyword">self</span>.nameLabel.textColor = [<span class="built_in">UIColor</span> blackColor];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">self</span>.text_Label.text = status.text;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (status.picture) &#123;</span><br><span class="line">        <span class="keyword">self</span>.pictureImageView.hidden = <span class="literal">NO</span>;</span><br><span class="line">        <span class="keyword">self</span>.pictureImageView.image = [<span class="built_in">UIImage</span> imageNamed:status.picture];</span><br><span class="line">    &#125;<span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">self</span>.pictureImageView.hidden = <span class="literal">YES</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">self</span>.iconImageView.frame = <span class="keyword">self</span>.status.iconFrame;</span><br><span class="line">    <span class="keyword">self</span>.nameLabel.frame = <span class="keyword">self</span>.status.nameFrame;</span><br><span class="line">    <span class="keyword">self</span>.vipImageView.frame = <span class="keyword">self</span>.status.vipFrame;</span><br><span class="line">    <span class="keyword">self</span>.text_Label.frame = <span class="keyword">self</span>.status.textFrame;</span><br><span class="line">    <span class="keyword">self</span>.pictureImageView.frame = <span class="keyword">self</span>.status.pictureFrame;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><code>ViewController.m</code></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  ViewController.m</span></span><br><span class="line"><span class="comment">//  自定义不等高cell</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  Created by 武 on 18/1/25.</span></span><br><span class="line"><span class="comment">//  Copyright © 2018年 com. All rights reserved.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"Status.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"MJExtension.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"StatusCell.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>,<span class="keyword">strong</span>) <span class="built_in">NSArray</span> *statues;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">-(<span class="built_in">NSArray</span> *)statues</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (_statues==<span class="literal">nil</span>) &#123;</span><br><span class="line">        _statues = [Status mj_objectArrayWithFilename:<span class="string">@"statuses.plist"</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _statues;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">NSString</span> *ID = <span class="string">@"status"</span>;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];   </span><br><span class="line">    <span class="comment">//注册cell</span></span><br><span class="line">    [<span class="keyword">self</span>.tableView registerClass:[StatusCell <span class="keyword">class</span>] forCellReuseIdentifier:ID];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark 数据源方法</span></span><br><span class="line">- (<span class="built_in">NSInteger</span>)tableView:(<span class="built_in">UITableView</span> *)tableView numberOfRowsInSection:(<span class="built_in">NSInteger</span>)section</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>.statues.count;</span><br><span class="line">&#125;</span><br><span class="line">-(<span class="built_in">UITableViewCell</span> *)tableView:(<span class="built_in">UITableView</span> *)tableView cellForRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath</span><br><span class="line">&#123;</span><br><span class="line">    StatusCell *cell = [tableView dequeueReusableCellWithIdentifier:ID];</span><br><span class="line">    </span><br><span class="line">    cell.status = <span class="keyword">self</span>.statues[indexPath.row];</span><br><span class="line">    <span class="keyword">return</span> cell;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#pragma mark 代理方法</span></span><br><span class="line">- (<span class="built_in">CGFloat</span>)tableView:(<span class="built_in">UITableView</span> *)tableView heightForRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath</span><br><span class="line">&#123;</span><br><span class="line">    Status *status = <span class="keyword">self</span>.statues[indexPath.row];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> status.cellHeight;</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="built_in">BOOL</span>)prefersStatusBarHidden</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h4 id="TableView数据刷新"><a href="#TableView数据刷新" class="headerlink" title="TableView数据刷新"></a>TableView数据刷新</h4><ul>
<li><p>UITableView的刷新方法</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> (<span class="keyword">void</span>)reloadData;<span class="comment">//刷新整个表格。</span></span><br><span class="line">- (<span class="keyword">void</span>)reloadRowsAtIndexPaths:(<span class="built_in">NSArray</span> *)indexPaths withRowAnimation:(<span class="built_in">UITableViewRowAnimation</span>)animation <span class="built_in">NS_AVAILABLE_IOS</span>(<span class="number">3</span>_0);<span class="comment">//刷新指定的分组和行。</span></span><br><span class="line">- (<span class="keyword">void</span>)reloadSections:(<span class="built_in">NSIndexSet</span> *)sections withRowAnimation:(<span class="built_in">UITableViewRowAnimation</span>)animation <span class="built_in">NS_AVAILABLE_IOS</span>(<span class="number">3</span>_0);<span class="comment">//刷新指定的分组。</span></span><br><span class="line">- (<span class="keyword">void</span>)deleteRowsAtIndexPaths:(<span class="built_in">NSArray</span> *)indexPaths withRowAnimation:(<span class="built_in">UITableViewRowAnimation</span>)animation;<span class="comment">//删除时刷新指定的行数据。</span></span><br><span class="line">- (<span class="keyword">void</span>)insertRowsAtIndexPaths:(<span class="built_in">NSArray</span> *)indexPaths withRowAnimation:(<span class="built_in">UITableViewRowAnimation</span>)animation;<span class="comment">//添加时刷新指定的行数据。</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>全局刷新</p>
<p><code>示例说明</code>在Main.storyboard中添加一个UIView里面包含3个按钮分别是添加、更新、删除。下面再添加一个TableView。</p>
<p>如下图</p>
<p><img src="/2018/01/29/UITableView/5.png" alt="图5"></p>
<p><code>模型类Wine.h</code></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  Wine.h</span></span><br><span class="line"><span class="comment">//  全局刷新</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  Created by 武 on 18/2/1.</span></span><br><span class="line"><span class="comment">//  Copyright © 2018年 com. All rights reserved.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Wine</span> : <span class="title">NSObject</span></span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> 图标</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>,<span class="keyword">copy</span>) <span class="built_in">NSString</span> *image;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> 价格</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>,<span class="keyword">copy</span>) <span class="built_in">NSString</span> *money;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> 名称</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>,<span class="keyword">copy</span>) <span class="built_in">NSString</span> *name;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><code>自定义cell-WineCell.h</code></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  WineCell.h</span></span><br><span class="line"><span class="comment">//  全局刷新</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  Created by 武 on 18/2/1.</span></span><br><span class="line"><span class="comment">//  Copyright © 2018年 com. All rights reserved.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;UIKit/UIKit.h&gt;</span></span></span><br><span class="line"><span class="class"><span class="keyword">@class</span> <span class="title">Wine</span>;</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">WineCell</span> : <span class="title">UITableViewCell</span></span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> 模型属性</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>,<span class="keyword">strong</span>) Wine *wine;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><code>WineCell.m</code></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  WineCell.m</span></span><br><span class="line"><span class="comment">//  全局刷新</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  Created by 武 on 18/2/1.</span></span><br><span class="line"><span class="comment">//  Copyright © 2018年 com. All rights reserved.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"WineCell.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"Wine.h"</span></span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">WineCell</span></span></span><br><span class="line"></span><br><span class="line">-(<span class="keyword">void</span>)setWine:(Wine *)wine</span><br><span class="line">&#123;</span><br><span class="line">    _wine = wine;</span><br><span class="line">    <span class="keyword">self</span>.textLabel.text = wine.name;</span><br><span class="line">    <span class="keyword">self</span>.imageView.image = [<span class="built_in">UIImage</span> imageNamed:wine.image];</span><br><span class="line">    <span class="keyword">self</span>.detailTextLabel.text = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"¥%@"</span>,wine.money];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><code>ViewController.m</code></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  ViewController.m</span></span><br><span class="line"><span class="comment">//  全局刷新</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  Created by 武 on 18/2/1.</span></span><br><span class="line"><span class="comment">//  Copyright © 2018年 com. All rights reserved.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"MJExtension.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"Wine.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"WineCell.h"</span></span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()&lt;<span class="title">UITableViewDataSource</span>&gt;</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UITableView</span> *tableView;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> 所有的数据</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>,<span class="keyword">strong</span>)<span class="built_in">NSMutableArray</span> *wineArray;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> 从plist文件加载数据，使用MJExtension框架</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">-(<span class="built_in">NSMutableArray</span> *)wineArray</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (_wineArray==<span class="literal">nil</span>) &#123;</span><br><span class="line">        _wineArray = [Wine mj_objectArrayWithFilename:<span class="string">@"wine.plist"</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _wineArray;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> 点击添加</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">- (<span class="keyword">IBAction</span>)add &#123;</span><br><span class="line">    <span class="comment">//新建一个模型</span></span><br><span class="line">    Wine *wine = [[Wine alloc]init];</span><br><span class="line">    wine.image = <span class="string">@"newWine"</span>;</span><br><span class="line">    wine.money = <span class="string">@"999.9"</span>;</span><br><span class="line">    wine.name = <span class="string">@"茅台"</span>;</span><br><span class="line">    <span class="comment">// [self.wineArray addObject:wine];//添加到表格最后</span></span><br><span class="line">    [<span class="keyword">self</span>.wineArray insertObject:wine atIndex:<span class="number">0</span>];<span class="comment">//添加到表格第一位</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//数据发生变化，刷新数据（全局刷新）</span></span><br><span class="line">    [<span class="keyword">self</span>.tableView reloadData];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> 点击删除</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">- (<span class="keyword">IBAction</span>)delete &#123;</span><br><span class="line">    <span class="comment">// 删除模型</span></span><br><span class="line">    [<span class="keyword">self</span>.wineArray removeObjectAtIndex:<span class="number">0</span>];</span><br><span class="line">    [<span class="keyword">self</span>.wineArray removeObjectAtIndex:<span class="number">0</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//全局刷新</span></span><br><span class="line">    [<span class="keyword">self</span>.tableView reloadData];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> 点击更新</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">- (<span class="keyword">IBAction</span>)update &#123;</span><br><span class="line">    <span class="comment">// 更新模型，把价格改为100</span></span><br><span class="line">    Wine *wine = <span class="keyword">self</span>.wineArray[<span class="number">0</span>];</span><br><span class="line">    wine.money = <span class="string">@"100"</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 全局刷新</span></span><br><span class="line">    [<span class="keyword">self</span>.tableView reloadData];</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#pragma mark 数据源方法</span></span><br><span class="line">- (<span class="built_in">NSInteger</span>)tableView:(<span class="built_in">UITableView</span> *)tableView numberOfRowsInSection:(<span class="built_in">NSInteger</span>)section</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>.wineArray.count;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">-(<span class="built_in">UITableViewCell</span> *)tableView:(<span class="built_in">UITableView</span> *)tableView cellForRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="built_in">NSString</span> *ID = <span class="string">@"wine"</span>;</span><br><span class="line">    WineCell *cell = [tableView dequeueReusableCellWithIdentifier:ID];</span><br><span class="line">    <span class="keyword">if</span> (cell==<span class="literal">nil</span>) &#123;</span><br><span class="line">        cell = [[WineCell alloc]initWithStyle:<span class="built_in">UITableViewCellStyleSubtitle</span> reuseIdentifier:ID];</span><br><span class="line">    &#125;</span><br><span class="line">    cell.wine = _wineArray[indexPath.row];</span><br><span class="line">    <span class="keyword">return</span> cell;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p>运行如下</p>
<p><img src="/2018/01/29/UITableView/6.png" alt="图5"></p>
<ul>
<li><p>局部刷新（操作那一行数据刷新哪一行）</p>
<p><code>修改add、update、delete三个方法的代码如下</code></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">IBAction</span>)add &#123;</span><br><span class="line">    <span class="comment">// 修改模型</span></span><br><span class="line">    XMGWine *wine = [[XMGWine alloc] init];</span><br><span class="line">    wine.image = <span class="string">@"newWine"</span>;</span><br><span class="line">    wine.money = <span class="string">@"56"</span>;</span><br><span class="line">    wine.name = <span class="string">@"杏花村"</span>;</span><br><span class="line">    [<span class="keyword">self</span>.wineArray insertObject:wine atIndex:<span class="number">0</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 这是全局刷新</span></span><br><span class="line"><span class="comment">//    [self.tableView reloadData];</span></span><br><span class="line">    <span class="comment">// 局部刷新</span></span><br><span class="line">    <span class="built_in">NSArray</span> *indexPaths = @[</span><br><span class="line">                            [<span class="built_in">NSIndexPath</span> indexPathForRow:<span class="number">0</span> inSection:<span class="number">0</span>]</span><br><span class="line">                            ];</span><br><span class="line">    [<span class="keyword">self</span>.tableView insertRowsAtIndexPaths:indexPaths withRowAnimation:<span class="built_in">UITableViewRowAnimationRight</span>];</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">IBAction</span>)remove &#123;</span><br><span class="line">    <span class="comment">// 修改模型</span></span><br><span class="line">    [<span class="keyword">self</span>.wineArray removeObjectAtIndex:<span class="number">0</span>];</span><br><span class="line">    [<span class="keyword">self</span>.wineArray removeObjectAtIndex:<span class="number">0</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 局部刷新</span></span><br><span class="line">    <span class="built_in">NSArray</span> *indexPaths = @[</span><br><span class="line">                            [<span class="built_in">NSIndexPath</span> indexPathForRow:<span class="number">0</span> inSection:<span class="number">0</span>],</span><br><span class="line">                            [<span class="built_in">NSIndexPath</span> indexPathForRow:<span class="number">1</span> inSection:<span class="number">0</span>],</span><br><span class="line">                            ];</span><br><span class="line">    [<span class="keyword">self</span>.tableView deleteRowsAtIndexPaths:indexPaths withRowAnimation:<span class="built_in">UITableViewRowAnimationMiddle</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 这是全局刷新</span></span><br><span class="line"><span class="comment">//    [self.tableView reloadData];</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">IBAction</span>)update &#123;</span><br><span class="line">    <span class="comment">// 修改模型</span></span><br><span class="line">    XMGWine *wine = <span class="keyword">self</span>.wineArray[<span class="number">0</span>];</span><br><span class="line">    wine.money = <span class="string">@"100"</span>;</span><br><span class="line">    </span><br><span class="line">    XMGWine *wine2  = <span class="keyword">self</span>.wineArray[<span class="number">1</span>];</span><br><span class="line">    wine2.name = <span class="string">@"呵呵"</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 局部刷新</span></span><br><span class="line">    <span class="built_in">NSArray</span> *indexPaths = @[</span><br><span class="line">                            [<span class="built_in">NSIndexPath</span> indexPathForRow:<span class="number">0</span> inSection:<span class="number">0</span>],</span><br><span class="line">                            [<span class="built_in">NSIndexPath</span> indexPathForRow:<span class="number">1</span> inSection:<span class="number">0</span>]</span><br><span class="line">                            ];</span><br><span class="line">    [<span class="keyword">self</span>.tableView reloadRowsAtIndexPaths:indexPaths withRowAnimation:<span class="built_in">UITableViewRowAnimationLeft</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="左滑删除"><a href="#左滑删除" class="headerlink" title="左滑删除"></a>左滑删除</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> 只要实现这个方法，就拥有左滑删除功能</span><br><span class="line"> 点击左滑出现的Delete按钮会调用这个</span><br><span class="line"> */</span><br><span class="line">-(void)tableView:(UITableView *)tableView commitEditingStyle:(UITableViewCellEditingStyle)editingStyle forRowAtIndexPath:(NSIndexPath *)indexPath</span><br><span class="line">&#123;</span><br><span class="line">    NSLog(@&quot;commitEditingStyle--&quot;);</span><br><span class="line">    [self.wineArray removeObjectAtIndex:indexPath.row];</span><br><span class="line">    [self.tableView deleteRowsAtIndexPaths:@[indexPath] withRowAnimation:UITableViewRowAnimationTop];//局部删除删除</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>UITableViewRowAction</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">//左滑出现什么按钮</span><br><span class="line">- (NSArray&lt;UITableViewRowAction *&gt; *)tableView:(UITableView *)tableView editActionsForRowAtIndexPath:(NSIndexPath *)indexPath</span><br><span class="line">&#123;</span><br><span class="line">    UITableViewRowAction *action = [UITableViewRowAction rowActionWithStyle:UITableViewRowActionStyleNormal title:@&quot;关注&quot; handler:^(UITableViewRowAction * _Nonnull action, NSIndexPath * _Nonnull indexPath) &#123;</span><br><span class="line">        self.tableView.editing = NO;</span><br><span class="line">    &#125;];</span><br><span class="line">    UITableViewRowAction *action1 = [UITableViewRowAction rowActionWithStyle:UITableViewRowActionStyleDestructive title:@&quot;删除&quot; handler:^(UITableViewRowAction * _Nonnull action, NSIndexPath * _Nonnull indexPath) &#123;</span><br><span class="line">        </span><br><span class="line">        [self.wineArray removeObjectAtIndex:indexPath.row];</span><br><span class="line">        [self.tableView deleteRowsAtIndexPaths:@[indexPath] withRowAnimation:UITableViewRowAnimationAutomatic];</span><br><span class="line">        </span><br><span class="line">    &#125;];</span><br><span class="line">    return @[action,action1];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="编辑模式"><a href="#编辑模式" class="headerlink" title="编辑模式"></a>编辑模式</h5><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">IBAction</span>)remove</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//进入编辑模式，点击删除按钮取反</span></span><br><span class="line">  [<span class="keyword">self</span>.tableView setEditing:!<span class="keyword">self</span>.tableView.isEditing animated:<span class="literal">YES</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="自定义批量删除"><a href="#自定义批量删除" class="headerlink" title="自定义批量删除"></a>自定义批量删除</h5><p><code>在cell里面添加一个打勾的UIImageView的控件并设置尺寸该控件选择的时候显示，默认隐藏</code></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  WineCell.m</span></span><br><span class="line"><span class="comment">//  全局刷新</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  Created by 武 on 18/2/1.</span></span><br><span class="line"><span class="comment">//  Copyright © 2018年 com. All rights reserved.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#import <span class="meta-string">"WineCell.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"Wine.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">WineCell</span>()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> 打钩控件</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>,<span class="keyword">weak</span>) <span class="built_in">UIImageView</span> *checkedImageView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">WineCell</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> 初始化控件</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">- (<span class="keyword">instancetype</span>)initWithStyle:(<span class="built_in">UITableViewCellStyle</span>)style reuseIdentifier:(<span class="built_in">NSString</span> *)reuseIdentifier</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> initWithStyle:style reuseIdentifier:reuseIdentifier]) &#123;</span><br><span class="line">      </span><br><span class="line">        <span class="comment">//添加打勾控件</span></span><br><span class="line">        <span class="built_in">UIImageView</span> *checkImageView = [[<span class="built_in">UIImageView</span> alloc]init];</span><br><span class="line">        checkImageView.hidden = <span class="literal">YES</span>;</span><br><span class="line">        checkImageView.image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"check"</span>];</span><br><span class="line">        [<span class="keyword">self</span>.contentView addSubview:checkImageView];</span><br><span class="line">        <span class="keyword">self</span>.checkedImageView = checkImageView;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>)layoutSubviews</span><br><span class="line">&#123;</span><br><span class="line">    [<span class="keyword">super</span> layoutSubviews];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//设置打勾控件的位置和尺寸</span></span><br><span class="line">    <span class="built_in">CGFloat</span> WH = <span class="number">24</span>;</span><br><span class="line">    <span class="built_in">CGFloat</span> X = <span class="keyword">self</span>.contentView.frame.size.width - WH - <span class="number">10</span>;</span><br><span class="line">    <span class="built_in">CGFloat</span> Y = (<span class="keyword">self</span>.contentView.frame.size.height-WH)*<span class="number">0.5</span>;</span><br><span class="line">    <span class="keyword">self</span>.checkedImageView.frame = <span class="built_in">CGRectMake</span>(X, Y, WH, WH);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//调整cell textLabel的宽度</span></span><br><span class="line">    <span class="built_in">CGRect</span> frame = <span class="keyword">self</span>.textLabel.frame;</span><br><span class="line">    frame.size.width = <span class="keyword">self</span>.contentView.frame.size.width-WH<span class="number">-20</span>-<span class="keyword">self</span>.textLabel.frame.origin.x;</span><br><span class="line">    <span class="keyword">self</span>.textLabel.frame = frame;</span><br><span class="line">&#125;</span><br><span class="line">-(<span class="keyword">void</span>)setWine:(Wine *)wine</span><br><span class="line">&#123;</span><br><span class="line">    _wine = wine;</span><br><span class="line">    <span class="keyword">self</span>.textLabel.text = wine.name;</span><br><span class="line">    <span class="keyword">self</span>.imageView.image = [<span class="built_in">UIImage</span> imageNamed:wine.image];</span><br><span class="line">    <span class="keyword">self</span>.detailTextLabel.text = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"¥%@"</span>,wine.money];</span><br><span class="line">  <span class="comment">//根据模型的checked属性确定打勾控件显示还是隐藏</span></span><br><span class="line">    <span class="keyword">if</span> (wine.isChecked) &#123;</span><br><span class="line">        <span class="keyword">self</span>.checkedImageView.hidden = <span class="literal">NO</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">self</span>.checkedImageView.hidden = <span class="literal">YES</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><code>在模型类Wine.h里添加一个BOOL属性记录打勾控件的状态</code></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> 记录打勾控件的状态</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>,<span class="keyword">assign</span>,<span class="keyword">getter</span>=isChecked) <span class="built_in">BOOL</span> checked;</span><br></pre></td></tr></table></figure>
<p><code>ViewController.m</code></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  ViewController.m</span></span><br><span class="line"><span class="comment">//  全局刷新</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  Created by 武 on 18/2/1.</span></span><br><span class="line"><span class="comment">//  Copyright © 2018年 com. All rights reserved.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"MJExtension.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"Wine.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"WineCell.h"</span></span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()&lt;<span class="title">UITableViewDataSource</span>,<span class="title">UITableViewDelegate</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UITableView</span> *tableView;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> 所有的数据</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>,<span class="keyword">strong</span>)<span class="built_in">NSMutableArray</span> *wineArray;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> 记录所有选中行的索引</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>,<span class="keyword">strong</span>)<span class="built_in">NSMutableArray</span> *selectedIndexPath;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line">- (<span class="built_in">NSMutableArray</span> *)selectedIndexPath</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (!_selectedIndexPath) &#123;</span><br><span class="line">        _selectedIndexPath = [<span class="built_in">NSMutableArray</span> array];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _selectedIndexPath;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">IBAction</span>)remove &#123;</span><br><span class="line">    <span class="comment">//进入编辑模式，点击删除按钮取反</span></span><br><span class="line">    <span class="comment">//[self.tableView setEditing:!self.tableView.isEditing animated:YES];</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//获取要删除的所有模型</span></span><br><span class="line">    <span class="built_in">NSMutableArray</span> *deleteWine = [<span class="built_in">NSMutableArray</span> array];</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">NSIndexPath</span> *indexPath <span class="keyword">in</span> <span class="keyword">self</span>.selectedIndexPath) &#123;</span><br><span class="line">        [deleteWine addObject:<span class="keyword">self</span>.wineArray[indexPath.row]];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//删除模型</span></span><br><span class="line">    [<span class="keyword">self</span>.wineArray removeObjectsInArray:deleteWine];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//刷新表格</span></span><br><span class="line">    [<span class="keyword">self</span>.tableView deleteRowsAtIndexPaths:<span class="keyword">self</span>.selectedIndexPath withRowAnimation:<span class="built_in">UITableViewRowAnimationAutomatic</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//注意操作一次必须清空数组，要不然会数组角标越界</span></span><br><span class="line">    [<span class="keyword">self</span>.selectedIndexPath removeAllObjects];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> 从plist文件加载数据，使用MJExtension框架</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">-(<span class="built_in">NSMutableArray</span> *)wineArray</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (_wineArray==<span class="literal">nil</span>) &#123;</span><br><span class="line">        _wineArray = [Wine mj_objectArrayWithFilename:<span class="string">@"wine.plist"</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _wineArray;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>#pragma mark 数据源方法</p>
<ul>
<li>(NSInteger)tableView:(UITableView *)tableView numberOfRowsInSection:(NSInteger)section<br>{<br>  return self.wineArray.count;<br>}</li>
</ul>
<p>-(UITableViewCell <em>)tableView:(UITableView </em>)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath<br>{</p>
<pre><code>static NSString *ID = @&quot;wine&quot;;
WineCell *cell = [tableView dequeueReusableCellWithIdentifier:ID];
if (cell==nil) {
    cell = [[WineCell alloc]initWithStyle:UITableViewCellStyleSubtitle reuseIdentifier:ID];
}
cell.wine = _wineArray[indexPath.row];
return cell;
</code></pre><p>}</p>
<p>#pragma mark - 代理方法<br>/<em>*<br> 只要实现这个方法，就拥有左滑删除功能<br> 点击左滑出现的Delete按钮会调用这个
 </em>/<br>-(void)tableView:(UITableView <em>)tableView commitEditingStyle:(UITableViewCellEditingStyle)editingStyle forRowAtIndexPath:(NSIndexPath </em>)indexPath<br>{</p>
<pre><code>NSLog(@&quot;commitEditingStyle--&quot;);
[self.wineArray removeObjectAtIndex:indexPath.row];
[self.tableView deleteRowsAtIndexPaths:@[indexPath] withRowAnimation:UITableViewRowAnimationTop];//局部删除删除
</code></pre><p>}</p>
<ul>
<li><p>(NSArray<uitableviewrowaction *=""> <em>)tableView:(UITableView </em>)tableView editActionsForRowAtIndexPath:(NSIndexPath <em>)indexPath<br>{<br>  UITableViewRowAction </em>action = [UITableViewRowAction rowActionWithStyle:UITableViewRowActionStyleNormal title:@”关注” handler:^(UITableViewRowAction <em> _Nonnull action, NSIndexPath </em> _Nonnull indexPath) {</uitableviewrowaction></p>
<pre><code>self.tableView.editing = NO;
</code></pre><p>  }];<br>  UITableViewRowAction <em>action1 = [UITableViewRowAction rowActionWithStyle:UITableViewRowActionStyleDestructive title:@”删除” handler:^(UITableViewRowAction </em> _Nonnull action, NSIndexPath * _Nonnull indexPath) {</p>
<pre><code>[self.wineArray removeObjectAtIndex:indexPath.row];
[self.tableView deleteRowsAtIndexPaths:@[indexPath] withRowAnimation:UITableViewRowAnimationAutomatic];
</code></pre><p>  }];<br>  return @[action,action1];<br>}<br>//选择那一行的操作</p>
</li>
<li><p>(void)tableView:(UITableView <em>)tableView didSelectRowAtIndexPath:(NSIndexPath </em>)indexPath<br>{<br>  //修改模型<br>  Wine *wine = self.wineArray[indexPath.row];<br>  if (wine.isChecked) {//之前是打勾的就取反</p>
<pre><code>wine.checked = NO;
[self.selectedIndexPath removeObject:indexPath];
</code></pre><p>  }else<br>  {//之前不是打勾的，现在打勾</p>
<pre><code>wine.checked = YES;
[self.selectedIndexPath addObject:indexPath];
</code></pre><p>  }</p>
<p>  //局部刷新表格<br>  [self.tableView reloadRowsAtIndexPaths:@[indexPath] withRowAnimation:UITableViewRowAnimationAutomatic];<br>}<br>@end<br>```</p>
</li>
</ul>
<p>运行效果</p>
<p><img src="/2018/01/29/UITableView/7.png" alt="图7"></p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>​</p>
</li>
</ul>
]]></content>
      
        <categories>
            
            <category> iOS开发 </category>
            
        </categories>
        
        
        <tags>
            
            <tag> iOS </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[UIScrollView]]></title>
      <url>/2018/01/29/UIScrollView/</url>
      <content type="html"><![CDATA[<h4 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h4><p>UIScrollView是UIView的子类，这是一个可以处理滚动操作的UI控件在开发过程中使用很频繁。</p>
<h4 id="属性"><a href="#属性" class="headerlink" title="属性"></a>属性</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@property</span>(<span class="keyword">nonatomic</span>) <span class="built_in">CGPoint</span> contentOffset;<span class="comment">//内容偏移量，当前显示的内容得顶点相对此控件顶点x,y轴之间的距离，默认为CGPointZero</span></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">nonatomic</span>) <span class="built_in">CGSize</span> contentSize;<span class="comment">//控件内容大小，不一定在显示区域，如果这个属性不设置，此控件将无法滚动，默认为CGSizeZero;</span></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">nonatomic</span>) <span class="built_in">UIEdgeInsets</span> contentInset;<span class="comment">//控件四周边距，类似于css中的margin，注意边距不座位其内容的一部分，默认为UIEdgeInsertZero;</span></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">nonatomic</span>,<span class="keyword">assign</span>) <span class="keyword">id</span>&lt;<span class="built_in">UIScrollViewDelegate</span>&gt; delegate; <span class="comment">//控件代理，一般用于事件监听，在iOS中多数控件都是通过代理来进行事件监听的</span></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">nonatomic</span>) <span class="built_in">BOOL</span> bounces;<span class="comment">//启用弹簧效果，启用弹簧效果后拖动到边缘可以看到内容后面的背景，默认设置为YES</span></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">nonatomic</span>,<span class="keyword">getter</span>=isPagingEnabled)<span class="built_in">BOOL</span> pagingEnabled;<span class="comment">//是否分页，如果分页的话每次左右拖动的距离只屏幕宽度的整倍数，默认设置为NO</span></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">nonatomic</span>,<span class="keyword">getter</span>=isScrollEnabled)<span class="built_in">BOOL</span> scrollEnabled;<span class="comment">//是否启用滚动，默认也YES</span></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">nonatomic</span>) <span class="built_in">BOOL</span> showsHorizontalScrollIndicator;<span class="comment">//是否显示横向滚动条，默认为YES</span></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">nonatomic</span>) <span class="built_in">BOOL</span> showsVerticalScrollIndicator;<span class="comment">//是否显示纵向滚动条，默认为YES</span></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">nonatomic</span>) <span class="built_in">CGFloat</span> minimumZoomScale;<span class="comment">//最小缩放倍数，默认为1.0</span></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">nonatomic</span>) <span class="built_in">CGFloat</span> maximumZoomScale;<span class="comment">//最大缩放倍数(注意只有maximumZoomScale大于minimumZoomScale才有可能缩放)默认为1.0</span></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">nonatomic</span>,<span class="keyword">readonly</span>,<span class="keyword">getter</span>= isTracking)<span class="built_in">BOOL</span> tracking;<span class="comment">//状态是否被追踪，手指按下去并且还没有拖动的时候是YES，其他情况均为NO</span></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">nonatomic</span>,<span class="keyword">readonly</span>,<span class="keyword">getter</span>= isDragging)<span class="built_in">BOOL</span> dragging;<span class="comment">//判断状态是否被拖拽</span></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">nonatomic</span>,<span class="keyword">readonly</span>,<span class="keyword">getter</span>=isDecelerating)<span class="built_in">BOOL</span> decelerating;<span class="comment">//判断状态是否减速</span></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">nonatomic</span>,<span class="keyword">readonly</span>,<span class="keyword">getter</span>=isZomming)<span class="built_in">BOOL</span> zomming;<span class="comment">//判断状态是否缩放</span></span><br></pre></td></tr></table></figure>
<h4 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)setContentOffset:(<span class="built_in">CGPoint</span>)contentOffset animated:(<span class="built_in">BOOL</span>)animated;<span class="comment">//设置滚动位置，第二个参数表示是否启用动画效果</span></span><br><span class="line">- (<span class="keyword">void</span>)scrollRectToVisible:(<span class="built_in">CGRect</span>)rect animated:(<span class="built_in">BOOL</span>)animated;<span class="comment">//滚动并显示指定区域的内容，第二个参数表示是否启用动画效果</span></span><br></pre></td></tr></table></figure>
<h4 id="代理方法"><a href="#代理方法" class="headerlink" title="代理方法"></a>代理方法</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)scrollViewDidScroll:(<span class="built_in">UIScrollView</span> *)scrollView;<span class="comment">//滚动事件方法，滚动过程中会一直循环执行</span></span><br><span class="line">- (<span class="keyword">void</span>)scrollViewWillBeginDragging:(<span class="built_in">UIScrollView</span> *)scrollView;<span class="comment">//开始拖拽事件</span></span><br><span class="line">- (<span class="keyword">void</span>)scrollViewDidEndDragging:(<span class="built_in">UIScrollView</span> *)scrollView willDecelerate:(<span class="built_in">BOOL</span>)decelerate;<span class="comment">//拖拽操作完成事件方法</span></span><br><span class="line">- (<span class="keyword">void</span>)scrollViewWillBeginDecelerating:(<span class="built_in">UIScrollView</span> *)scrollView;<span class="comment">//即将停止滚动事件方法（拖拽松开后开始减速时执行）</span></span><br><span class="line">- (<span class="keyword">void</span>)scrollViewDidEndDecelerating:(<span class="built_in">UIScrollView</span> *)scrollView;<span class="comment">//滚动停止事件方法（滚动过程中减速停止后执行）</span></span><br><span class="line">- (<span class="keyword">void</span>)scrollViewWillBeginZooming:(<span class="built_in">UIScrollView</span> *)scrollView withView:(<span class="built_in">UIView</span> *)view <span class="built_in">NS_AVAILABLE_IOS</span>(<span class="number">3</span>_2);<span class="comment">//开始缩放事件方法</span></span><br><span class="line">- (<span class="keyword">void</span>)scrollViewDidZoom:(<span class="built_in">UIScrollView</span> *)scrollView <span class="built_in">NS_AVAILABLE_IOS</span>(<span class="number">3</span>_2);<span class="comment">//缩放操作完成事件方法</span></span><br><span class="line">- (<span class="built_in">UIView</span> *)viewForZoomingInScrollView:(<span class="built_in">UIScrollView</span> *)scrollView;<span class="comment">//返回缩放视图，注意只有实现这个代理方法才能进行缩放，此方法返回需要缩放的视图</span></span><br></pre></td></tr></table></figure>
<h4 id="简单示例"><a href="#简单示例" class="headerlink" title="简单示例"></a>简单示例</h4><ul>
<li><p>ViewController.h</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  ViewController.h</span></span><br><span class="line"><span class="comment">//  UIScrollView-1</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  Created by 武 on 18/1/29.</span></span><br><span class="line"><span class="comment">//  Copyright © 2018年 com. All rights reserved.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;UIKit/UIKit.h&gt;</span></span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> : <span class="title">UIViewController</span></span></span><br><span class="line">  </span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>,<span class="keyword">strong</span>) <span class="built_in">UIScrollView</span> *scrollview;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>,<span class="keyword">strong</span>) <span class="built_in">UIImageView</span> *imageView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>ViewController.m</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  ViewController.m</span></span><br><span class="line"><span class="comment">//  UIScrollView-1</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  Created by 武 on 18/1/29.</span></span><br><span class="line"><span class="comment">//  Copyright © 2018年 com. All rights reserved.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//实现UIScrollView代理</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()&lt;<span class="title">UIScrollViewDelegate</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//添加scrollview控件</span></span><br><span class="line">    <span class="comment">//注意UIScreen代表当前屏幕对象，applicationFrame是当前屏幕内容区域</span></span><br><span class="line">    _scrollview = [[<span class="built_in">UIScrollView</span> alloc]initWithFrame:[<span class="built_in">UIScreen</span> mainScreen].applicationFrame];</span><br><span class="line">    _scrollview.contentMode = <span class="built_in">UIViewContentModeScaleToFill</span>;</span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:_scrollview];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//添加图片控件</span></span><br><span class="line">    <span class="built_in">UIImage</span> *image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"timg"</span>];</span><br><span class="line">    _imageView = [[<span class="built_in">UIImageView</span> alloc]initWithImage:image];</span><br><span class="line">    [_scrollview addSubview:_imageView];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//contentSize必须设置，否则无法滚动，当前设置为图片大小</span></span><br><span class="line">    _scrollview.contentSize = _imageView.frame.size;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//实现缩放：maxinumZoomScale必须大于minimumZoomScale同时实现viewForZoomingInScrollView方法</span></span><br><span class="line">    _scrollview.minimumZoomScale = <span class="number">0.6</span>;</span><br><span class="line">    _scrollview.maximumZoomScale = <span class="number">3.0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//设置代理为viewController</span></span><br><span class="line">    _scrollview.delegate = <span class="keyword">self</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//边距，不属于内容部分，内容坐标（0，0）指的是内容的左上角不包括边界</span></span><br><span class="line">    <span class="comment">//_scrollView.contentInset=UIEdgeInsetsMake(10, 20, 10, 20);</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//显示滚动内容的指定位置</span></span><br><span class="line">    <span class="comment">//_scrollView.contentOffset=CGPointMake(10, 0);</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//隐藏滚动条</span></span><br><span class="line">    _scrollview.showsHorizontalScrollIndicator = <span class="literal">NO</span>;</span><br><span class="line">    _scrollview.showsVerticalScrollIndicator = <span class="literal">NO</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//禁用弹簧效果</span></span><br><span class="line">    <span class="comment">//_scrollView.bounces=NO;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#pragma mark 代理方法</span></span><br><span class="line">- (<span class="built_in">UIView</span> *)viewForZoomingInScrollView:(<span class="built_in">UIScrollView</span> *)scrollView</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> _imageView;</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>)scrollViewWillBeginDecelerating:(<span class="built_in">UIScrollView</span> *)scrollView</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"scrollViewWillBeginDecelerating"</span>);</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>)scrollViewDidEndDecelerating:(<span class="built_in">UIScrollView</span> *)scrollView</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"scrollViewDidEndDecelerating"</span>);</span><br><span class="line">&#125;</span><br><span class="line">-(<span class="keyword">void</span>)scrollViewWillBeginDragging:(<span class="built_in">UIScrollView</span> *)scrollView&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"scrollViewWillBeginDragging"</span>);</span><br><span class="line">&#125;</span><br><span class="line">-(<span class="keyword">void</span>)scrollViewDidEndDragging:(<span class="built_in">UIScrollView</span> *)scrollView willDecelerate:(<span class="built_in">BOOL</span>)decelerate&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"scrollViewDidEndDragging"</span>);</span><br><span class="line">&#125;</span><br><span class="line">-(<span class="keyword">void</span>)scrollViewWillBeginZooming:(<span class="built_in">UIScrollView</span> *)scrollView withView:(<span class="built_in">UIView</span> *)view&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"scrollViewWillBeginZooming"</span>);</span><br><span class="line">&#125;</span><br><span class="line">-(<span class="keyword">void</span>)scrollViewDidEndZooming:(<span class="built_in">UIScrollView</span> *)scrollView withView:(<span class="built_in">UIView</span> *)view atScale:(<span class="built_in">CGFloat</span>)scale&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"scrollViewDidEndZooming"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark 当图片小于屏幕宽高时缩放后让图片显示到屏幕中间</span></span><br><span class="line">- (<span class="keyword">void</span>)scrollViewDidZoom:(<span class="built_in">UIScrollView</span> *)scrollView</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">CGSize</span> originalSize = _scrollview.bounds.size;</span><br><span class="line">    <span class="built_in">CGSize</span> contentSize = _scrollview.contentSize;</span><br><span class="line">    <span class="comment">//计算偏移量X轴</span></span><br><span class="line">    <span class="built_in">CGFloat</span> offSetx = originalSize.width&gt;contentSize.width?(originalSize.width-contentSize.width)/<span class="number">2</span>:<span class="number">0</span>;</span><br><span class="line">    <span class="comment">//计算偏移量Y轴</span></span><br><span class="line">    <span class="built_in">CGFloat</span> offSetY = originalSize.height&gt;contentSize.height?(originalSize.height-contentSize.height)/<span class="number">2</span>:<span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    _imageView.center = <span class="built_in">CGPointMake</span>(contentSize.width/<span class="number">2</span>+offSetx, contentSize.height/<span class="number">2</span>+offSetY);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>效果如下图</p>
<p><img src="/2018/01/29/UIScrollView/1.png" alt="效果图"></p>
<p>​</p>
</li>
</ul>
<h4 id="UIScrollView实战-实现无限循环"><a href="#UIScrollView实战-实现无限循环" class="headerlink" title="UIScrollView实战-实现无限循环"></a>UIScrollView实战-实现无限循环</h4><ul>
<li>说明<ul>
<li><code>如何无限循环</code>一种是无限循环叠加图片，另一种就是如果最后一张图片浏览完立即显示第一张图片。很明显第一种方法是不现实的，使用第二种方式。其实使用第二种方式实现原理比较简单，只要在图片前后各放一张图片即可（此时共有n+2个图片在UIScrollView中）。例如我们有5张图片，只要使用7个UIImageView依次存放：图片5，图片1，图片2，图片3，图片4，图片5，图片1。当从图片1滚动到图片5时由于最后一张是图片1就给用户一种无限循环的感觉，当这张图完全显示后我们迅速将UIScrollView的contentOffset设置到第二个UIImageView，也就是图片1，接着用户可以继续向后滚动。当然向前滚动原理完全一样，当滚动到第一张图片（图片5）就迅速设置UIScrollView的contentOffset显示第6张图（图片5）。</li>
<li><code>如何优化性能</code>如果图片过多这些图片势必全部加载到内存消耗很大，其实完全没必要创建n+2个UIImageView，其实3个已经足够，只要一直保持显示中间的UIImageView，滚动时动态更改三个UIImageView的图片即可。例如三个UIImageView默认放图片5、图片1、图片2，当前显示中间的UIImageView，也就是图片1,。如果向后滚动那么就会显示图片2，当图片2显示完整后迅速重新设置三个UIImageView的内容为图片1、图片2、图片3，然后通过contentOffset设置显示中间的UIImageView，也就是图片2。继续向后看到图片3，当图片3滚动完成迅速重新设置3个UIImageView的内容为图片2、图片3、图片4，然后设置contentOffset显示中间的UIImageView，也就是图片3。当然，向前滚动原理完全一样，如此就给用户一种循环错觉，而且不占用过多内存。</li>
</ul>
</li>
</ul>
<ul>
<li><p>通过解析plist文件来加载图片数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE plist PUBLIC &quot;-//Apple//DTD PLIST 1.0//EN&quot; &quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;&gt;</span><br><span class="line">&lt;plist version=&quot;1.0&quot;&gt;</span><br><span class="line">&lt;dict&gt;</span><br><span class="line">    &lt;key&gt;0.jpg&lt;/key&gt;</span><br><span class="line">    &lt;string&gt;图0&lt;/string&gt;</span><br><span class="line">    &lt;key&gt;1.jpg&lt;/key&gt;</span><br><span class="line">    &lt;string&gt;图1&lt;/string&gt;</span><br><span class="line">    &lt;key&gt;2.jpg&lt;/key&gt;</span><br><span class="line">    &lt;string&gt;图2&lt;/string&gt;</span><br><span class="line">    &lt;key&gt;3.jpg&lt;/key&gt;</span><br><span class="line">    &lt;string&gt;图3&lt;/string&gt;</span><br><span class="line">    &lt;key&gt;4.jpg&lt;/key&gt;</span><br><span class="line">    &lt;string&gt;图4&lt;/string&gt;</span><br><span class="line">    &lt;key&gt;5.jpg&lt;/key&gt;</span><br><span class="line">    &lt;string&gt;图5&lt;/string&gt;</span><br><span class="line">    &lt;key&gt;6.jpg&lt;/key&gt;</span><br><span class="line">    &lt;string&gt;图6&lt;/string&gt;</span><br><span class="line">    &lt;key&gt;7.jpg&lt;/key&gt;</span><br><span class="line">    &lt;string&gt;图7&lt;/string&gt;</span><br><span class="line">    &lt;key&gt;8.jpg&lt;/key&gt;</span><br><span class="line">    &lt;string&gt;图8&lt;/string&gt;</span><br><span class="line">&lt;/dict&gt;</span><br><span class="line">&lt;/plist&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>ViewController.m</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  ViewController.m</span></span><br><span class="line"><span class="comment">//  无限滚动图片</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  Created by 武 on 18/1/29.</span></span><br><span class="line"><span class="comment">//  Copyright © 2018年 com. All rights reserved.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#define SCREEN_WIDTH 320</span></span><br><span class="line"><span class="meta">#define SCREEN_HEIGHT 568</span></span><br><span class="line"><span class="meta">#define IMAGEVIEW_COUNT 3</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()&lt;<span class="title">UIScrollViewDelegate</span>&gt;</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">UIScrollView</span> *_scrollView;</span><br><span class="line">    <span class="built_in">UIImageView</span> *_leftImageView;</span><br><span class="line">    <span class="built_in">UIImageView</span> *_centerImageView;</span><br><span class="line">    <span class="built_in">UIImageView</span> *_rightImageView;</span><br><span class="line">    <span class="built_in">UIPageControl</span> *_pageControl;</span><br><span class="line">    <span class="built_in">UILabel</span> *_label;</span><br><span class="line">    <span class="built_in">NSMutableDictionary</span> *_imageData;<span class="comment">//图片数据</span></span><br><span class="line">    <span class="keyword">int</span> _currentImageIndex;<span class="comment">//当前图片索引</span></span><br><span class="line">    <span class="keyword">int</span> _imageCount;<span class="comment">//图片总数</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//加载数据</span></span><br><span class="line">    [<span class="keyword">self</span> loadImageData];</span><br><span class="line">    <span class="comment">//添加滚动控件</span></span><br><span class="line">    [<span class="keyword">self</span> addScrollView];</span><br><span class="line">    <span class="comment">//添加图片控件</span></span><br><span class="line">    [<span class="keyword">self</span> addImageViews];</span><br><span class="line">    <span class="comment">//添加分页控件</span></span><br><span class="line">    [<span class="keyword">self</span> addPageControl];</span><br><span class="line">    <span class="comment">//添加图片信息描述控件</span></span><br><span class="line">    [<span class="keyword">self</span> addLabel];</span><br><span class="line">    <span class="comment">//加载默认图片</span></span><br><span class="line">    [<span class="keyword">self</span> setDefaultImage];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark 加载图片数据</span></span><br><span class="line">- (<span class="keyword">void</span>)loadImageData</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSString</span> *path = [[<span class="built_in">NSBundle</span> mainBundle]pathForResource:<span class="string">@"imageInfo"</span> ofType:<span class="string">@"plist"</span>];</span><br><span class="line">    _imageData = [<span class="built_in">NSMutableDictionary</span> dictionaryWithContentsOfFile:path];</span><br><span class="line">    _imageCount = _imageData.count;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#pragma mark 添加控件</span></span><br><span class="line">- (<span class="keyword">void</span>)addScrollView</span><br><span class="line">&#123;</span><br><span class="line">    _scrollView = [[<span class="built_in">UIScrollView</span> alloc]initWithFrame:[<span class="built_in">UIScreen</span> mainScreen].bounds];</span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:_scrollView];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//设置代理</span></span><br><span class="line">    _scrollView.delegate = <span class="keyword">self</span>;</span><br><span class="line">    <span class="comment">//设置contentSize</span></span><br><span class="line">    _scrollView.contentSize = <span class="built_in">CGSizeMake</span>(IMAGEVIEW_COUNT*SCREEN_WIDTH, SCREEN_HEIGHT);</span><br><span class="line">    <span class="comment">//设置当前显示的位置为中间图片</span></span><br><span class="line">    [_scrollView setContentOffset:<span class="built_in">CGPointMake</span>(SCREEN_WIDTH, <span class="number">0</span>) animated:<span class="literal">NO</span>];</span><br><span class="line">    <span class="comment">//设置分页</span></span><br><span class="line">    _scrollView.pagingEnabled=<span class="literal">YES</span>;</span><br><span class="line">    <span class="comment">//去掉滚动条</span></span><br><span class="line">    _scrollView.showsHorizontalScrollIndicator=<span class="literal">NO</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#pragma mark 添加图片三个控件</span></span><br><span class="line">-(<span class="keyword">void</span>)addImageViews&#123;</span><br><span class="line">    _leftImageView=[[<span class="built_in">UIImageView</span> alloc]initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, SCREEN_WIDTH, SCREEN_HEIGHT)];</span><br><span class="line">    _leftImageView.contentMode=<span class="built_in">UIViewContentModeScaleAspectFit</span>;</span><br><span class="line">    [_scrollView addSubview:_leftImageView];</span><br><span class="line">    _centerImageView=[[<span class="built_in">UIImageView</span> alloc]initWithFrame:<span class="built_in">CGRectMake</span>(SCREEN_WIDTH, <span class="number">0</span>, SCREEN_WIDTH, SCREEN_HEIGHT)];</span><br><span class="line">    _centerImageView.contentMode=<span class="built_in">UIViewContentModeScaleAspectFit</span>;</span><br><span class="line">    [_scrollView addSubview:_centerImageView];</span><br><span class="line">    _rightImageView=[[<span class="built_in">UIImageView</span> alloc]initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">2</span>*SCREEN_WIDTH, <span class="number">0</span>, SCREEN_WIDTH, SCREEN_HEIGHT)];</span><br><span class="line">    _rightImageView.contentMode=<span class="built_in">UIViewContentModeScaleAspectFit</span>;</span><br><span class="line">    [_scrollView addSubview:_rightImageView];</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#pragma mark 设置默认显示图片</span></span><br><span class="line">-(<span class="keyword">void</span>)setDefaultImage&#123;</span><br><span class="line">    <span class="comment">//加载默认图片</span></span><br><span class="line">    _leftImageView.image=[<span class="built_in">UIImage</span> imageNamed:[<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%i.jpg"</span>,_imageCount<span class="number">-1</span>]];</span><br><span class="line">    _centerImageView.image=[<span class="built_in">UIImage</span> imageNamed:[<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%i.jpg"</span>,<span class="number">0</span>]];</span><br><span class="line">    _rightImageView.image=[<span class="built_in">UIImage</span> imageNamed:[<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%i.jpg"</span>,<span class="number">1</span>]];</span><br><span class="line">    _currentImageIndex=<span class="number">0</span>;</span><br><span class="line">    <span class="comment">//设置当前页</span></span><br><span class="line">    _pageControl.currentPage=_currentImageIndex;</span><br><span class="line">    <span class="built_in">NSString</span> *imageName=[<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%i.jpg"</span>,_currentImageIndex];</span><br><span class="line">    _label.text=_imageData[imageName];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark 添加分页控件</span></span><br><span class="line">-(<span class="keyword">void</span>)addPageControl&#123;</span><br><span class="line">    _pageControl=[[<span class="built_in">UIPageControl</span> alloc]init];</span><br><span class="line">    <span class="comment">//注意此方法可以根据页数返回UIPageControl合适的大小</span></span><br><span class="line">    <span class="built_in">CGSize</span> size= [_pageControl sizeForNumberOfPages:_imageCount];</span><br><span class="line">    _pageControl.bounds=<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, size.width, size.height);</span><br><span class="line">    _pageControl.center=<span class="built_in">CGPointMake</span>(SCREEN_WIDTH/<span class="number">2</span>, SCREEN_HEIGHT<span class="number">-100</span>);</span><br><span class="line">    <span class="comment">//设置颜色</span></span><br><span class="line">    _pageControl.pageIndicatorTintColor=[<span class="built_in">UIColor</span> colorWithRed:<span class="number">193</span>/<span class="number">255.0</span> green:<span class="number">219</span>/<span class="number">255.0</span> blue:<span class="number">249</span>/<span class="number">255.0</span> alpha:<span class="number">1</span>];</span><br><span class="line">    <span class="comment">//设置当前页颜色</span></span><br><span class="line">    _pageControl.currentPageIndicatorTintColor=[<span class="built_in">UIColor</span> colorWithRed:<span class="number">0</span> green:<span class="number">150</span>/<span class="number">255.0</span> blue:<span class="number">1</span> alpha:<span class="number">1</span>];</span><br><span class="line">    <span class="comment">//设置总页数</span></span><br><span class="line">    _pageControl.numberOfPages=_imageCount;</span><br><span class="line">    </span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:_pageControl];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark 添加信息描述控件</span></span><br><span class="line">-(<span class="keyword">void</span>)addLabel&#123;</span><br><span class="line">    </span><br><span class="line">    _label=[[<span class="built_in">UILabel</span> alloc]initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">10</span>, SCREEN_WIDTH,<span class="number">30</span>)];</span><br><span class="line">    _label.textAlignment=<span class="built_in">NSTextAlignmentCenter</span>;</span><br><span class="line">    _label.textColor=[<span class="built_in">UIColor</span> colorWithRed:<span class="number">0</span> green:<span class="number">150</span>/<span class="number">255.0</span> blue:<span class="number">1</span> alpha:<span class="number">1</span>];</span><br><span class="line">    </span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:_label];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark 滚动停止事件</span></span><br><span class="line">-(<span class="keyword">void</span>)scrollViewDidEndDecelerating:(<span class="built_in">UIScrollView</span> *)scrollView&#123;</span><br><span class="line">    <span class="comment">//重新加载图片</span></span><br><span class="line">    [<span class="keyword">self</span> reloadImage];</span><br><span class="line">    <span class="comment">//移动到中间</span></span><br><span class="line">    [_scrollView setContentOffset:<span class="built_in">CGPointMake</span>(SCREEN_WIDTH, <span class="number">0</span>) animated:<span class="literal">NO</span>];</span><br><span class="line">    <span class="comment">//设置分页</span></span><br><span class="line">    _pageControl.currentPage=_currentImageIndex;</span><br><span class="line">    <span class="comment">//设置描述</span></span><br><span class="line">    <span class="built_in">NSString</span> *imageName=[<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%i.jpg"</span>,_currentImageIndex];</span><br><span class="line">    _label.text=_imageData[imageName];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark 重新加载图片</span></span><br><span class="line">-(<span class="keyword">void</span>)reloadImage&#123;</span><br><span class="line">    <span class="keyword">int</span> leftImageIndex,rightImageIndex;</span><br><span class="line">    <span class="built_in">CGPoint</span> offset=[_scrollView contentOffset];</span><br><span class="line">    <span class="keyword">if</span> (offset.x&gt;SCREEN_WIDTH) &#123; <span class="comment">//向右滑动</span></span><br><span class="line">        _currentImageIndex=(_currentImageIndex+<span class="number">1</span>)%_imageCount;</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(offset.x&lt;SCREEN_WIDTH)&#123; <span class="comment">//向左滑动</span></span><br><span class="line">        _currentImageIndex=(_currentImageIndex+_imageCount<span class="number">-1</span>)%_imageCount;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//UIImageView *centerImageView=(UIImageView *)[_scrollView viewWithTag:2];</span></span><br><span class="line">    _centerImageView.image=[<span class="built_in">UIImage</span> imageNamed:[<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%i.jpg"</span>,_currentImageIndex]];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//重新设置左右图片</span></span><br><span class="line">    leftImageIndex=(_currentImageIndex+_imageCount<span class="number">-1</span>)%_imageCount;</span><br><span class="line">    rightImageIndex=(_currentImageIndex+<span class="number">1</span>)%_imageCount;</span><br><span class="line">    _leftImageView.image=[<span class="built_in">UIImage</span> imageNamed:[<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%i.jpg"</span>,leftImageIndex]];</span><br><span class="line">    _rightImageView.image=[<span class="built_in">UIImage</span> imageNamed:[<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%i.jpg"</span>,rightImageIndex]];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p>​</p>
</li>
</ul>
]]></content>
      
        <categories>
            
            <category> iOS开发 </category>
            
        </categories>
        
        
        <tags>
            
            <tag> iOS </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[UIView解析]]></title>
      <url>/2018/01/27/UIView%E8%A7%A3%E6%9E%90/</url>
      <content type="html"><![CDATA[<p>UIView是管理屏幕上矩形区域内容的对象，iOS中几乎所有UI控件都是UIView的子类。</p>
<p><img src="/2018/01/27/UIView解析/1.png" alt="UIView"></p>
<h4 id="三个结构体CGPoint、CGSize、CGRect"><a href="#三个结构体CGPoint、CGSize、CGRect" class="headerlink" title="三个结构体CGPoint、CGSize、CGRect"></a>三个结构体CGPoint、CGSize、CGRect</h4><ul>
<li><p>1.CGPoint</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="built_in">CGPoint</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">CGFloat</span> x; <span class="comment">//控件x轴位置</span></span><br><span class="line">  <span class="built_in">CGFLoat</span> y; <span class="comment">//控件Y轴位置</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><p>CGSize</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="built_in">CGSize</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">CGFloat</span> width; <span class="comment">//控件宽度</span></span><br><span class="line">  <span class="built_in">CGFloat</span> height; <span class="comment">//控件高度</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>CGRect</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="built_in">CGRect</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">CGPoint</span> origin; <span class="comment">//偏移量是相对父视图的</span></span><br><span class="line">  <span class="built_in">CGSize</span> size;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="视图的基本属性"><a href="#视图的基本属性" class="headerlink" title="视图的基本属性"></a>视图的基本属性</h4><p>​</p>
<ul>
<li><p>frame和center都是相对父视图来说的，bounds是相对自身来说的</p>
</li>
<li><p>frame是相对于父视图左上角原点(0,0)的位置，改变视图的frame会改变center中心点</p>
</li>
<li><p>center是CGPoint值的就是整个视图的中心点，改变视图的center也会改变frame</p>
</li>
<li><p>bounds 是CGRect  是告诉子视图本视图的原点位置(通俗的说就是，子视图的frame的origin与父视图的bounds的origin的差，就是子视图相对于父视图左上角的位置，如果结果为负，则子视图在父视图外)</p>
</li>
<li><p>通过addSubview方法添加的子视图，越后添加，越显示到上层。</p>
</li>
<li><p>移除父视图也会把它里面的子视图移除</p>
</li>
</ul>
<h4 id="基本界面元素"><a href="#基本界面元素" class="headerlink" title="基本界面元素"></a>基本界面元素</h4><ul>
<li><p>1.UIView</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">UIView</span> *myView = [[<span class="built_in">UIView</span> alloc]initWithFrame:<span class="built_in">CGrectMake</span>(<span class="number">10</span>,<span class="number">10</span>,<span class="number">50</span>,<span class="number">50</span>)];<span class="comment">//创建了一个x轴10，y轴10，宽度为50，高度为50的UIView.</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>2.UIWindow</p>
<ul>
<li><p>UIWindow继承自UIView，在系统的初始化过程中创建(application didFinishLauchingWithOptions里面)</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">self</span>.window = [[[<span class="built_in">UIWindos</span> alloc]initWithFrame:[<span class="built_in">UIScreen</span> mainScreen]bounds]autorelease];</span><br><span class="line"><span class="keyword">self</span>.window.backgroundColor = [<span class="built_in">UIColor</span> grayColor];       <span class="comment">//给window设置一个背景色  </span></span><br><span class="line">[<span class="keyword">self</span>.window makeKeyAndVisible];     <span class="comment">//让window显示出来</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>UIScreen代表了屏幕</p>
</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CGRect</span> screenBounds = [ [<span class="built_in">UIScreen</span> mainScreen]bounds];    <span class="comment">//返回的是带有状态栏的Rect </span></span><br><span class="line"><span class="built_in">CGRect</span> viewBounds = [ [<span class="built_in">UIScreen</span> mainScreen]applicationFrame];    <span class="comment">//不包含状态栏的Rect</span></span><br></pre></td></tr></table></figure>
<p>​</p>
</li>
</ul>
<h4 id="UIView的方法"><a href="#UIView的方法" class="headerlink" title="UIView的方法"></a>UIView的方法</h4><ul>
<li>一个 UIView 里面可以包含许多的 Subview（其他的 UIView），而这些 Subview 彼此之间是有所谓的阶层关系，这有点类似绘图软体中图层的概念，下面程式码示演示了几个在管理图层（Subview）上常用的方法，其程式码如下。</li>
<li><p>1.首先是大家最常使用的新增和移除Subview。</p>
<p>​<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[Subview removeFromSuperview];     <span class="comment">//将Subview从当前的UIView中移除 </span></span><br><span class="line">[<span class="built_in">UIView</span> addSubview:Subview];     <span class="comment">//UIView增加一个Subview</span></span><br><span class="line">​</span><br></pre></td></tr></table></figure></p>
</li>
<li><p>2.在UIView中将Subview往前或是往后移动一个图层，往前移动会覆盖住较后层的 Subview，而往后移动则会被较上层的Subview所覆盖。</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="built_in">UIView</span> bringSubviewToFront:Subview];       <span class="comment">//将Subview往前移动一个图层（与它的前一个图层对调位置）//将Subview往前移动一个图层（与它的前一个图层对调位置）</span></span><br><span class="line"></span><br><span class="line">[<span class="built_in">UIView</span> sendSubviewToBack:Subview];      <span class="comment">//将Subview往后移动一个图层（与它的后一个图层对调位置)</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><p>3.在UIView中使用索引Index交换两的Subview彼此的图层层级。</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="built_in">UIView</span> exchangeSubviewAtIndex:indexA withSubviewAtIndex:indexB];    <span class="comment">//交换两个图层</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>4.使用Subview的变数名称取得它在UIView中的索引值（Index ）</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSInteger</span> index = [[<span class="built_in">UIView</span> subviews] indexOfObject:Subview名称];       <span class="comment">//取得Index</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>5.替Subview加上NSInteger 的註记(Tag)好让之后它们分辨彼此。</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[Subview setTag:<span class="built_in">NSInteger</span>];       <span class="comment">//加上标记</span></span><br><span class="line">	[<span class="built_in">UIView</span> viewWithTag:<span class="built_in">NSInteger</span>];  <span class="comment">//通过标记得到view 返回值为UIView</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>6.最后是取得UIView中所有的Subview，呼叫此方法会传回一个 NSArray，并以由后往前的顺序列出这些 Subview，下图中是列出范例图片里Root中所有的Subview。</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="built_in">UIView</span> subviews] ;        <span class="comment">//取的UIView下的所有Subview</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h4 id="UIView常用属性和方法"><a href="#UIView常用属性和方法" class="headerlink" title="UIView常用属性和方法"></a>UIView常用属性和方法</h4><ul>
<li>属性</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@property</span>(<span class="keyword">nonatomic</span>) <span class="built_in">CGRect</span> frame;<span class="comment">//控件的位置和大小，所有的控件必须指定这个属性，否则即使有控件也无法显示</span></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">nonatomic</span>) <span class="built_in">CGRect</span> bounds;<span class="comment">//当前控件位置和大小，但是和frame不同的是它的位置是确定的(0,0)</span></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">nonatomic</span>) <span class="built_in">CGPoint</span> center;<span class="comment">//控件的中心位置，一般用户进行控件定位</span></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">nonatomic</span>) <span class="built_in">CGAffineTransform</span> transform;<span class="comment">//控件矩阵变化，包括平移、缩放、旋转，默认为CGAffineTransformIdentity</span></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">nonatomic</span>) <span class="built_in">UIViewAutoresizing</span> autoresizingMask;<span class="comment">//控件旋转时大小自动伸缩，默认为UIViewAutoresizingNone</span></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">nonatomic</span>,<span class="keyword">readonly</span>) <span class="built_in">UIView</span> *superview;<span class="comment">//当前控件的父控件</span></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">nonatomic</span>,<span class="keyword">readonly</span>,<span class="keyword">copy</span>) <span class="built_in">NSArray</span> *subviews;<span class="comment">//当前控件的子控件返回一个数组</span></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">nonatomic</span>,<span class="keyword">getter</span>=isHidden) <span class="built_in">BOOL</span> hidden;<span class="comment">//是否隐藏，默认为不隐藏。</span></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">nonatomic</span>) <span class="built_in">UIViewContentMode</span> contentMode; <span class="comment">//控件的显示模式。如ImageView的居中模式等</span></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">nonatomic</span>) <span class="built_in">NSInteger</span> tag;<span class="comment">//控件的标签属性</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>方法</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)addSubview:(<span class="built_in">UIView</span> *) view;<span class="comment">//添加子控件</span></span><br><span class="line">- (<span class="keyword">void</span>)removeFromSuperView;<span class="comment">//从父控件中移除当前控件</span></span><br><span class="line">- (<span class="keyword">void</span>)insertSubview:(<span class="built_in">UIView</span> *)view atIndex:(<span class="built_in">NSInteger</span>) index; <span class="comment">//在指定位置插入子控件</span></span><br><span class="line">- (<span class="keyword">void</span>)beginAnimations:*(<span class="built_in">NSString</span> *)animationID context:(<span class="keyword">void</span> *)context;<span class="comment">//开始一段动画</span></span><br><span class="line">+ (<span class="keyword">void</span>)animateWithDuration:(<span class="built_in">NSTimeInterval</span>)duration animations:(<span class="keyword">void</span> (^)(<span class="keyword">void</span>))animations <span class="built_in">NS_AVAILABLE_IOS</span>(<span class="number">4</span>_0);<span class="comment">//以block的形式执行一段动画，注意这个方法有几种相关的方法</span></span><br><span class="line">- (<span class="keyword">void</span>)addGestureRecognizer:(<span class="built_in">UIGestureRecognizer</span>*)gestureRecognizer <span class="built_in">NS_AVAILABLE_IOS</span>(<span class="number">3</span>_2);	<span class="comment">//添加手势操作</span></span><br><span class="line">- (<span class="keyword">void</span>)removeGestureRecognizer:(<span class="built_in">UIGestureRecognizer</span>*)gestureRecognizer <span class="built_in">NS_AVAILABLE_IOS</span>(<span class="number">3</span>_2); <span class="comment">//移除手势操作</span></span><br></pre></td></tr></table></figure>
<p><code>上面所有位置的属性都是相对于父控件而言（不是相对主屏幕而言）</code></p>
<p>​</p>
</li>
</ul>
]]></content>
      
        <categories>
            
            <category> iOS开发 </category>
            
        </categories>
        
        
        <tags>
            
            <tag> iOS </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[iOS程序启动过程]]></title>
      <url>/2018/01/26/iOS%E7%A8%8B%E5%BA%8F%E5%90%AF%E5%8A%A8%E8%BF%87%E7%A8%8B/</url>
      <content type="html"><![CDATA[<ul>
<li><p>点击程序图标打开程序</p>
</li>
<li><p>执行main函数</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> main(<span class="keyword">int</span> argc, <span class="keyword">char</span> * argv[]) &#123;</span><br><span class="line">     <span class="keyword">@autoreleasepool</span> &#123;</span><br><span class="line">          <span class="comment">//第三个参数:UIApplication类名或者子类的名称 nil == @"UIApplication"</span></span><br><span class="line">          <span class="comment">//第四个参数:UIApplication的代理的代理名称</span></span><br><span class="line">          <span class="comment">//NSStringFromClass:把类名转化字符串</span></span><br><span class="line">          <span class="comment">//NSStringFromClass好处:1.有提示功能 2.避免输入错误</span></span><br><span class="line">          <span class="keyword">return</span> <span class="built_in">UIApplicationMain</span>(argc, argv, <span class="literal">nil</span>,<span class="built_in">NSStringFromClass</span>([AppDelegate <span class="keyword">class</span>]));</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>​</p>
</li>
<li><p>执行UIApplicationMain函数</p>
</li>
<li><p>创建UIApplication对象,并设置UIApplicationMain对象的代理.</p>
<p>  UIApplication的第三个参数就是UIApplication的名称,如果指定为nil,它会默认为UIApplication.</p>
<p>  UIApplication的第四个参数为UIApplication的代理.</p>
<ul>
<li><p>开启监听程序事件</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">BOOL</span>)application:(<span class="built_in">UIApplication</span> *)application didFinishLaunchingWithOptions:(<span class="built_in">NSDictionary</span> *)launchOptions &#123;<span class="comment">//程序加载完毕后调用该方法&#125;</span></span><br><span class="line">- (<span class="keyword">void</span>)applicationWillResignActive:(<span class="built_in">UIApplication</span> *)application &#123;<span class="comment">//程序失去焦点调用该方法&#125;</span></span><br><span class="line">- (<span class="keyword">void</span>)applicationDidEnterBackground:(<span class="built_in">UIApplication</span> *)application &#123;<span class="comment">//程序进入后台调用该方法&#125;</span></span><br><span class="line">- (<span class="keyword">void</span>)applicationWillEnterForeground:(<span class="built_in">UIApplication</span> *)application &#123;<span class="comment">//程序从后台将要进入前台调用该方法&#125;</span></span><br><span class="line">- (<span class="keyword">void</span>)applicationDidBecomeActive:(<span class="built_in">UIApplication</span> *)application &#123;<span class="comment">//内存经过，程序将要停止调用该方法&#125;</span></span><br><span class="line">- (<span class="keyword">void</span>)applicationWillTerminate:(<span class="built_in">UIApplication</span> *)application &#123;<span class="comment">//程序将要退出调用该方法&#125;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>开启一个主运行循环.保证应用程序不退出.</p>
</li>
<li><p>加载info.plist程序配置文件，主要是看我们用的是Storyboard方式加载还是代码的方式加载。(判断一下info.plist文件当中有没有Main storyboard file base name)</p>
<ul>
<li>通过storyboard方式加载</li>
</ul>
</li>
</ul>
<ul>
<li><p>在程序启动完成的时候系统自动创建一个UIWindow的实例来显示界面</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) <span class="built_in">UIWindow</span> *window;</span><br></pre></td></tr></table></figure>
</li>
<li><p>设置窗口的根控制器</p>
<ul>
<li>根据storyboard的设置，创建一个控制器。</li>
<li>并且设置这个控制器为之前创建的UIWindow的根控制器</li>
</ul>
</li>
<li><p>显示窗口。（makeKeyAndVisible）</p>
<ul>
<li>设置self.window可见并且设置UIApplication的keyWindow</li>
</ul>
</li>
<li><p>通过代码加载</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">BOOL</span>)application:(<span class="built_in">UIApplication</span> *)application didFinishLaunchingWithOptions:(<span class="built_in">NSDictionary</span> *)launchOptions &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">self</span>.window = [[<span class="built_in">UIWindow</span> alloc] initWithFrame:[<span class="built_in">UIScreen</span> mainScreen].bounds];</span><br><span class="line">    <span class="built_in">UIViewController</span> *viewController = [[<span class="built_in">UIViewController</span> alloc] init];</span><br><span class="line">    <span class="keyword">self</span>.window.rootViewController = viewController;</span><br><span class="line">    [<span class="keyword">self</span>.window makeKeyAndVisible];</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>​</p>
</li>
<li><p>首先创建串口，获取到一个UIWindow实例来显示界面。（self.window为系统自带）</p>
</li>
<li>创建一个控制器，将该控制器设置为根控制器</li>
<li>显示窗口<code>[self.window makeKeyAndVisible]</code></li>
</ul>
<ul>
<li>结束程序</li>
</ul>
]]></content>
      
        <categories>
            
            <category> iOS开发 </category>
            
        </categories>
        
        
        <tags>
            
            <tag> iOS </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Mac系统搭建基于GitHhub的Hexo博客]]></title>
      <url>/2018/01/23/Mac%E4%B8%8A%E6%90%AD%E5%BB%BA%E5%9F%BA%E4%BA%8EGitHhub%E7%9A%84Hexo%E5%8D%9A%E5%AE%A2/</url>
      <content type="html"><![CDATA[<h3 id="1-注册GitHub帐号"><a href="#1-注册GitHub帐号" class="headerlink" title="1. 注册GitHub帐号"></a>1. 注册GitHub帐号</h3><ul>
<li>进入<a href="https://github.com/" target="_blank" rel="noopener">GitHub官网</a>注册帐号</li>
<li>创建一个仓库，名称为 yourname.github.io 其中yourname是你的github名称,按照这个规则创建才有用。如你的github注册名称为jack那你创建的仓库名称为jack.github.io</li>
</ul>
<h3 id="2-安装node-js"><a href="#2-安装node-js" class="headerlink" title="2. 安装node.js"></a>2. 安装node.js</h3><ul>
<li>进入<a href="https://nodejs.org/en/" target="_blank" rel="noopener">nodejs官网</a>下载一步步安装即可,建议安装通用版。</li>
<li>安装完成后可以在终端测试 Node.js 和npm 是否可以使用了。</li>
<li>查看 Node.js 的版本号在终端里输入如下命令：<code>node -v</code> 如果Node.js 成功安装，可以看到类似如下的信息：v6.5.0。查看npm 的版本号在终端里输入如下命令：<code>npm -v</code>如果npm 成功安装，可以看到类似如下的信息：3.10.3。注意命令中间有空格。</li>
</ul>
<h3 id="3-安装hexo"><a href="#3-安装hexo" class="headerlink" title="3. 安装hexo"></a>3. 安装hexo</h3><ul>
<li>可以查看<a href="https://hexo.io/zh-cn/docs/" target="_blank" rel="noopener">Hexo中文文档</a></li>
<li>在终端输入 <code>npm install -g hexo-cli</code> 安装</li>
<li>如果Mac系统在安装过程中报错需要安装命令行工具</li>
<li>在终端中输入命令 <code>xcode-select --install</code>会弹出一个窗口选择安装即可。安装完成后输入命令 <code>gcc-v</code>会看到如下信息 <code>Configured with: --prefix=/Applications/Xcode.app/Contents/Developer/usr --with-gxx-include-dir=/usr/include/c++/4.2.1
Apple LLVM version 8.0.0 (clang-800.0.38)
Target: x86_64-apple-darwin15.5.0
Thread model: posix
InstalledDir: /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin</code>说明安装完成</li>
<li>安装完命令行工具后再输入 $ npm install -g hexo-cli 来安装Hexo，安装完成后输入 <code>hexo</code> 命令会出现下图<br>  <img src="/2018/01/23/Mac上搭建基于GitHhub的Hexo博客/Hexo安装完成图.png" alt="Hexo安装完成图"></li>
</ul>
<h3 id="4-初始化博客"><a href="#4-初始化博客" class="headerlink" title="4. 初始化博客"></a>4. 初始化博客</h3><ul>
<li>新建一个文件夹如我是在文档下新建了一个名称为blog的文件夹名字可以随便取在终端cd到该文件夹 <code>cd Documents/blog/</code> 然后运行 <code>hexo init</code>命令行，速度取决于网速，可能需要几分钟完成，成功后会在blog目录下生成相关文件，如图<br> <img src="/2018/01/23/Mac上搭建基于GitHhub的Hexo博客/blog相关文件目录.png" alt="初始化后生成的文件目录结构"></li>
<li>安装完成后运行 <code>hexo s</code> 现在即可在浏览器本地访问 <code>http://localhost:4000/</code> 会出现下图证明安装成功<br>  <img src="/2018/01/23/Mac上搭建基于GitHhub的Hexo博客/hexo.png" alt="初始化后生成的文件目录结构"></li>
</ul>
<h3 id="5-关联GitHub"><a href="#5-关联GitHub" class="headerlink" title="5. 关联GitHub"></a>5. 关联GitHub</h3><ul>
<li>终端 <code>open Documents/blog/</code> 打开刚才新建的blog文件夹就是我们把hexo init的那个文件夹。打开文件夹下 <code>_config.yml</code>文件,建议使用Sublime Text打开其他文本编辑器也行，滑到最下面修改成如下样子,将我的名字改成你的名字。<br>  <img src="/2018/01/23/Mac上搭建基于GitHhub的Hexo博客/关联github.png" alt="初始化后生成的文件目录结构"><br>  <code>注意：在配置所有的_config.yml文件时（包括theme中的）在所有的冒号:后边都要加一个空格，否则执行hexo命令会报错</code></li>
<li>在blog文件夹目录下执行生成静态页面命令：<code>hexo g</code> 然后执行<code>hexo d</code><br>执行hexo d部署需要你的github用户名和密码</li>
</ul>
<h3 id="6-发布文章"><a href="#6-发布文章" class="headerlink" title="6. 发布文章"></a>6. 发布文章</h3><ul>
<li>终端cd到blog文件夹下运行 <code>hexo new “firstName”</code>名为firstName.md的文件会建在目录/blog/source/_posts下，firstName是文件名.建议使用Mou编辑器。如下图，新建title：为文章名称，date：创建时间，tags:文章所属标签，categories：文章所属分类，注意刚开始新建的文章打开是没有分类的需要修改新建文章模版，打开目录下scaffolds文件夹下的post.md文件在标签上面添加 <code>categories:</code>后续新建文章就会添加分类栏目。<br>  <img src="/2018/01/23/Mac上搭建基于GitHhub的Hexo博客/新建文章.png" alt="新建文章"><br>  如下图是这篇文章的属性，分类和标签可修改成任意名称，Hexo会自动根据标签和分类归纳文章。<br>  <img src="/2018/01/23/Mac上搭建基于GitHhub的Hexo博客/文章属性.png" alt="文章属性"></li>
</ul>
]]></content>
      
        <categories>
            
            <category> 技术杂记 </category>
            
        </categories>
        
        
    </entry>
    
    <entry>
      <title><![CDATA[惯例]]></title>
      <url>/2018/01/18/index/</url>
      <content type="html"><![CDATA[<p>hello world</p>
]]></content>
      
        
    </entry>
    
  
  
</search>
